(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{1856:function(module,exports,__webpack_require__){"use strict";eval("\nvar $ = __webpack_require__(26);\nvar isArray = __webpack_require__(265);\n\nvar nativeReverse = [].reverse;\nvar test = [1, 2];\n\n// `Array.prototype.reverse` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.reverse\n// fix for Safari 12.0 bug\n// https://bugs.webkit.org/show_bug.cgi?id=188794\n$({ target: 'Array', proto: true, forced: String(test) === String(test.reverse()) }, {\n  reverse: function reverse() {\n    // eslint-disable-next-line no-self-assign\n    if (isArray(this)) this.length = this.length;\n    return nativeReverse.call(this);\n  }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg1Ni5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJldmVyc2UuanM/NTBhYSJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG52YXIgJCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9leHBvcnQnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2lzLWFycmF5Jyk7XG5cbnZhciBuYXRpdmVSZXZlcnNlID0gW10ucmV2ZXJzZTtcbnZhciB0ZXN0ID0gWzEsIDJdO1xuXG4vLyBgQXJyYXkucHJvdG90eXBlLnJldmVyc2VgIG1ldGhvZFxuLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtYXJyYXkucHJvdG90eXBlLnJldmVyc2Vcbi8vIGZpeCBmb3IgU2FmYXJpIDEyLjAgYnVnXG4vLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTg4Nzk0XG4kKHsgdGFyZ2V0OiAnQXJyYXknLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiBTdHJpbmcodGVzdCkgPT09IFN0cmluZyh0ZXN0LnJldmVyc2UoKSkgfSwge1xuICByZXZlcnNlOiBmdW5jdGlvbiByZXZlcnNlKCkge1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWFzc2lnblxuICAgIGlmIChpc0FycmF5KHRoaXMpKSB0aGlzLmxlbmd0aCA9IHRoaXMubGVuZ3RoO1xuICAgIHJldHVybiBuYXRpdmVSZXZlcnNlLmNhbGwodGhpcyk7XG4gIH1cbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1856\n")},2237:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(262);\n            var content = __webpack_require__(2238);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIzNy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvc3JjL3ZlbmRvci9jYWwtaGVhdG1hcC5jc3M/ZTEzNiJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBpID0gcmVxdWlyZShcIiEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIik7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHJlcXVpcmUoXCIhIS4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzPz9yZWYtLTYtMSEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPz9wb3N0Y3NzIS4vY2FsLWhlYXRtYXAuY3NzXCIpO1xuXG4gICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5fX2VzTW9kdWxlID8gY29udGVudC5kZWZhdWx0IDogY29udGVudDtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBjb250ZW50ID0gW1ttb2R1bGUuaWQsIGNvbnRlbnQsICcnXV07XG4gICAgICAgICAgICB9XG5cbnZhciBvcHRpb25zID0ge307XG5cbm9wdGlvbnMuaW5zZXJ0ID0gXCJoZWFkXCI7XG5vcHRpb25zLnNpbmdsZXRvbiA9IGZhbHNlO1xuXG52YXIgdXBkYXRlID0gYXBpKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG52YXIgZXhwb3J0ZWQgPSBjb250ZW50LmxvY2FscyA/IGNvbnRlbnQubG9jYWxzIDoge307XG5cblxuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydGVkOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2237\n")},2238:function(module,exports,__webpack_require__){eval('// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(263);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, "/* [LICENSE TBD] */\\n/* Cal-HeatMap CSS */\\n\\n.cal-heatmap-container {\\n  display: block;\\n}\\n\\n.cal-heatmap-container .graph-label {\\n  fill: #999;\\n  font-size: 10px;\\n}\\n\\n.cal-heatmap-container .graph,\\n.cal-heatmap-container .graph-legend rect {\\n  shape-rendering: crispedges;\\n}\\n\\n.cal-heatmap-container .graph-rect {\\n  fill: #ededed;\\n}\\n\\n.cal-heatmap-container .graph-subdomain-group rect:hover {\\n  stroke: #000;\\n  stroke-width: 1px;\\n}\\n\\n.cal-heatmap-container .subdomain-text {\\n  font-size: 8px;\\n  fill: #999;\\n  pointer-events: none;\\n}\\n\\n.cal-heatmap-container .hover_cursor:hover {\\n  cursor: pointer;\\n}\\n\\n.cal-heatmap-container .qi {\\n  background-color: #999;\\n  fill: #999;\\n}\\n\\n/*\\nRemove comment to apply this style to date with value equal to 0\\n.q0\\n{\\n  background-color: #fff;\\n  fill: #fff;\\n  stroke: #ededed\\n}\\n*/\\n\\n.cal-heatmap-container .q1 {\\n  background-color: #dae289;\\n  fill: #dae289;\\n}\\n\\n.cal-heatmap-container .q2 {\\n  background-color: #cedb9c;\\n  fill: #9cc069;\\n}\\n\\n.cal-heatmap-container .q3 {\\n  background-color: #b5cf6b;\\n  fill: #669d45;\\n}\\n\\n.cal-heatmap-container .q4 {\\n  background-color: #637939;\\n  fill: #637939;\\n}\\n\\n.cal-heatmap-container .q5 {\\n  background-color: #3b6427;\\n  fill: #3b6427;\\n}\\n\\n.cal-heatmap-container rect.highlight {\\n  stroke: #444;\\n  stroke-width: 1;\\n}\\n\\n.cal-heatmap-container text.highlight {\\n  fill: #444;\\n}\\n\\n.cal-heatmap-container rect.highlight-now {\\n  stroke: red;\\n}\\n\\n.cal-heatmap-container text.highlight-now {\\n  fill: red;\\n  font-weight: 800;\\n}\\n\\n.cal-heatmap-container .domain-background {\\n  fill: none;\\n  shape-rendering: crispedges;\\n}\\n\\n.ch-tooltip {\\n  padding: 10px;\\n  background: #222;\\n  color: #bbb;\\n  font-size: 12px;\\n  line-height: 1.4;\\n  width: 140px;\\n  position: absolute;\\n  z-index: 99999;\\n  text-align: center;\\n  border-radius: 2px;\\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\\n  display: none;\\n  box-sizing: border-box;\\n}\\n\\n.ch-tooltip::after {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  border-color: transparent;\\n  border-style: solid;\\n  content: \'\';\\n  padding: 0;\\n  display: block;\\n  bottom: -6px;\\n  left: 50%;\\n  margin-left: -6px;\\n  border-width: 6px 6px 0;\\n  border-top-color: #222;\\n}\\n", ""]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIzOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvc3JjL3ZlbmRvci9jYWwtaGVhdG1hcC5jc3M/MjM5NCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBvcnRzXG52YXIgX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIik7XG5leHBvcnRzID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiLyogW0xJQ0VOU0UgVEJEXSAqL1xcbi8qIENhbC1IZWF0TWFwIENTUyAqL1xcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIge1xcbiAgZGlzcGxheTogYmxvY2s7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLWxhYmVsIHtcXG4gIGZpbGw6ICM5OTk7XFxuICBmb250LXNpemU6IDEwcHg7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLFxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmdyYXBoLWxlZ2VuZCByZWN0IHtcXG4gIHNoYXBlLXJlbmRlcmluZzogY3Jpc3BlZGdlcztcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAuZ3JhcGgtcmVjdCB7XFxuICBmaWxsOiAjZWRlZGVkO1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5ncmFwaC1zdWJkb21haW4tZ3JvdXAgcmVjdDpob3ZlciB7XFxuICBzdHJva2U6ICMwMDA7XFxuICBzdHJva2Utd2lkdGg6IDFweDtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAuc3ViZG9tYWluLXRleHQge1xcbiAgZm9udC1zaXplOiA4cHg7XFxuICBmaWxsOiAjOTk5O1xcbiAgcG9pbnRlci1ldmVudHM6IG5vbmU7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmhvdmVyX2N1cnNvcjpob3ZlciB7XFxuICBjdXJzb3I6IHBvaW50ZXI7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnFpIHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICM5OTk7XFxuICBmaWxsOiAjOTk5O1xcbn1cXG5cXG4vKlxcblJlbW92ZSBjb21tZW50IHRvIGFwcGx5IHRoaXMgc3R5bGUgdG8gZGF0ZSB3aXRoIHZhbHVlIGVxdWFsIHRvIDBcXG4ucTBcXG57XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmO1xcbiAgZmlsbDogI2ZmZjtcXG4gIHN0cm9rZTogI2VkZWRlZFxcbn1cXG4qL1xcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnExIHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICNkYWUyODk7XFxuICBmaWxsOiAjZGFlMjg5O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xMiB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjY2VkYjljO1xcbiAgZmlsbDogIzljYzA2OTtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciAucTMge1xcbiAgYmFja2dyb3VuZC1jb2xvcjogI2I1Y2Y2YjtcXG4gIGZpbGw6ICM2NjlkNDU7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLnE0IHtcXG4gIGJhY2tncm91bmQtY29sb3I6ICM2Mzc5Mzk7XFxuICBmaWxsOiAjNjM3OTM5O1xcbn1cXG5cXG4uY2FsLWhlYXRtYXAtY29udGFpbmVyIC5xNSB7XFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I2NDI3O1xcbiAgZmlsbDogIzNiNjQyNztcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciByZWN0LmhpZ2hsaWdodCB7XFxuICBzdHJva2U6ICM0NDQ7XFxuICBzdHJva2Utd2lkdGg6IDE7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgdGV4dC5oaWdobGlnaHQge1xcbiAgZmlsbDogIzQ0NDtcXG59XFxuXFxuLmNhbC1oZWF0bWFwLWNvbnRhaW5lciByZWN0LmhpZ2hsaWdodC1ub3cge1xcbiAgc3Ryb2tlOiByZWQ7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgdGV4dC5oaWdobGlnaHQtbm93IHtcXG4gIGZpbGw6IHJlZDtcXG4gIGZvbnQtd2VpZ2h0OiA4MDA7XFxufVxcblxcbi5jYWwtaGVhdG1hcC1jb250YWluZXIgLmRvbWFpbi1iYWNrZ3JvdW5kIHtcXG4gIGZpbGw6IG5vbmU7XFxuICBzaGFwZS1yZW5kZXJpbmc6IGNyaXNwZWRnZXM7XFxufVxcblxcbi5jaC10b29sdGlwIHtcXG4gIHBhZGRpbmc6IDEwcHg7XFxuICBiYWNrZ3JvdW5kOiAjMjIyO1xcbiAgY29sb3I6ICNiYmI7XFxuICBmb250LXNpemU6IDEycHg7XFxuICBsaW5lLWhlaWdodDogMS40O1xcbiAgd2lkdGg6IDE0MHB4O1xcbiAgcG9zaXRpb246IGFic29sdXRlO1xcbiAgei1pbmRleDogOTk5OTk7XFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxuICBib3JkZXItcmFkaXVzOiAycHg7XFxuICBib3gtc2hhZG93OiAycHggMnB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMik7XFxuICBkaXNwbGF5OiBub25lO1xcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcXG59XFxuXFxuLmNoLXRvb2x0aXA6OmFmdGVyIHtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHdpZHRoOiAwO1xcbiAgaGVpZ2h0OiAwO1xcbiAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDtcXG4gIGJvcmRlci1zdHlsZTogc29saWQ7XFxuICBjb250ZW50OiAnJztcXG4gIHBhZGRpbmc6IDA7XFxuICBkaXNwbGF5OiBibG9jaztcXG4gIGJvdHRvbTogLTZweDtcXG4gIGxlZnQ6IDUwJTtcXG4gIG1hcmdpbi1sZWZ0OiAtNnB4O1xcbiAgYm9yZGVyLXdpZHRoOiA2cHggNnB4IDA7XFxuICBib3JkZXItdG9wLWNvbG9yOiAjMjIyO1xcbn1cXG5cIiwgXCJcIl0pO1xuLy8gRXhwb3J0c1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2238\n')},2239:function(module,exports,__webpack_require__){eval("var DESCRIPTORS = __webpack_require__(67);\nvar global = __webpack_require__(44);\nvar isForced = __webpack_require__(329);\nvar inheritIfRequired = __webpack_require__(815);\nvar defineProperty = __webpack_require__(82).f;\nvar getOwnPropertyNames = __webpack_require__(328).f;\nvar isRegExp = __webpack_require__(813);\nvar getFlags = __webpack_require__(808);\nvar stickyHelpers = __webpack_require__(1124);\nvar redefine = __webpack_require__(114);\nvar fails = __webpack_require__(45);\nvar setInternalState = __webpack_require__(156).set;\nvar setSpecies = __webpack_require__(814);\nvar wellKnownSymbol = __webpack_require__(49);\n\nvar MATCH = wellKnownSymbol('match');\nvar NativeRegExp = global.RegExp;\nvar RegExpPrototype = NativeRegExp.prototype;\nvar re1 = /a/g;\nvar re2 = /a/g;\n\n// \"new\" should create a new object, old webkit bug\nvar CORRECT_NEW = new NativeRegExp(re1) !== re1;\n\nvar UNSUPPORTED_Y = stickyHelpers.UNSUPPORTED_Y;\n\nvar FORCED = DESCRIPTORS && isForced('RegExp', (!CORRECT_NEW || UNSUPPORTED_Y || fails(function () {\n  re2[MATCH] = false;\n  // RegExp constructor can alter flags and IsRegExp works correct with @@match\n  return NativeRegExp(re1) != re1 || NativeRegExp(re2) == re2 || NativeRegExp(re1, 'i') != '/a/i';\n})));\n\n// `RegExp` constructor\n// https://tc39.github.io/ecma262/#sec-regexp-constructor\nif (FORCED) {\n  var RegExpWrapper = function RegExp(pattern, flags) {\n    var thisIsRegExp = this instanceof RegExpWrapper;\n    var patternIsRegExp = isRegExp(pattern);\n    var flagsAreUndefined = flags === undefined;\n    var sticky;\n\n    if (!thisIsRegExp && patternIsRegExp && pattern.constructor === RegExpWrapper && flagsAreUndefined) {\n      return pattern;\n    }\n\n    if (CORRECT_NEW) {\n      if (patternIsRegExp && !flagsAreUndefined) pattern = pattern.source;\n    } else if (pattern instanceof RegExpWrapper) {\n      if (flagsAreUndefined) flags = getFlags.call(pattern);\n      pattern = pattern.source;\n    }\n\n    if (UNSUPPORTED_Y) {\n      sticky = !!flags && flags.indexOf('y') > -1;\n      if (sticky) flags = flags.replace(/y/g, '');\n    }\n\n    var result = inheritIfRequired(\n      CORRECT_NEW ? new NativeRegExp(pattern, flags) : NativeRegExp(pattern, flags),\n      thisIsRegExp ? this : RegExpPrototype,\n      RegExpWrapper\n    );\n\n    if (UNSUPPORTED_Y && sticky) setInternalState(result, { sticky: sticky });\n\n    return result;\n  };\n  var proxy = function (key) {\n    key in RegExpWrapper || defineProperty(RegExpWrapper, key, {\n      configurable: true,\n      get: function () { return NativeRegExp[key]; },\n      set: function (it) { NativeRegExp[key] = it; }\n    });\n  };\n  var keys = getOwnPropertyNames(NativeRegExp);\n  var index = 0;\n  while (keys.length > index) proxy(keys[index++]);\n  RegExpPrototype.constructor = RegExpWrapper;\n  RegExpWrapper.prototype = RegExpPrototype;\n  redefine(global, 'RegExp', RegExpWrapper);\n}\n\n// https://tc39.github.io/ecma262/#sec-get-regexp-@@species\nsetSpecies('RegExp');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjIzOS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5jb25zdHJ1Y3Rvci5qcz9lOWRlIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9kZXNjcmlwdG9ycycpO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9nbG9iYWwnKTtcbnZhciBpc0ZvcmNlZCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9pcy1mb3JjZWQnKTtcbnZhciBpbmhlcml0SWZSZXF1aXJlZCA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9pbmhlcml0LWlmLXJlcXVpcmVkJyk7XG52YXIgZGVmaW5lUHJvcGVydHkgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvb2JqZWN0LWRlZmluZS1wcm9wZXJ0eScpLmY7XG52YXIgZ2V0T3duUHJvcGVydHlOYW1lcyA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9vYmplY3QtZ2V0LW93bi1wcm9wZXJ0eS1uYW1lcycpLmY7XG52YXIgaXNSZWdFeHAgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvaXMtcmVnZXhwJyk7XG52YXIgZ2V0RmxhZ3MgPSByZXF1aXJlKCcuLi9pbnRlcm5hbHMvcmVnZXhwLWZsYWdzJyk7XG52YXIgc3RpY2t5SGVscGVycyA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9yZWdleHAtc3RpY2t5LWhlbHBlcnMnKTtcbnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9yZWRlZmluZScpO1xudmFyIGZhaWxzID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL2ZhaWxzJyk7XG52YXIgc2V0SW50ZXJuYWxTdGF0ZSA9IHJlcXVpcmUoJy4uL2ludGVybmFscy9pbnRlcm5hbC1zdGF0ZScpLnNldDtcbnZhciBzZXRTcGVjaWVzID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3NldC1zcGVjaWVzJyk7XG52YXIgd2VsbEtub3duU3ltYm9sID0gcmVxdWlyZSgnLi4vaW50ZXJuYWxzL3dlbGwta25vd24tc3ltYm9sJyk7XG5cbnZhciBNQVRDSCA9IHdlbGxLbm93blN5bWJvbCgnbWF0Y2gnKTtcbnZhciBOYXRpdmVSZWdFeHAgPSBnbG9iYWwuUmVnRXhwO1xudmFyIFJlZ0V4cFByb3RvdHlwZSA9IE5hdGl2ZVJlZ0V4cC5wcm90b3R5cGU7XG52YXIgcmUxID0gL2EvZztcbnZhciByZTIgPSAvYS9nO1xuXG4vLyBcIm5ld1wiIHNob3VsZCBjcmVhdGUgYSBuZXcgb2JqZWN0LCBvbGQgd2Via2l0IGJ1Z1xudmFyIENPUlJFQ1RfTkVXID0gbmV3IE5hdGl2ZVJlZ0V4cChyZTEpICE9PSByZTE7XG5cbnZhciBVTlNVUFBPUlRFRF9ZID0gc3RpY2t5SGVscGVycy5VTlNVUFBPUlRFRF9ZO1xuXG52YXIgRk9SQ0VEID0gREVTQ1JJUFRPUlMgJiYgaXNGb3JjZWQoJ1JlZ0V4cCcsICghQ09SUkVDVF9ORVcgfHwgVU5TVVBQT1JURURfWSB8fCBmYWlscyhmdW5jdGlvbiAoKSB7XG4gIHJlMltNQVRDSF0gPSBmYWxzZTtcbiAgLy8gUmVnRXhwIGNvbnN0cnVjdG9yIGNhbiBhbHRlciBmbGFncyBhbmQgSXNSZWdFeHAgd29ya3MgY29ycmVjdCB3aXRoIEBAbWF0Y2hcbiAgcmV0dXJuIE5hdGl2ZVJlZ0V4cChyZTEpICE9IHJlMSB8fCBOYXRpdmVSZWdFeHAocmUyKSA9PSByZTIgfHwgTmF0aXZlUmVnRXhwKHJlMSwgJ2knKSAhPSAnL2EvaSc7XG59KSkpO1xuXG4vLyBgUmVnRXhwYCBjb25zdHJ1Y3RvclxuLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtcmVnZXhwLWNvbnN0cnVjdG9yXG5pZiAoRk9SQ0VEKSB7XG4gIHZhciBSZWdFeHBXcmFwcGVyID0gZnVuY3Rpb24gUmVnRXhwKHBhdHRlcm4sIGZsYWdzKSB7XG4gICAgdmFyIHRoaXNJc1JlZ0V4cCA9IHRoaXMgaW5zdGFuY2VvZiBSZWdFeHBXcmFwcGVyO1xuICAgIHZhciBwYXR0ZXJuSXNSZWdFeHAgPSBpc1JlZ0V4cChwYXR0ZXJuKTtcbiAgICB2YXIgZmxhZ3NBcmVVbmRlZmluZWQgPSBmbGFncyA9PT0gdW5kZWZpbmVkO1xuICAgIHZhciBzdGlja3k7XG5cbiAgICBpZiAoIXRoaXNJc1JlZ0V4cCAmJiBwYXR0ZXJuSXNSZWdFeHAgJiYgcGF0dGVybi5jb25zdHJ1Y3RvciA9PT0gUmVnRXhwV3JhcHBlciAmJiBmbGFnc0FyZVVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHBhdHRlcm47XG4gICAgfVxuXG4gICAgaWYgKENPUlJFQ1RfTkVXKSB7XG4gICAgICBpZiAocGF0dGVybklzUmVnRXhwICYmICFmbGFnc0FyZVVuZGVmaW5lZCkgcGF0dGVybiA9IHBhdHRlcm4uc291cmNlO1xuICAgIH0gZWxzZSBpZiAocGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cFdyYXBwZXIpIHtcbiAgICAgIGlmIChmbGFnc0FyZVVuZGVmaW5lZCkgZmxhZ3MgPSBnZXRGbGFncy5jYWxsKHBhdHRlcm4pO1xuICAgICAgcGF0dGVybiA9IHBhdHRlcm4uc291cmNlO1xuICAgIH1cblxuICAgIGlmIChVTlNVUFBPUlRFRF9ZKSB7XG4gICAgICBzdGlja3kgPSAhIWZsYWdzICYmIGZsYWdzLmluZGV4T2YoJ3knKSA+IC0xO1xuICAgICAgaWYgKHN0aWNreSkgZmxhZ3MgPSBmbGFncy5yZXBsYWNlKC95L2csICcnKTtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gaW5oZXJpdElmUmVxdWlyZWQoXG4gICAgICBDT1JSRUNUX05FVyA/IG5ldyBOYXRpdmVSZWdFeHAocGF0dGVybiwgZmxhZ3MpIDogTmF0aXZlUmVnRXhwKHBhdHRlcm4sIGZsYWdzKSxcbiAgICAgIHRoaXNJc1JlZ0V4cCA/IHRoaXMgOiBSZWdFeHBQcm90b3R5cGUsXG4gICAgICBSZWdFeHBXcmFwcGVyXG4gICAgKTtcblxuICAgIGlmIChVTlNVUFBPUlRFRF9ZICYmIHN0aWNreSkgc2V0SW50ZXJuYWxTdGF0ZShyZXN1bHQsIHsgc3RpY2t5OiBzdGlja3kgfSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICB2YXIgcHJveHkgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAga2V5IGluIFJlZ0V4cFdyYXBwZXIgfHwgZGVmaW5lUHJvcGVydHkoUmVnRXhwV3JhcHBlciwga2V5LCB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE5hdGl2ZVJlZ0V4cFtrZXldOyB9LFxuICAgICAgc2V0OiBmdW5jdGlvbiAoaXQpIHsgTmF0aXZlUmVnRXhwW2tleV0gPSBpdDsgfVxuICAgIH0pO1xuICB9O1xuICB2YXIga2V5cyA9IGdldE93blByb3BlcnR5TmFtZXMoTmF0aXZlUmVnRXhwKTtcbiAgdmFyIGluZGV4ID0gMDtcbiAgd2hpbGUgKGtleXMubGVuZ3RoID4gaW5kZXgpIHByb3h5KGtleXNbaW5kZXgrK10pO1xuICBSZWdFeHBQcm90b3R5cGUuY29uc3RydWN0b3IgPSBSZWdFeHBXcmFwcGVyO1xuICBSZWdFeHBXcmFwcGVyLnByb3RvdHlwZSA9IFJlZ0V4cFByb3RvdHlwZTtcbiAgcmVkZWZpbmUoZ2xvYmFsLCAnUmVnRXhwJywgUmVnRXhwV3JhcHBlcik7XG59XG5cbi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLWdldC1yZWdleHAtQEBzcGVjaWVzXG5zZXRTcGVjaWVzKCdSZWdFeHAnKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2239\n")},2240:function(module,exports,__webpack_require__){eval("var api = __webpack_require__(262);\n            var content = __webpack_require__(2241);\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.i, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0MC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvc3JjL3ZlbmRvci9kM3RpcC5jc3M/NmZiMCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBpID0gcmVxdWlyZShcIiEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIik7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHJlcXVpcmUoXCIhIS4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzPz9yZWYtLTYtMSEuLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvcG9zdGNzcy1sb2FkZXIvc3JjL2luZGV4LmpzPz9wb3N0Y3NzIS4vZDN0aXAuY3NzXCIpO1xuXG4gICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5fX2VzTW9kdWxlID8gY29udGVudC5kZWZhdWx0IDogY29udGVudDtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBjb250ZW50ID0gW1ttb2R1bGUuaWQsIGNvbnRlbnQsICcnXV07XG4gICAgICAgICAgICB9XG5cbnZhciBvcHRpb25zID0ge307XG5cbm9wdGlvbnMuaW5zZXJ0ID0gXCJoZWFkXCI7XG5vcHRpb25zLnNpbmdsZXRvbiA9IGZhbHNlO1xuXG52YXIgdXBkYXRlID0gYXBpKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG52YXIgZXhwb3J0ZWQgPSBjb250ZW50LmxvY2FscyA/IGNvbnRlbnQubG9jYWxzIDoge307XG5cblxuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydGVkOyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///2240\n")},2241:function(module,exports,__webpack_require__){eval("// Imports\nvar ___CSS_LOADER_API_IMPORT___ = __webpack_require__(263);\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.i, \"/**\\n * Licensed to the Apache Software Foundation (ASF) under one\\n * or more contributor license agreements.  See the NOTICE file\\n * distributed with this work for additional information\\n * regarding copyright ownership.  The ASF licenses this file\\n * to you under the Apache License, Version 2.0 (the\\n * \\\"License\\\"); you may not use this file except in compliance\\n * with the License.  You may obtain a copy of the License at\\n *\\n *   http://www.apache.org/licenses/LICENSE-2.0\\n *\\n * Unless required by applicable law or agreed to in writing,\\n * software distributed under the License is distributed on an\\n * \\\"AS IS\\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\\n * KIND, either express or implied.  See the License for the\\n * specific language governing permissions and limitations\\n * under the License.\\n */\\n/* from d3-tip */\\n.d3-tip {\\n  line-height: 1;\\n  padding: 12px;\\n  background: rgba(0, 0, 0, 0.8);\\n  color: #fff;\\n  border-radius: 2px;\\n  pointer-events: none;\\n  z-index: 1000;\\n}\\n\\n/* Creates a small triangle extender for the tooltip */\\n.d3-tip:after {\\n  box-sizing: border-box;\\n  display: inline;\\n  font-size: 10px;\\n  width: 100%;\\n  line-height: 1;\\n  color: rgba(0, 0, 0, 0.8);\\n  position: absolute;\\n  pointer-events: none;\\n}\\n\\n/* Northward tooltips */\\n.d3-tip.n:after {\\n  content: '\\\\25BC';\\n  margin: -1px 0 0 0;\\n  top: 100%;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Eastward tooltips */\\n.d3-tip.e:after {\\n  content: '\\\\25C0';\\n  margin: -4px 0 0 0;\\n  top: 50%;\\n  left: -8px;\\n}\\n\\n/* Southward tooltips */\\n.d3-tip.s:after {\\n  content: '\\\\25B2';\\n  margin: 0 0 1px 0;\\n  top: -8px;\\n  left: 0;\\n  text-align: center;\\n}\\n\\n/* Westward tooltips */\\n.d3-tip.w:after {\\n  content: '\\\\25B6';\\n  margin: -4px 0 0 -1px;\\n  top: 50%;\\n  left: 100%;\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjI0MS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvc3JjL3ZlbmRvci9kM3RpcC5jc3M/YzJhMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBvcnRzXG52YXIgX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIik7XG5leHBvcnRzID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKGZhbHNlKTtcbi8vIE1vZHVsZVxuZXhwb3J0cy5wdXNoKFttb2R1bGUuaWQsIFwiLyoqXFxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXFxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcXG4gKiBcXFwiTGljZW5zZVxcXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXFxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxcbiAqXFxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcXG4gKlxcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxcbiAqIFxcXCJBUyBJU1xcXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cXG4gKi9cXG4vKiBmcm9tIGQzLXRpcCAqL1xcbi5kMy10aXAge1xcbiAgbGluZS1oZWlnaHQ6IDE7XFxuICBwYWRkaW5nOiAxMnB4O1xcbiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgpO1xcbiAgY29sb3I6ICNmZmY7XFxuICBib3JkZXItcmFkaXVzOiAycHg7XFxuICBwb2ludGVyLWV2ZW50czogbm9uZTtcXG4gIHotaW5kZXg6IDEwMDA7XFxufVxcblxcbi8qIENyZWF0ZXMgYSBzbWFsbCB0cmlhbmdsZSBleHRlbmRlciBmb3IgdGhlIHRvb2x0aXAgKi9cXG4uZDMtdGlwOmFmdGVyIHtcXG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XFxuICBkaXNwbGF5OiBpbmxpbmU7XFxuICBmb250LXNpemU6IDEwcHg7XFxuICB3aWR0aDogMTAwJTtcXG4gIGxpbmUtaGVpZ2h0OiAxO1xcbiAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC44KTtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIHBvaW50ZXItZXZlbnRzOiBub25lO1xcbn1cXG5cXG4vKiBOb3J0aHdhcmQgdG9vbHRpcHMgKi9cXG4uZDMtdGlwLm46YWZ0ZXIge1xcbiAgY29udGVudDogJ1xcXFwyNUJDJztcXG4gIG1hcmdpbjogLTFweCAwIDAgMDtcXG4gIHRvcDogMTAwJTtcXG4gIGxlZnQ6IDA7XFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxufVxcblxcbi8qIEVhc3R3YXJkIHRvb2x0aXBzICovXFxuLmQzLXRpcC5lOmFmdGVyIHtcXG4gIGNvbnRlbnQ6ICdcXFxcMjVDMCc7XFxuICBtYXJnaW46IC00cHggMCAwIDA7XFxuICB0b3A6IDUwJTtcXG4gIGxlZnQ6IC04cHg7XFxufVxcblxcbi8qIFNvdXRod2FyZCB0b29sdGlwcyAqL1xcbi5kMy10aXAuczphZnRlciB7XFxuICBjb250ZW50OiAnXFxcXDI1QjInO1xcbiAgbWFyZ2luOiAwIDAgMXB4IDA7XFxuICB0b3A6IC04cHg7XFxuICBsZWZ0OiAwO1xcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xcbn1cXG5cXG4vKiBXZXN0d2FyZCB0b29sdGlwcyAqL1xcbi5kMy10aXAudzphZnRlciB7XFxuICBjb250ZW50OiAnXFxcXDI1QjYnO1xcbiAgbWFyZ2luOiAtNHB4IDAgMCAtMXB4O1xcbiAgdG9wOiA1MCU7XFxuICBsZWZ0OiAxMDAlO1xcbn1cXG5cIiwgXCJcIl0pO1xuLy8gRXhwb3J0c1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2241\n")},2494:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/react/index.js\nvar react = __webpack_require__(2);\nvar react_default = /*#__PURE__*/__webpack_require__.n(react);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/prop-types/index.js\nvar prop_types = __webpack_require__(17);\nvar prop_types_default = /*#__PURE__*/__webpack_require__.n(prop_types);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/index.ts\nvar src = __webpack_require__(3);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/style/index.ts\nvar style = __webpack_require__(536);\n\n// CONCATENATED MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/extent.js\n/* harmony default export */ var extent = (function(values, valueof) {\n  let min;\n  let max;\n  if (valueof === undefined) {\n    for (const value of values) {\n      if (value != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  }\n  return [min, max];\n});\n\n// CONCATENATED MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/range.js\n/* harmony default export */ var range = (function(start, stop, step) {\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\n\n  var i = -1,\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\n      range = new Array(n);\n\n  while (++i < n) {\n    range[i] = start + i * step;\n  }\n\n  return range;\n});\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/d3-selection/src/select.js\nvar src_select = __webpack_require__(821);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/number-format/NumberFormatterRegistrySingleton.ts\nvar NumberFormatterRegistrySingleton = __webpack_require__(132);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/time-format/TimeFormatterRegistrySingleton.ts + 5 modules\nvar TimeFormatterRegistrySingleton = __webpack_require__(120);\n\n// EXTERNAL MODULE: ../superset-ui-core/src/color/SequentialSchemeRegistrySingleton.ts\nvar SequentialSchemeRegistrySingleton = __webpack_require__(537);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.array.reverse.js\nvar es_array_reverse = __webpack_require__(1856);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.regexp.constructor.js\nvar es_regexp_constructor = __webpack_require__(2239);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.regexp.to-string.js\nvar es_regexp_to_string = __webpack_require__(99);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(266);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.string.split.js\nvar es_string_split = __webpack_require__(806);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/es.string.trim.js\nvar es_string_trim = __webpack_require__(1136);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(47);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/node_modules/d3-tip/index.js\nvar d3_tip = __webpack_require__(817);\n\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/d3tip.css\nvar d3tip = __webpack_require__(2240);\n\n// CONCATENATED MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js\n// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */ /* eslint-disable */var d3= true?__webpack_require__(137):undefined,d3= true?__webpack_require__(137):undefined,CalHeatMap=function(){\'use strict\';var self=this;self.tip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>"\\n      ".concat(self.options.timeFormatter(d.t),": <strong>").concat(self.options.valueFormatter(d.v),"</strong>\\n    "));self.legendTip=Object(d3_tip["a" /* default */])().attr("class","d3-tip").direction("n").offset([-5,0]).html(d=>self.options.valueFormatter(d));this.allowedDataType=["json","csv","tsv","txt"];// Default settings\nthis.options={// selector string of the container to append the graph to\n// Accept any string value accepted by document.querySelector or CSS3\n// or an Element object\nitemSelector:"#cal-heatmap",// Whether to paint the calendar on init()\n// Used by testsuite to reduce testing time\npaintOnLoad:!0,// ================================================\n// DOMAIN\n// ================================================\n// Number of domain to display on the graph\nrange:12,// Size of each cell, in pixel\ncellSize:10,// Padding between each cell, in pixel\ncellPadding:2,// For rounded subdomain rectangles, in pixels\ncellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:d=>d,timeFormatter:d=>d,domain:"hour",subDomain:"min",// Number of columns to split the subDomains to\n// If not null, will takes precedence over rowLimit\ncolLimit:null,// Number of rows to split the subDomains to\n// Will be ignored if colLimit is not null\nrowLimit:null,// First day of the week is Monday\n// 0 to start the week on Sunday\nweekStartOnMonday:!0,// Start date of the graph\n// @default now\nstart:new Date,minDate:null,maxDate:null,// ================================================\n// DATA\n// ================================================\n// Data source\n// URL, where to fetch the original datas\ndata:"",// Data type\n// Default: json\ndataType:this.allowedDataType[0],// Payload sent when using POST http method\n// Leave to null (default) for GET request\n// Expect a string, formatted like "a=b;c=d"\ndataPostPayload:null,// Additional headers sent when requesting data\n// Expect an object formatted like:\n// { \'X-CSRF-TOKEN\': \'token\' }\ndataRequestHeaders:null,// Whether to consider missing date:value from the datasource\n// as equal to 0, or just leave them as missing\nconsiderMissingDataAsZero:!1,// Load remote data on calendar creation\n// When false, the calendar will be left empty\nloadOnInit:!0,// Calendar orientation\n// false: display domains side by side\n// true : display domains one under the other\nverticalOrientation:!1,// Domain dynamic width/height\n// The width on a domain depends on the number of\ndomainDynamicDimension:!0,// Domain Label properties\nlabel:{// valid: top, right, bottom, left\nposition:"bottom",// Valid: left, center, right\n// Also valid are the direct svg values: start, middle, end\nalign:"center",// By default, there is no margin/padding around the label\noffset:{x:0,y:0},rotate:null,// Used only on vertical orientation\nwidth:100,// Used only on horizontal orientation\nheight:null},// ================================================\n// LEGEND\n// ================================================\n// Threshold for the legend\nlegend:[10,20,30,40],// Whether to display the legend\ndisplayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],// Legend vertical position\n// top: place legend above calendar\n// bottom: place legend below the calendar\nlegendVerticalPosition:"bottom",// Legend horizontal position\n// accepted values: left, center, right\nlegendHorizontalPosition:"left",// Legend rotation\n// accepted values: horizontal, vertical\nlegendOrientation:"horizontal",// Objects holding all the heatmap different colors\n// null to disable, and use the default css styles\n//\n// Examples:\n// legendColors: {\n//    min: "green",\n//    max: "red",\n//    empty: "#ffffff",\n//    base: "grey",\n//    overflow: "red",\n//    colorScaler: null,\n// }\nlegendColors:null,// ================================================\n// HIGHLIGHT\n// ================================================\n// List of dates to highlight\n// Valid values:\n// - []: don\'t highlight anything\n// - "now": highlight the current date\n// - an array of Date objects: highlight the specified dates\nhighlight:[],// ================================================\n// TEXT FORMATTING / i18n\n// ================================================\n// Name of the items to represent in the calendar\nitemName:["item","items"],// Formatting of the domain label\n// @default: null, will use the formatting according to domain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\ndomainLabelFormat:null,// Formatting of the title displayed when hovering a subDomain cell\nsubDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},// Formatting of the {date} used in subDomainTitleFormat\n// @default: null, will use the formatting according to subDomain type\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainDateFormat:null,// Formatting of the text inside each subDomain cell\n// @default: null, no text\n// Accept a string used as specifier by d3.time.format()\n// or a function\n//\n// Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n// for accepted date formatting used by d3.time.format()\nsubDomainTextFormat:null,// Formatting of the title displayed when hovering a legend cell\nlegendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},// Animation duration, in ms\nanimationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,// ================================================\n// EVENTS CALLBACK\n// ================================================\n// Callback when clicking on a time block\nonClick:null,// Callback after painting the empty calendar\n// Can be used to trigger an API call, once the calendar is ready to be filled\nafterLoad:null,// Callback after loading the next domain in the calendar\nafterLoadNextDomain:null,// Callback after loading the previous domain in the calendar\nafterLoadPreviousDomain:null,// Callback after finishing all actions on the calendar\nonComplete:null,// Callback after fetching the datas, but before applying them to the calendar\n// Used mainly to convert the datas if they\'re not formatted like expected\n// Takes the fetched "data" object as argument, must return a json object\n// formatted like {timestamp:count, timestamp2:count2},\nafterLoadData:function afterLoadData(data){return data},// Callback triggered after calling and completing update().\nafterUpdate:null,// Callback triggered after calling next().\n// The `status` argument is equal to true if there is no\n// more next domain to load\n//\n// This callback is also executed once, after calling previous(),\n// only when the max domain is reached\nonMaxDomainReached:null,// Callback triggered after calling previous().\n// The `status` argument is equal to true if there is no\n// more previous domain to load\n//\n// This callback is also executed once, after calling next(),\n// only when the min domain is reached\nonMinDomainReached:null};this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){return Math.floor(d.getMinutes()/self._domainType.min.row(d))},y:function y(d){return d.getMinutes()%self._domainType.min.row(d)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function maxItemNumber(d){switch(self.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(self.options.domainDynamicDimension?self.getDayCountInMonth(d):31);}},defaultRowNumber:6,defaultColumnNumber:function defaultColumnNumber(d){switch(self.options.domain){case"day":return 4;case"week":return 28;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;}},row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){if("month"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*(d.getDate()-1))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*(d.getDate()-1)}else if("week"===self.options.domain){if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getHours()+24*self.getWeekDay(d))/self._domainType.hour.row(d))}return Math.floor(d.getHours()/self._domainType.hour.row(d))+4*self.getWeekDay(d)}return Math.floor(d.getHours()/self._domainType.hour.row(d))},y:function y(d){var p=d.getHours();if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"month":p+=24*(d.getDate()-1);break;case"week":p+=24*self.getWeekDay(d);break;}}return Math.floor(p%self._domainType.hour.row(d))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function maxItemNumber(d){switch(self.options.domain){case"week":return 7;case"month":return self.options.domainDynamicDimension?self.getDayCountInMonth(d):31;case"year":return self.options.domainDynamicDimension?self.getDayCountInYear(d):366;}},defaultColumnNumber:function defaultColumnNumber(d){d=new Date(d);switch(self.options.domain){case"week":return 1;case"month":return self.options.domainDynamicDimension&&!self.options.verticalOrientation?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d)+1:6;case"year":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),11,31))-self.getWeekNumber(new Date(d.getFullYear(),0))+1:54;}},defaultRowNumber:7,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){switch(self.options.domain){case"week":return Math.floor(self.getWeekDay(d)/self._domainType.day.row(d));case"month":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((d.getDate()-1)/self._domainType.day.row(d))}return self.getWeekNumber(d)-self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));case"year":if(0<self.options.colLimit||0<self.options.rowLimit){return Math.floor((self.getDayOfYear(d)-1)/self._domainType.day.row(d))}return self.getWeekNumber(d);}},y:function y(d){var p=self.getWeekDay(d);if(0<self.options.colLimit||0<self.options.rowLimit){switch(self.options.domain){case"year":p=self.getDayOfYear(d)-1;break;case"week":p=self.getWeekDay(d);break;case"month":p=d.getDate()-1;break;}}return Math.floor(p%self._domainType.day.row(d))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function defaultColumnNumber(d){d=new Date(d);switch(self.options.domain){case"year":return self._domainType.week.maxItemNumber;case"month":return self.options.domainDynamicDimension?self.getWeekNumber(new Date(d.getFullYear(),d.getMonth()+1,0))-self.getWeekNumber(d):5;}},defaultRowNumber:1,row:function row(d){return self.getSubDomainRowNumber(d)},column:function column(d){return self.getSubDomainColumnNumber(d)},position:{x:function x(d){switch(self.options.domain){case"year":return Math.floor(self.getWeekNumber(d)/self._domainType.week.row(d));case"month":return Math.floor(self.getMonthWeekNumber(d)/self._domainType.week.row(d));}},y:function y(d){return self.getWeekNumber(d)%self._domainType.week.row(d)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function extractUnit(d){var dt=new Date(d.getFullYear(),d.getMonth(),d.getDate()),weekDay=dt.getDay()-(self.options.weekStartOnMonday?1:0);// According to ISO-8601, week number computation are based on week starting on Monday\nif(0>weekDay){weekDay=6}dt.setDate(dt.getDate()-weekDay);return dt.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function row(){return self.getSubDomainRowNumber()},column:function column(){return self.getSubDomainColumnNumber()},position:{x:function x(d){return Math.floor(d.getMonth()/self._domainType.month.row(d))},y:function y(d){return d.getMonth()%self._domainType.month.row(d)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function extractUnit(d){return new Date(d.getFullYear(),d.getMonth()).getTime()}},year:{name:"year",level:60,row:function row(){return self.options.rowLimit||1},column:function column(){return self.options.colLimit||1},position:{x:function x(){return 1},y:function y(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function extractUnit(d){return new Date(d.getFullYear()).getTime()}}};for(var type in this._domainType){if(this._domainType.hasOwnProperty(type)){var d=this._domainType[type];this._domainType["x_"+type]={name:"x_"+type,level:d.type,maxItemNumber:d.maxItemNumber,defaultRowNumber:d.defaultRowNumber,defaultColumnNumber:d.defaultColumnNumber,row:d.column,column:d.row,position:{x:d.position.y,y:d.position.x},format:d.format,extractUnit:d.extractUnit}}}// Record the address of the last inserted domain when browsing\nthis.lastInsertedSvg=null;this._completed=!1;// Record all the valid domains\n// Each domain value is a timestamp in milliseconds\nthis._domains=d3.map();this.graphDim={width:0,height:0};this.legendDim={width:0,height:0};this.NAVIGATE_LEFT=1;this.NAVIGATE_RIGHT=2;// Various update mode when using the update() API\nthis.RESET_ALL_ON_UPDATE=0;this.RESET_SINGLE_ON_UPDATE=1;this.APPEND_ON_UPDATE=2;this.DEFAULT_LEGEND_MARGIN=10;this.root=null;this.tooltip=null;this._maxDomainReached=!1;this._minDomainReached=!1;this.domainPosition=new DomainPosition;this.Legend=null;this.legendScale=null;// List of domains that are skipped because of DST\n// All times belonging to these domains should be re-assigned to the previous domain\nthis.DSTDomain=[];/**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */this._init=function(){self.getDomain(self.options.start).map(function(d){return d.getTime()}).map(function(d){self._domains.set(d,self.getSubDomain(d).map(function(d){return{t:self._domainType[self.options.subDomain].extractUnit(d),v:null}}))});self.root=d3.select(self.options.itemSelector).append("svg").attr("class","cal-heatmap-container");self.root.attr("x",0).attr("y",0).append("svg").attr("class","graph");self.Legend=new Legend(self);if(self.options.paintOnLoad){_initCalendar()}self.root.call(self.tip);self.root.call(self.legendTip);return!0};function _initCalendar(){self.verticalDomainLabel="top"===self.options.label.position||"bottom"===self.options.label.position;self.domainVerticalLabelHeight=null===self.options.label.height?Math.max(25,2*self.options.cellSize):self.options.label.height;self.domainHorizontalLabelWidth=0;if(""===self.options.domainLabelFormat&&null===self.options.label.height){self.domainVerticalLabelHeight=0}if(!self.verticalDomainLabel){self.domainVerticalLabelHeight=0;self.domainHorizontalLabelWidth=self.options.label.width}self.paint();// =========================================================================//\n// ATTACHING DOMAIN NAVIGATION EVENT                    //\n// =========================================================================//\nif(!1!==self.options.nextSelector){d3.select(self.options.nextSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadNextDomain(1)})}if(!1!==self.options.previousSelector){d3.select(self.options.previousSelector).on("click."+self.options.itemNamespace,function(){d3.event.preventDefault();return self.loadPreviousDomain(1)})}self.Legend.redraw(self.graphDim.width-self.options.domainGutter-self.options.cellPadding);self.afterLoad();var domains=self.getDomainKeys();// Fill the graph with some datas\nif(self.options.loadOnInit){self.getDatas(self.options.data,new Date(domains[0]),self.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.onComplete()})}else{self.onComplete()}self.checkIfMinDomainIsReached(domains[0]);self.checkIfMaxDomainIsReached(self.getNextDomain().getTime())}// Return the width of the domain block, without the domain gutter\n// @param int d Domain start timestamp\nfunction w(d,outer){var width=self.options.cellSize*self._domainType[self.options.subDomain].column(d)+self.options.cellPadding*self._domainType[self.options.subDomain].column(d);if(2===arguments.length&&!0===outer){return width+=self.domainHorizontalLabelWidth+self.options.domainGutter+self.options.domainMargin[1]+self.options.domainMargin[3]}return width}// Return the height of the domain block, without the domain gutter\nfunction h(d,outer){var height=self.options.cellSize*self._domainType[self.options.subDomain].row(d)+self.options.cellPadding*self._domainType[self.options.subDomain].row(d);if(2===arguments.length&&!0===outer){height+=self.options.domainGutter+self.domainVerticalLabelHeight+self.options.domainMargin[0]+self.options.domainMargin[2]}return height}/**\n   *\n   *\n   * @param int navigationDir\n   */this.paint=function(navigationDir){var options=self.options;if(0===arguments.length){navigationDir=!1}// Painting all the domains\nvar domainSvg=self.root.select(".graph").selectAll(".graph-domain").data(function(){var data=self.getDomainKeys();return navigationDir===self.NAVIGATE_LEFT?data.reverse():data},function(d){return d}),enteringDomainDim=0,exitingDomainDim=0,svg=domainSvg.enter().append("svg").attr("width",function(d){return w(d,!0)}).attr("height",function(d){return h(d,!0)}).attr("x",function(d){if(options.verticalOrientation){self.graphDim.width=Math.max(self.graphDim.width,w(d,!0));return 0}else{return getDomainPosition(d,self.graphDim,"width",w(d,!0))}}).attr("y",function(d){if(options.verticalOrientation){return getDomainPosition(d,self.graphDim,"height",h(d,!0))}else{self.graphDim.height=Math.max(self.graphDim.height,h(d,!0));return 0}}).attr("class",function(d){var classname="graph-domain",date=new Date(d);switch(options.domain){case"hour":classname+=" h_"+date.getHours();/* falls through */case"day":classname+=" d_"+date.getDate()+" dy_"+date.getDay();/* falls through */case"week":classname+=" w_"+self.getWeekNumber(date);/* falls through */case"month":classname+=" m_"+(date.getMonth()+1);/* falls through */case"year":classname+=" y_"+date.getFullYear();}return classname});self.lastInsertedSvg=svg;function getDomainPosition(domainIndex,graphDim,axis,domainDim){var tmp=0;switch(navigationDir){case!1:tmp=graphDim[axis];graphDim[axis]+=domainDim;self.domainPosition.setPosition(domainIndex,tmp);return tmp;case self.NAVIGATE_RIGHT:self.domainPosition.setPosition(domainIndex,graphDim[axis]);enteringDomainDim=domainDim;exitingDomainDim=self.domainPosition.getPositionFromIndex(1);self.domainPosition.shiftRightBy(exitingDomainDim);return graphDim[axis];case self.NAVIGATE_LEFT:tmp=-domainDim;enteringDomainDim=-tmp;exitingDomainDim=graphDim[axis]-self.domainPosition.getLast();self.domainPosition.setPosition(domainIndex,tmp);self.domainPosition.shiftLeftBy(enteringDomainDim);return tmp;}}svg.append("rect").attr("width",function(d){return w(d,!0)-options.domainGutter-options.cellPadding}).attr("height",function(d){return h(d,!0)-options.domainGutter-options.cellPadding}).attr("class","domain-background");// =========================================================================//\n// PAINTING SUBDOMAINS                            //\n// =========================================================================//\nvar subDomainSvgGroup=svg.append("svg").attr("x",function(){if("left"===options.label.position){return self.domainHorizontalLabelWidth+options.domainMargin[3]}else{return options.domainMargin[3]}}).attr("y",function(){if("top"===options.label.position){return self.domainVerticalLabelHeight+options.domainMargin[0]}else{return options.domainMargin[0]}}).attr("class","graph-subdomain-group"),rect=subDomainSvgGroup.selectAll("g").data(function(d){return self._domains.get(d)}).enter().append("g");rect.append("rect").attr("class",function(d){return"graph-rect"+self.getHighlightClassName(d.t)+(null!==options.onClick?" hover_cursor":"")}).attr("width",options.cellSize).attr("height",options.cellSize).attr("x",function(d){return self.positionSubDomainX(d.t)}).attr("y",function(d){return self.positionSubDomainY(d.t)}).on("click",function(d){if(null!==options.onClick){return self.onClick(new Date(d.t),d.v)}}).call(function(selection){if(0<options.cellRadius){selection.attr("rx",options.cellRadius).attr("ry",options.cellRadius)}if(null!==self.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}if(options.tooltip){selection.on("mouseover",function(d){self.tip.show(d,this)}).on("mouseout",function(){self.tip.hide(d)})}});// Appending a title to each subdomain\nif(!options.tooltip){rect.append("title").text(function(d){return self.formatDate(new Date(d.t),options.subDomainDateFormat)})}// =========================================================================//\n// PAINTING LABEL                              //\n// =========================================================================//\nif(""!==options.domainLabelFormat){svg.append("text").attr("class","graph-label").attr("y",function(d){var y=options.domainMargin[0];switch(options.label.position){case"top":y+=self.domainVerticalLabelHeight/2;break;case"bottom":y+=h(d)+self.domainVerticalLabelHeight/2;}return y+options.label.offset.y*("right"===options.label.rotate&&"right"===options.label.position||"left"===options.label.rotate&&"left"===options.label.position?-1:1)}).attr("x",function(d){var x=options.domainMargin[3];switch(options.label.position){case"right":x+=w(d);break;case"bottom":case"top":x+=w(d)/2;}if("right"===options.label.align){return x+self.domainHorizontalLabelWidth-options.label.offset.x*("right"===options.label.rotate?-1:1)}return x+options.label.offset.x}).attr("text-anchor",function(){switch(options.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle";}}).attr("dominant-baseline",function(){return self.verticalDomainLabel?"middle":"top"}).text(function(d){return self.formatDate(new Date(d),options.domainLabelFormat)}).call(domainRotate)}function domainRotate(selection){switch(options.label.rotate){case"right":selection.attr("transform",function(d){var s="rotate(90), ";switch(options.label.position){case"right":s+="translate(-"+w(d)+" , -"+w(d)+")";break;case"left":s+="translate(0, -"+self.domainHorizontalLabelWidth+")";break;}return s});break;case"left":selection.attr("transform",function(d){var s="rotate(270), ";switch(options.label.position){case"right":s+="translate(-"+(w(d)+self.domainHorizontalLabelWidth)+" , "+w(d)+")";break;case"left":s+="translate(-"+self.domainHorizontalLabelWidth+" , "+self.domainHorizontalLabelWidth+")";break;}return s});break;}}// =========================================================================//\n// PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n// =========================================================================//\nif(null!==options.subDomainTextFormat){rect.append("text").attr("class",function(d){return"subdomain-text"+self.getHighlightClassName(d.t)}).attr("x",function(d){return self.positionSubDomainX(d.t)+options.cellSize/2}).attr("y",function(d){return self.positionSubDomainY(d.t)+options.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(d){return self.formatDate(new Date(d.t),options.subDomainTextFormat)})}// =========================================================================//\n// ANIMATION                                //\n// =========================================================================//\nif(!1!==navigationDir){domainSvg.transition().duration(options.animationDuration).attr("x",function(d){return options.verticalOrientation?0:self.domainPosition.getPosition(d)}).attr("y",function(d){return options.verticalOrientation?self.domainPosition.getPosition(d):0})}var tempWidth=self.graphDim.width,tempHeight=self.graphDim.height;if(options.verticalOrientation){self.graphDim.height+=enteringDomainDim-exitingDomainDim}else{self.graphDim.width+=enteringDomainDim-exitingDomainDim}// At the time of exit, domainsWidth and domainsHeight already automatically shifted\ndomainSvg.exit().transition().duration(options.animationDuration).attr("x",function(d){if(options.verticalOrientation){return 0}else{switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.width,tempWidth);case self.NAVIGATE_RIGHT:return-w(d,!0);}}}).attr("y",function(d){if(options.verticalOrientation){switch(navigationDir){case self.NAVIGATE_LEFT:return Math.min(self.graphDim.height,tempHeight);case self.NAVIGATE_RIGHT:return-h(d,!0);}}else{return 0}}).remove();// Resize the root container\nself.resize()}};CalHeatMap.prototype={/**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */ /* jshint maxstatements:false */init:function init(settings){\'use strict\';var parent=this,options=parent.options=mergeRecursive(parent.options,settings);// Fatal errors\n// Stop script execution on error\n(/**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */function(){if(!parent._domainType.hasOwnProperty(options.domain)||"min"===options.domain||"x_"===options.domain.substring(0,2)){throw new Error("The domain \'"+options.domain+"\' is not valid")}if(!parent._domainType.hasOwnProperty(options.subDomain)||"year"===options.subDomain){throw new Error("The subDomain \'"+options.subDomain+"\' is not valid")}if(parent._domainType[options.domain].level<=parent._domainType[options.subDomain].level){throw new Error("\'"+options.subDomain+"\' is not a valid subDomain to \'"+options.domain+"\'")}return!0}/**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */)();validateSelector(options.itemSelector,!1,"itemSelector");if(-1===parent.allowedDataType.indexOf(options.dataType)){throw new Error("The data type \'"+options.dataType+"\' is not valid data type")}if(null===d3.select(options.itemSelector)[0][0]){throw new Error("The node \'"+options.itemSelector+"\' specified in itemSelector does not exists")}try{validateSelector(options.nextSelector,!0,"nextSelector");validateSelector(options.previousSelector,!0,"previousSelector")}catch(error){console.log(error.message);return!1}// If other settings contains error, will fallback to default\nif(!settings.hasOwnProperty("subDomain")){this.options.subDomain=getOptimalSubDomain(settings.domain)}if("string"!=typeof options.itemNamespace||""===options.itemNamespace){console.log("itemNamespace can not be empty, falling back to cal-heatmap");options.itemNamespace="cal-heatmap"}// Don\'t touch these settings\nvar s=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var k in s){if(settings.hasOwnProperty(s[k])){options[s[k]]=settings[s[k]]}}options.subDomainDateFormat="string"==typeof options.subDomainDateFormat||"function"==typeof options.subDomainDateFormat?options.subDomainDateFormat:this._domainType[options.subDomain].format.date;options.domainLabelFormat="string"==typeof options.domainLabelFormat||"function"==typeof options.domainLabelFormat?options.domainLabelFormat:this._domainType[options.domain].format.legend;options.subDomainTextFormat="string"==typeof options.subDomainTextFormat&&""!==options.subDomainTextFormat||"function"==typeof options.subDomainTextFormat?options.subDomainTextFormat:null;options.domainMargin=expandMarginSetting(options.domainMargin);options.legendMargin=expandMarginSetting(options.legendMargin);options.highlight=parent.expandDateSetting(options.highlight);options.itemName=/**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */function(value){if("string"==typeof value){return[value,value+(""!==value?"s":"")]}if(Array.isArray(value)){if(1===value.length){return[value[0],value[0]+"s"]}else if(2<value.length){return value.slice(0,2)}return value}return["item","items"]}(options.itemName);options.colLimit=function(value){return 0<value?value:null}(options.colLimit);options.rowLimit=function(value){if(0<value&&0<options.colLimit){console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored");return null}return 0<value?value:null}(options.rowLimit);if(!settings.hasOwnProperty("legendMargin")){autoAddLegendMargin()}(function(){// Auto-align label, depending on it\'s position\nif(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("align")){switch(options.label.position){case"left":options.label.align="right";break;case"right":options.label.align="left";break;default:options.label.align="center";}if("left"===options.label.rotate){options.label.align="right"}else if("right"===options.label.rotate){options.label.align="left"}}if(!settings.hasOwnProperty("label")||settings.hasOwnProperty("label")&&!settings.label.hasOwnProperty("offset")){if("left"===options.label.position||"right"===options.label.position){options.label.offset={x:10,y:15}}}}/**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */)();/**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */function validateSelector(selector,canBeFalse,name){if((canBeFalse&&!1===selector||selector instanceof Element||"string"==typeof selector)&&""!==selector){return!0}throw new Error("The "+name+" is not valid")}/**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */function getOptimalSubDomain(domain){switch(domain){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min";}}function autoAddLegendMargin(){switch(options.legendVerticalPosition){case"top":options.legendMargin[2]=parent.DEFAULT_LEGEND_MARGIN;break;case"bottom":options.legendMargin[0]=parent.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":options.legendMargin["right"===options.legendHorizontalPosition?3:1]=parent.DEFAULT_LEGEND_MARGIN;}}/**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */function expandMarginSetting(value){if("number"==typeof value){value=[value]}if(!Array.isArray(value)){console.log("Margin only takes an integer or an array of integers");value=[0]}switch(value.length){case 1:return[value[0],value[0],value[0],value[0]];case 2:return[value[0],value[1],value[0],value[1]];case 3:return[value[0],value[1],value[2],value[1]];case 4:return value;default:return value.slice(0,4);}}return this._init()},/**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */expandDateSetting:function expandDateSetting(value){\'use strict\';if(!Array.isArray(value)){value=[value]}return value.map(function(data){if("now"===data){return new Date}if(data instanceof Date){return data}return!1}).filter(function(d){return!1!==d})},/**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It\'s used to limit the painting to only a subset of the calendar\n   * @return void\n   */fill:function fill(svg){\'use strict\';var parent=this,options=parent.options;if(0===arguments.length){svg=parent.root.selectAll(".graph-domain")}var rect=svg.selectAll("svg").selectAll("g").data(function(d){return parent._domains.get(d)});/**\n     * Colorize the cell via a style attribute if enabled\n     */rect.transition().duration(options.animationDuration).select("rect").attr("class",function(d){var htmlClass=parent.getHighlightClassName(d.t).trim().split(" "),pastDate=parent.dateIsLessThan(d.t,new Date),sameDate=parent.dateIsEqual(d.t,new Date);if(null===parent.legendScale||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero&&!options.legendColors.hasOwnProperty("base")){htmlClass.push("graph-rect")}if(sameDate){htmlClass.push("now")}else if(!pastDate){htmlClass.push("future")}if(null!==d.v){htmlClass.push(parent.Legend.getClass(d.v,null===parent.legendScale))}else if(options.considerMissingDataAsZero&&pastDate){htmlClass.push(parent.Legend.getClass(0,null===parent.legendScale))}if(null!==options.onClick){htmlClass.push("hover_cursor")}return htmlClass.join(" ")}).call(function(element){if(null===parent.legendScale){return!1}element.attr("fill",function(d){if(null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&!options.considerMissingDataAsZero){if(options.legendColors.hasOwnProperty("base")){return options.legendColors.base}}if(null!==options.legendColors&&options.legendColors.hasOwnProperty("empty")&&(0===d.v||null===d.v&&options.hasOwnProperty("considerMissingDataAsZero")&&options.considerMissingDataAsZero)){return options.legendColors.empty}if(0>d.v&&0<options.legend[0]&&null!==options.legendColors&&options.legendColors.hasOwnProperty("overflow")){return options.legendColors.overflow}return parent.legendScale(Math.min(d.v,options.legend[options.legend.length-1]))})});rect.transition().duration(options.animationDuration).select("title").text(function(d){return parent.getSubDomainTitle(d)});/**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */rect.transition().duration(options.animationDuration).select("text").attr("class",function(d){return"subdomain-text"+parent.getHighlightClassName(d.t)}).call(function(element){if("function"==typeof options.subDomainTextFormat){element.text(function(d){return options.subDomainTextFormat(d.t,d.v)})}})},/**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */formatStringWithObject:function formatStringWithObject(formatted,args){\'use strict\';for(var prop in args){if(args.hasOwnProperty(prop)){var regexp=new RegExp("\\\\{"+prop+"\\\\}","gi");formatted=formatted.replace(regexp,args[prop])}}return formatted},// =========================================================================//\n// EVENTS CALLBACK                              //\n// =========================================================================//\n/**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */triggerEvent:function triggerEvent(eventName,successArgs,skip){\'use strict\';if(3===arguments.length&&skip||null===this.options[eventName]){return!0}if("function"==typeof this.options[eventName]){if("function"==typeof successArgs){successArgs=successArgs()}return this.options[eventName].apply(this,successArgs)}else{console.log("Provided callback for "+eventName+" is not a function.");return!1}},/**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */onClick:function onClick(d,itemNb){\'use strict\';return this.triggerEvent("onClick",[d,itemNb])},/**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */afterLoad:function afterLoad(){\'use strict\';return this.triggerEvent("afterLoad")},/**\n   * Event triggered after completing drawing and filling the calendar\n   */onComplete:function onComplete(){\'use strict\';var response=this.triggerEvent("onComplete",[],this._completed);this._completed=!0;return response},/**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadPreviousDomain:function afterLoadPreviousDomain(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */afterLoadNextDomain:function afterLoadNextDomain(start){\'use strict\';var parent=this;return this.triggerEvent("afterLoadNextDomain",function(){var subDomain=parent.getSubDomain(start);return[subDomain.shift(),subDomain.pop()]})},/**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */onMinDomainReached:function onMinDomainReached(reached){\'use strict\';this._minDomainReached=reached;return this.triggerEvent("onMinDomainReached",[reached])},/**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */onMaxDomainReached:function onMaxDomainReached(reached){\'use strict\';this._maxDomainReached=reached;return this.triggerEvent("onMaxDomainReached",[reached])},checkIfMinDomainIsReached:function checkIfMinDomainIsReached(date,upperBound){\'use strict\';if(this.minDomainIsReached(date)){this.onMinDomainReached(!0)}if(2===arguments.length){if(this._maxDomainReached&&!this.maxDomainIsReached(upperBound)){this.onMaxDomainReached(!1)}}},checkIfMaxDomainIsReached:function checkIfMaxDomainIsReached(date,lowerBound){\'use strict\';if(this.maxDomainIsReached(date)){this.onMaxDomainReached(!0)}if(2===arguments.length){if(this._minDomainReached&&!this.minDomainIsReached(lowerBound)){this.onMinDomainReached(!1)}}},afterUpdate:function afterUpdate(){\'use strict\';return this.triggerEvent("afterUpdate")},// =========================================================================//\n// FORMATTER                                //\n// =========================================================================//\nformatNumber:d3.format(",g"),formatDate:function formatDate(d,format){\'use strict\';if(2>arguments.length){format="title"}if("function"==typeof format){return format(d)}else{var f=d3.time.format(format);return f(d)}},getSubDomainTitle:function getSubDomainTitle(d){\'use strict\';if(null===d.v&&!this.options.considerMissingDataAsZero){return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}else{var value=d.v;// Consider null as 0\nif(null===value&&this.options.considerMissingDataAsZero){value=0}return this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(value),name:this.options.itemName[1!==value?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(d.t),this.options.subDomainDateFormat)})}},// =========================================================================//\n// DOMAIN NAVIGATION                            //\n// =========================================================================//\n/**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it\'s not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */loadNextDomain:function loadNextDomain(n){\'use strict\';if(this._maxDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),n));this.afterLoadNextDomain(bound.end);this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),bound.start);return!0},/**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it\'s not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */loadPreviousDomain:function loadPreviousDomain(n){\'use strict\';if(this._minDomainReached||0===n){return!1}var bound=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-n).reverse());this.afterLoadPreviousDomain(bound.start);this.checkIfMinDomainIsReached(bound.start,bound.end);return!0},loadNewDomains:function loadNewDomains(direction,newDomains){\'use strict\';var parent=this,backward=direction===this.NAVIGATE_LEFT,i=-1,total=newDomains.length,domains=this.getDomainKeys();function buildSubDomain(d){return{t:parent._domainType[parent.options.subDomain].extractUnit(d),v:null}}// Remove out of bound domains from list of new domains to prepend\nwhile(++i<total){if(backward&&this.minDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i+1);break}if(!backward&&this.maxDomainIsReached(newDomains[i])){newDomains=newDomains.slice(0,i);break}}newDomains=newDomains.slice(-this.options.range);for(i=0,total=newDomains.length;i<total;i++){this._domains.set(newDomains[i].getTime(),this.getSubDomain(newDomains[i]).map(buildSubDomain));this._domains.remove(backward?domains.pop():domains.shift())}domains=this.getDomainKeys();if(backward){newDomains=newDomains.reverse()}this.paint(direction);this.getDatas(this.options.data,newDomains[0],this.getSubDomain(newDomains[newDomains.length-1]).pop(),function(){parent.fill(parent.lastInsertedSvg)});return{start:newDomains[backward?0:1],end:domains[domains.length-1]}},/**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */maxDomainIsReached:function maxDomainIsReached(datetimestamp){\'use strict\';return null!==this.options.maxDate&&this.options.maxDate.getTime()<datetimestamp},/**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */minDomainIsReached:function minDomainIsReached(datetimestamp){\'use strict\';return null!==this.options.minDate&&this.options.minDate.getTime()>=datetimestamp},/**\n   * Return the list of the calendar\'s domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */getDomainKeys:function getDomainKeys(){\'use strict\';return this._domains.keys().map(function(d){return parseInt(d,10)}).sort(function(a,b){return a-b})},// =========================================================================//\n// POSITIONNING                                //\n// =========================================================================//\npositionSubDomainX:function positionSubDomainX(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.x(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},positionSubDomainY:function positionSubDomainY(d){\'use strict\';var index=this._domainType[this.options.subDomain].position.y(new Date(d));return index*this.options.cellSize+index*this.options.cellPadding},getSubDomainColumnNumber:function getSubDomainColumnNumber(d){\'use strict\';if(0<this.options.rowLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.rowLimit)}var j=this._domainType[this.options.subDomain].defaultColumnNumber;if("function"==typeof j){j=j(d)}return this.options.colLimit||j},getSubDomainRowNumber:function getSubDomainRowNumber(d){\'use strict\';if(0<this.options.colLimit){var i=this._domainType[this.options.subDomain].maxItemNumber;if("function"==typeof i){i=i(d)}return Math.ceil(i/this.options.colLimit)}var j=this._domainType[this.options.subDomain].defaultRowNumber;if("function"==typeof j){j=j(d)}return this.options.rowLimit||j},/**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */getHighlightClassName:function getHighlightClassName(d){\'use strict\';d=new Date(d);if(0<this.options.highlight.length){for(var i in this.options.highlight){if(this.dateIsEqual(this.options.highlight[i],d)){return this.isNow(this.options.highlight[i])?" highlight-now":" highlight"}}}return""},/**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */isNow:function isNow(d){\'use strict\';return this.dateIsEqual(d,new Date)},/**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */ /* jshint maxcomplexity: false */dateIsEqual:function dateIsEqual(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}switch(this.options.subDomain){case"x_min":case"min":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours()&&dateA.getMinutes()===dateB.getMinutes();case"x_hour":case"hour":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate()&&dateA.getHours()===dateB.getHours();case"x_day":case"day":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth()&&dateA.getDate()===dateB.getDate();case"x_week":case"week":return dateA.getFullYear()===dateB.getFullYear()&&this.getWeekNumber(dateA)===this.getWeekNumber(dateB);case"x_month":case"month":return dateA.getFullYear()===dateB.getFullYear()&&dateA.getMonth()===dateB.getMonth();default:return!1;}},/**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */dateIsLessThan:function dateIsLessThan(dateA,dateB){\'use strict\';if(!(dateA instanceof Date)){dateA=new Date(dateA)}if(!(dateB instanceof Date)){dateB=new Date(dateB)}function normalizedMillis(date,subdomain){switch(subdomain){case"x_min":case"min":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes()).getTime();case"x_hour":case"hour":return new Date(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours()).getTime();case"x_day":case"day":return new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(date.getFullYear(),date.getMonth()).getTime();default:return date.getTime();}}return normalizedMillis(dateA,this.options.subDomain)<normalizedMillis(dateB,this.options.subDomain)},// =========================================================================//\n// DATE COMPUTATION                              //\n// =========================================================================//\n/**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */getDayOfYear:d3.time.format("%j"),/**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */getWeekNumber:function getWeekNumber(d){\'use strict\';var f=!0===this.options.weekStartOnMonday?d3.time.format("%W"):d3.time.format("%U");return f(d)},/**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */getMonthWeekNumber:function getMonthWeekNumber(d){\'use strict\';if("number"==typeof d){d=new Date(d)}var monthFirstWeekNumber=this.getWeekNumber(new Date(d.getFullYear(),d.getMonth()));return this.getWeekNumber(d)-monthFirstWeekNumber-1},/**\n   * Return the number of weeks in the dates\' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date\'s year\n   */getWeekNumberInYear:function getWeekNumberInYear(d){\'use strict\';if("number"==typeof d){d=new Date(d)}},/**\n   * Return the number of days in the date\'s month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s month\n   */getDayCountInMonth:function getDayCountInMonth(d){\'use strict\';return this.getEndOfMonth(d).getDate()},/**\n   * Return the number of days in the date\'s year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date\'s year\n   */getDayCountInYear:function getDayCountInYear(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return 1===new Date(d.getFullYear(),1,29).getMonth()?366:365},/**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */getWeekDay:function getWeekDay(d){\'use strict\';if(!1===this.options.weekStartOnMonday){return d.getDay()}return 0===d.getDay()?6:d.getDay()-1},/**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */getEndOfMonth:function getEndOfMonth(d){\'use strict\';if("number"==typeof d){d=new Date(d)}return new Date(d.getFullYear(),d.getMonth()+1,0)},/**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */jumpDate:function jumpDate(date,count,step){\'use strict\';var d=new Date(date);switch(step){case"hour":d.setHours(d.getHours()+count);break;case"day":d.setHours(d.getHours()+24*count);break;case"week":d.setHours(d.getHours()+7*(24*count));break;case"month":d.setMonth(d.getMonth()+count);break;case"year":d.setFullYear(d.getFullYear()+count);}return new Date(d)},// =========================================================================//\n// DOMAIN COMPUTATION                            //\n// =========================================================================//\n/**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */getMinuteDomain:function getMinuteDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(+start+60*(1e3*range))}return d3.time.minutes(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */getHourDomain:function getHourDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate(),range.getHours())}else{stop=new Date(start);stop.setHours(stop.getHours()+range)}var domains=d3.time.hours(Math.min(start,stop),Math.max(start,stop)),i=0,total=domains.length;// Passing from DST to standard time\n// If there are 25 hours, let\'s compress the duplicate hours\nfor(i=0;i<total;i++){if(0<i&&domains[i].getHours()===domains[i-1].getHours()){this.DSTDomain.push(domains[i].getTime());domains.splice(i,1);break}}// d3.time.hours is returning more hours than needed when changing\n// from DST to standard time, because there is really 2 hours between\n// 1am and 2am!\nif("number"==typeof range&&domains.length>Math.abs(range)){domains.splice(domains.length-1,1)}return domains},/**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */getDayDomain:function getDayDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth(),d.getDate()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth(),range.getDate())}else{stop=new Date(start);stop=new Date(stop.setDate(stop.getDate()+parseInt(range,10)))}return d3.time.days(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */getWeekDomain:function getWeekDomain(d,range){\'use strict\';var weekStart;if(!1===this.options.weekStartOnMonday){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay())}else{if(1===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate())}else if(0===d.getDay()){weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate());weekStart.setDate(weekStart.getDate()-6)}else{weekStart=new Date(d.getFullYear(),d.getMonth(),d.getDate()-d.getDay()+1)}}var endDate=new Date(weekStart),stop=range;if("object"!=typeof range){stop=new Date(endDate.setDate(endDate.getDate()+7*range))}return!0===this.options.weekStartOnMonday?d3.time.mondays(Math.min(weekStart,stop),Math.max(weekStart,stop)):d3.time.sundays(Math.min(weekStart,stop),Math.max(weekStart,stop))},/**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */getMonthDomain:function getMonthDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),d.getMonth()),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),range.getMonth())}else{stop=new Date(start);stop=stop.setMonth(stop.getMonth()+range)}return d3.time.months(Math.min(start,stop),Math.max(start,stop))},/**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */getYearDomain:function getYearDomain(d,range){\'use strict\';var start=new Date(d.getFullYear(),0),stop=null;if(range instanceof Date){stop=new Date(range.getFullYear(),0)}else{stop=new Date(d.getFullYear()+range,0)}return d3.time.years(Math.min(start,stop),Math.max(start,stop))},/**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */getDomain:function getDomain(date,range){\'use strict\';if("number"==typeof date){date=new Date(date)}if(2>arguments.length){range=this.options.range}switch(this.options.domain){case"hour":var domains=this.getHourDomain(date,range);// Case where an hour is missing, when passing from standard time to DST\n// Missing hour is perfectly acceptabl in subDomain, but not in domains\nif("number"==typeof range&&domains.length<range){if(0<range){domains.push(this.getHourDomain(domains[domains.length-1],2)[1])}else{domains.shift(this.getHourDomain(domains[0],-2)[0])}}return domains;case"day":return this.getDayDomain(date,range);case"week":return this.getWeekDomain(date,range);case"month":return this.getMonthDomain(date,range);case"year":return this.getYearDomain(date,range);}},/* jshint maxcomplexity: false */getSubDomain:function getSubDomain(date){\'use strict\';if("number"==typeof date){date=new Date(date)}var parent=this,computeDaySubDomainSize=function(date,domain){switch(domain){case"year":return parent.getDayCountInYear(date);case"month":return parent.getDayCountInMonth(date);case"week":return 7;}},computeMinSubDomainSize=function(date,domain){switch(domain){case"hour":return 60;case"day":return 1440;case"week":return 10080;}},computeHourSubDomainSize=function(date,domain){switch(domain){case"day":return 24;case"week":return 168;case"month":return 24*parent.getDayCountInMonth(date);}},computeWeekSubDomainSize=function(date,domain){if("month"===domain){var endOfMonth=new Date(date.getFullYear(),date.getMonth()+1,0),endWeekNb=parent.getWeekNumber(endOfMonth),startWeekNb=parent.getWeekNumber(new Date(date.getFullYear(),date.getMonth()));if(startWeekNb>endWeekNb){startWeekNb=0;endWeekNb++}return endWeekNb-startWeekNb+1}else if("year"===domain){return parent.getWeekNumber(new Date(date.getFullYear(),11,31))}};/**\n     * @return int\n     */switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(date,computeMinSubDomainSize(date,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(date,computeHourSubDomainSize(date,this.options.domain));case"x_day":case"day":return this.getDayDomain(date,computeDaySubDomainSize(date,this.options.domain));case"x_week":case"week":return this.getWeekDomain(date,computeWeekSubDomainSize(date,this.options.domain));case"x_month":case"month":return this.getMonthDomain(date,12);}},/**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getNextDomain:function getNextDomain(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().pop(),n,this.options.domain),1)[0]},/**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */getPreviousDomain:function getPreviousDomain(n){\'use strict\';if(0===arguments.length){n=1}return this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-n,this.options.domain),1)[0]},// =========================================================================//\n// DATAS                                  //\n// =========================================================================//\n/**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */getDatas:function getDatas(source,startDate,endDate,callback,afterLoad,updateMode){\'use strict\';var self=this;if(5>arguments.length){afterLoad=!0}if(6>arguments.length){updateMode=this.APPEND_ON_UPDATE}var _callback=function(error,data){if(!1!==afterLoad){if("function"==typeof afterLoad){data=afterLoad(data)}else if("function"==typeof self.options.afterLoadData){data=self.options.afterLoadData(data)}else{console.log("Provided callback for afterLoadData is not a function.")}}else if("csv"===self.options.dataType||"tsv"===self.options.dataType){data=this.interpretCSV(data)}self.parseDatas(data,updateMode,startDate,endDate);if("function"==typeof callback){callback()}};switch(typeof source){case"string":if(""===source){_callback(null,{});return!0}else{var url=this.parseURI(source,startDate,endDate),requestType="GET";if(null!==self.options.dataPostPayload){requestType="POST"}var payload=null;if(null!==self.options.dataPostPayload){payload=this.parseURI(self.options.dataPostPayload,startDate,endDate)}var xhr=null;switch(this.options.dataType){case"json":xhr=d3.json(url);break;case"csv":xhr=d3.csv(url);break;case"tsv":xhr=d3.tsv(url);break;case"txt":xhr=d3.text(url,"text/plain");break;}// jshint maxdepth:5\nif(null!==self.options.dataRequestHeaders){for(var header in self.options.dataRequestHeaders){if(self.options.dataRequestHeaders.hasOwnProperty(header)){xhr.header(header,self.options.dataRequestHeaders[header])}}}xhr.send(requestType,payload,_callback)}return!1;case"object":if(source===Object(source)){_callback(null,source);return!1}/* falls through */default:_callback(null,{});return!0;}},/**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */parseDatas:function parseDatas(data,updateMode,startDate,endDate){\'use strict\';if(updateMode===this.RESET_ALL_ON_UPDATE){this._domains.forEach(function(key,value){value.forEach(function(element,index,array){array[index].v=null})})}var temp={},extractTime=function(d){return d.t};/*jshint forin:false */for(var d in data){var date=new Date(1e3*d),domainUnit=this.getDomain(date)[0].getTime();// The current data belongs to a domain that was compressed\n// Compress the data for the two duplicate hours into the same hour\nif(0<=this.DSTDomain.indexOf(domainUnit)){// Re-assign all data to the first or the second duplicate hours\n// depending on which is visible\nif(this._domains.has(domainUnit-3600000)){domainUnit-=3600000}}// Skip if data is not relevant to current domain\nif(isNaN(d)||!data.hasOwnProperty(d)||!this._domains.has(domainUnit)||!(domainUnit>=+startDate&&domainUnit<+endDate)){continue}var subDomainsData=this._domains.get(domainUnit);if(!temp.hasOwnProperty(domainUnit)){temp[domainUnit]=subDomainsData.map(extractTime)}var index=temp[domainUnit].indexOf(this._domainType[this.options.subDomain].extractUnit(date));if(updateMode===this.RESET_SINGLE_ON_UPDATE){subDomainsData[index].v=data[d]}else{if(!isNaN(subDomainsData[index].v)){subDomainsData[index].v+=data[d]}else{subDomainsData[index].v=data[d]}}}},parseURI:function parseURI(str,startDate,endDate){\'use strict\';// Use a timestamp in seconds\nstr=str.replace(/\\{\\{t:start\\}\\}/g,startDate.getTime()/1e3);str=str.replace(/\\{\\{t:end\\}\\}/g,endDate.getTime()/1e3);// Use a string date, following the ISO-8601\nstr=str.replace(/\\{\\{d:start\\}\\}/g,startDate.toISOString());str=str.replace(/\\{\\{d:end\\}\\}/g,endDate.toISOString());return str},interpretCSV:function interpretCSV(data){\'use strict\';var d={},keys=Object.keys(data[0]),i,total;for(i=0,total=data.length;i<total;i++){d[data[i][keys[0]]]=+data[i][keys[1]]}return d},/**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */resize:function resize(){\'use strict\';var parent=this,options=parent.options,legendWidth=options.displayLegend?parent.Legend.getDim("width")+options.legendMargin[1]+options.legendMargin[3]:0,legendHeight=options.displayLegend?parent.Legend.getDim("height")+options.legendMargin[0]+options.legendMargin[2]:0,graphWidth=parent.graphDim.width-options.domainGutter-options.cellPadding,graphHeight=parent.graphDim.height-options.domainGutter-options.cellPadding;this.root.transition().duration(options.animationDuration).attr("width",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return graphWidth+legendWidth}return Math.max(graphWidth,legendWidth)}).attr("height",function(){if("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition){return Math.max(graphHeight,legendHeight)}return graphHeight+legendHeight});this.root.select(".graph").transition().duration(options.animationDuration).attr("y",function(){if("top"===options.legendVerticalPosition){return legendHeight}return 0}).attr("x",function(){if(("middle"===options.legendVerticalPosition||"center"===options.legendVerticalPosition)&&"left"===options.legendHorizontalPosition){return legendWidth}return 0})},// =========================================================================//\n// PUBLIC API                                //\n// =========================================================================//\n/**\n   * Shift the calendar forward\n   */next:function next(n){\'use strict\';if(0===arguments.length){n=1}return this.loadNextDomain(n)},/**\n   * Shift the calendar backward\n   */previous:function previous(n){\'use strict\';if(0===arguments.length){n=1}return this.loadPreviousDomain(n)},/**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */jumpTo:function jumpTo(date,reset){\'use strict\';if(2>arguments.length){reset=!1}var domains=this.getDomainKeys(),firstDomain=domains[0],lastDomain=domains[domains.length-1];if(date<firstDomain){return this.loadPreviousDomain(this.getDomain(firstDomain,date).length)}else{if(reset){return this.loadNextDomain(this.getDomain(firstDomain,date).length)}if(date>lastDomain){return this.loadNextDomain(this.getDomain(lastDomain,date).length)}}return!1},/**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */rewind:function rewind(){\'use strict\';this.jumpTo(this.options.start,!0)},/**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar\'s datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don\'t want to use the afterLoad() callback\n   */update:function update(dataSource,afterLoad,updateMode){\'use strict\';if(0===arguments.length){dataSource=this.options.data}if(2>arguments.length){afterLoad=!0}if(3>arguments.length){updateMode=this.RESET_ALL_ON_UPDATE}var domains=this.getDomainKeys(),self=this;this.getDatas(dataSource,new Date(domains[0]),this.getSubDomain(domains[domains.length-1]).pop(),function(){self.fill();self.afterUpdate()},afterLoad,updateMode)},/**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */setLegend:function setLegend(){\'use strict\';var oldLegend=this.options.legend.slice(0);if(1<=arguments.length&&Array.isArray(arguments[0])){this.options.legend=arguments[0]}if(2<=arguments.length){if(Array.isArray(arguments[1])&&2<=arguments[1].length){this.options.legendColors=[arguments[1][0],arguments[1][1]]}else{this.options.legendColors=arguments[1]}}if(0<arguments.length&&!arrayEquals(oldLegend,this.options.legend)||2<=arguments.length){this.Legend.buildColors();this.fill()}this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},/**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */removeLegend:function removeLegend(){\'use strict\';if(!this.options.displayLegend){return!1}this.options.displayLegend=!1;this.Legend.remove();return!0},/**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */showLegend:function showLegend(){\'use strict\';if(this.options.displayLegend){return!1}this.options.displayLegend=!0;this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding);return!0},/**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */highlight:function highlight(args){\'use strict\';if(0<(this.options.highlight=this.expandDateSetting(args)).length){this.fill();return!0}return!1},/**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */destroy:function destroy(callback){\'use strict\';this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){if("function"==typeof callback){callback()}else if("undefined"!=typeof callback){console.log("Provided callback for destroy() is not a function.")}});return null},getSVG:function getSVG(){\'use strict\';for(var styles={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},j=1,total=this.options.legend.length+1;j<=total;j++){styles[".q"+j]={}}var root=this.root,whitelistStyles=[// SVG specific properties\n"stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering",// Text Specific properties\n"text-transform","font-family","font","font-size","font-weight"],filterStyles=function(attribute,property,value){if(-1!==whitelistStyles.indexOf(property)){styles[attribute][property]=value}},getElement=function(e){return root.select(e)[0][0]};/* jshint forin:false */for(var element in styles){if(!styles.hasOwnProperty(element)){continue}var dom=getElement(element);if(null===dom){continue}// The DOM Level 2 CSS way\n/* jshint maxdepth: false */if("getComputedStyle"in window){var cs=getComputedStyle(dom,null);if(0!==cs.length){for(var i=0;i<cs.length;i++){filterStyles(element,cs.item(i),cs.getPropertyValue(cs.item(i)))}// Opera workaround. Opera doesn"t support `item`/`length`\n// on CSSStyleDeclaration.\n}else{for(var k in cs){if(cs.hasOwnProperty(k)){filterStyles(element,k,cs[k])}}}// The IE way\n}else if("currentStyle"in dom){var css=dom.currentStyle;for(var p in css){filterStyles(element,p,css[p])}}}var string="<svg xmlns=\\"http://www.w3.org/2000/svg\\" xmlns:xlink=\\"http://www.w3.org/1999/xlink\\"><style type=\\"text/css\\"><![CDATA[ ";for(var style in styles){string+=style+" {\\n";for(var l in styles[style]){string+="\\t"+l+":"+styles[style][l]+";\\n"}string+="}\\n"}string+="]]></style>";string+=new XMLSerializer().serializeToString(this.root[0][0]);string+="</svg>";return string}};// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n/**\n * Compute the position of a domain, relative to the calendar\n */var DomainPosition=function(){\'use strict\';this.positions=d3.map()};DomainPosition.prototype.getPosition=function(d){\'use strict\';return this.positions.get(d)};DomainPosition.prototype.getPositionFromIndex=function(i){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[i])};DomainPosition.prototype.getLast=function(){\'use strict\';var domains=this.getKeys();return this.positions.get(domains[domains.length-1])};DomainPosition.prototype.setPosition=function(d,dim){\'use strict\';this.positions.set(d,dim)};DomainPosition.prototype.shiftRightBy=function(exitingDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value-exitingDomainDim)});var domains=this.getKeys();this.positions.remove(domains[0])};DomainPosition.prototype.shiftLeftBy=function(enteringDomainDim){\'use strict\';this.positions.forEach(function(key,value){this.set(key,value+enteringDomainDim)});var domains=this.getKeys();this.positions.remove(domains[domains.length-1])};DomainPosition.prototype.getKeys=function(){\'use strict\';return this.positions.keys().sort(function(a,b){return parseInt(a,10)-parseInt(b,10)})};// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\nvar Legend=function(calendar){\'use strict\';this.calendar=calendar;this.computeDim();if(null!==calendar.options.legendColors){this.buildColors()}};Legend.prototype.computeDim=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.dim={width:options.legendCellSize*(options.legend.length+1)+options.legendCellPadding*options.legend.length,height:options.legendCellSize}};Legend.prototype.remove=function(){\'use strict\';this.calendar.root.select(".graph-legend").remove();this.calendar.resize()};Legend.prototype.redraw=function(width){\'use strict\';if(!this.calendar.options.displayLegend){return!1}var parent=this,calendar=this.calendar,legend=calendar.root,legendItem,options=calendar.options;// Shorter accessor for variable name mangling when minifying\nthis.computeDim();var _legend=options.legend.slice(0);_legend.push(_legend[_legend.length-1]+1);var legendElement=calendar.root.select(".graph-legend");if(null!==legendElement[0][0]){legend=legendElement;legendItem=legend.select("g").selectAll("rect").data(_legend)}else{// Creating the new legend DOM if it doesn\'t already exist\nlegend="top"===options.legendVerticalPosition?legend.insert("svg",".graph"):legend.append("svg");legend.attr("x",getLegendXPosition()).attr("y",getLegendYPosition());legendItem=legend.attr("class","graph-legend").attr("height",parent.getDim("height")).attr("width",parent.getDim("width")).append("g").selectAll().data(_legend)}legendItem.enter().append("rect").call(legendCellLayout).attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)}).attr("fill-opacity",0).call(function(selection){if(null!==calendar.legendScale&&null!==options.legendColors&&options.legendColors.hasOwnProperty("base")){selection.attr("fill",options.legendColors.base)}}).append("title");legendItem.exit().transition().duration(options.animationDuration).attr("fill-opacity",0).remove();legendItem.transition().delay(function(d,i){return options.animationDuration*i/10}).call(legendCellLayout).attr("fill-opacity",1).call(function(element){element.attr("fill",function(d,i){if(null===calendar.legendScale){return""}if(0===i){return calendar.legendScale(d-1)}return calendar.legendScale(options.legend[i-1])});element.attr("class",function(d){return calendar.Legend.getClass(d,null===calendar.legendScale)})});function legendCellLayout(selection){selection.attr("width",options.legendCellSize).attr("height",options.legendCellSize).attr("rx",options.legendCellRadius).attr("ry",options.legendCellRadius).attr("x",function(d,i){return i*(options.legendCellSize+options.legendCellPadding)})}legendItem.select("title").text(function(d,i){if(0===i){return calendar.formatStringWithObject(options.legendTitleFormat.lower,{min:options.legend[i],name:options.itemName[1]})}else if(i===_legend.length-1){return calendar.formatStringWithObject(options.legendTitleFormat.upper,{max:options.legend[i-1],name:options.itemName[1]})}else{return calendar.formatStringWithObject(options.legendTitleFormat.inner,{down:options.legend[i-1],up:options.legend[i],name:options.itemName[1]})}});legendItem.on("mouseover",function(d){calendar.legendTip.show(d,this)}).on("mouseout",function(){calendar.legendTip.hide()});legend.transition().duration(options.animationDuration).attr("x",getLegendXPosition()).attr("y",getLegendYPosition()).attr("width",parent.getDim("width")).attr("height",parent.getDim("height"));legend.select("g").transition().duration(options.animationDuration).attr("transform",function(){if("vertical"===options.legendOrientation){return"rotate(90 "+options.legendCellSize/2+" "+options.legendCellSize/2+")"}return""});function getLegendXPosition(){switch(options.legendHorizontalPosition){case"right":if("center"===options.legendVerticalPosition||"middle"===options.legendVerticalPosition){return width+options.legendMargin[3]}return width-parent.getDim("width")-options.legendMargin[1];case"middle":case"center":return Math.round(width/2-parent.getDim("width")/2);default:return options.legendMargin[3];}}function getLegendYPosition(){if("bottom"===options.legendVerticalPosition){return calendar.graphDim.height+options.legendMargin[0]-options.domainGutter-options.cellPadding}return options.legendMargin[0]}calendar.resize()};/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */Legend.prototype.getDim=function(axis){\'use strict\';var isHorizontal="horizontal"===this.calendar.options.legendOrientation;switch(axis){case"width":return this.dim[isHorizontal?"width":"height"];case"height":return this.dim[isHorizontal?"height":"width"];}};Legend.prototype.buildColors=function(){\'use strict\';var options=this.calendar.options;// Shorter accessor for variable name mangling when minifying\nif(null===options.legendColors){this.calendar.legendScale=null;return!1}var _colorRange=[];if(Array.isArray(options.legendColors)){_colorRange=options.legendColors}else if(options.legendColors.hasOwnProperty("min")&&options.legendColors.hasOwnProperty("max")){_colorRange=[options.legendColors.min,options.legendColors.max]}else{options.legendColors=null;return!1}var _legend=options.legend.slice(0);if(0<_legend[0]){_legend.unshift(0)}else if(0>=_legend[0]){// Let\'s guess the leftmost value, it we have to add one\n_legend.unshift(_legend[0]-(_legend[_legend.length-1]-_legend[0])/_legend.length)}var colorScale;if(options.legendColors.hasOwnProperty("colorScale")){colorScale=options.legendColors.colorScale}else{colorScale=d3.scale.linear().range(_colorRange).interpolate(d3.interpolateHcl).domain([d3.min(_legend),d3.max(_legend)])}var legendColors=_legend.map(function(element){return colorScale(element)});this.calendar.legendScale=d3.scale.threshold().domain(options.legend).range(legendColors);return!0};/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */Legend.prototype.getClass=function(n,withCssClass){\'use strict\';if(null===n||isNaN(n)){return""}for(var index=[this.calendar.options.legend.length+1],i=0,total=this.calendar.options.legend.length-1;i<=total;i++){if(0<this.calendar.options.legend[0]&&0>n){index=["1","i"];break}if(n<=this.calendar.options.legend[i]){index=[i+1];break}}if(0===n){index.push(0)}index.unshift("");return(index.join(" r")+(withCssClass?index.join(" q"):"")).trim()};/**\n * #source http://stackoverflow.com/a/383245/805649\n */function mergeRecursive(obj1,obj2){\'use strict\';/*jshint forin:false */for(var p in obj2){try{// Property in destination object set; update its value.\nif(obj2[p].constructor===Object){obj1[p]=mergeRecursive(obj1[p],obj2[p])}else{obj1[p]=obj2[p]}}catch(e){// Property in destination object not set; create it and set its value.\nobj1[p]=obj2[p]}}return obj1}/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */function arrayEquals(arrayA,arrayB){\'use strict\';// if the other array is a falsy value, return\nif(!arrayB||!arrayA){return!1}// compare lengths - can save a lot of time\nif(arrayA.length!==arrayB.length){return!1}for(var i=0;i<arrayA.length;i++){// Check if we have nested arrays\nif(arrayA[i]instanceof Array&&arrayB[i]instanceof Array){// recurse into the nested arrays\nif(!arrayEquals(arrayA[i],arrayB[i])){return!1}}else if(arrayA[i]!==arrayB[i]){// Warning - two different object instances will never be equal: {x:20} != {x:20}\nreturn!1}}return!0}/* harmony default export */ var cal_heatmap = (CalHeatMap);\n// EXTERNAL MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.css\nvar vendor_cal_heatmap = __webpack_require__(2237);\n\n// CONCATENATED MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/src/Calendar.js\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */function convertUTC(dttm){return new Date(dttm.getUTCFullYear(),dttm.getUTCMonth(),dttm.getUTCDate(),dttm.getUTCHours(),dttm.getUTCMinutes(),dttm.getUTCSeconds())}const convertUTCTS=uts=>convertUTC(new Date(uts)).getTime(),propTypes={data:prop_types_default.a.shape({// Object hashed by metric name,\n// then hashed by timestamp (in seconds, not milliseconds) as float\n// the innermost value is count\n// e.g. { count_distinct_something: { 1535034236.0: 3 } }\ndata:prop_types_default.a.object,domain:prop_types_default.a.string,range:prop_types_default.a.number,// timestamp in milliseconds\nstart:prop_types_default.a.number,subdomain:prop_types_default.a.string}),height:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellPadding:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellRadius:prop_types_default.a.number,// eslint-disable-next-line react/sort-prop-types\ncellSize:prop_types_default.a.number,linearColorScheme:prop_types_default.a.string,showLegend:prop_types_default.a.bool,showMetricName:prop_types_default.a.bool,showValues:prop_types_default.a.bool,steps:prop_types_default.a.number,timeFormat:prop_types_default.a.string,valueFormat:prop_types_default.a.string,verboseMap:prop_types_default.a.object};function Calendar(element,props){const{data,height,cellPadding=3,cellRadius=0,cellSize=10,domainGranularity,linearColorScheme,showLegend,showMetricName,showValues,steps,subdomainGranularity,timeFormat,valueFormat,verboseMap}=props,valueFormatter=Object(NumberFormatterRegistrySingleton["c" /* getNumberFormatter */])(valueFormat),timeFormatter=Object(TimeFormatterRegistrySingleton["d" /* getTimeFormatter */])(timeFormat),container=Object(src_select["a" /* default */])(element).classed("superset-legacy-chart-calendar",!0).style("height",height);container.selectAll("*").remove();const div=container.append("div"),subDomainTextFormat=showValues?(date,value)=>valueFormatter(value):null,metricsData={};Object.keys(data.data).forEach(metric=>{metricsData[metric]={};Object.keys(data.data[metric]).forEach(ts=>{metricsData[metric][convertUTCTS(1e3*ts)/1e3]=data.data[metric][ts]})});Object.keys(metricsData).forEach(metric=>{const calContainer=div.append("div");if(showMetricName){calContainer.text("Metric: ".concat(verboseMap[metric]||metric))}const timestamps=metricsData[metric],extents=extent(Object.keys(timestamps),key=>timestamps[key]),step=(extents[1]-extents[0])/(steps-1),colorScale=Object(SequentialSchemeRegistrySingleton["a" /* default */])().get(linearColorScheme).createLinearScale(extents),legend=range(steps).map(i=>extents[0]+step*i),legendColors=legend.map(x=>colorScale(x)),cal=new cal_heatmap;cal.init({start:convertUTCTS(data.start),data:timestamps,itemSelector:calContainer.node(),legendVerticalPosition:"top",cellSize,cellPadding,cellRadius,legendCellSize:cellSize,legendCellPadding:2,legendCellRadius:cellRadius,tooltip:!0,domain:domainGranularity,subDomain:subdomainGranularity,range:data.range,browsing:!0,legend,legendColors:{colorScale,min:legendColors[0],max:legendColors[legendColors.length-1],empty:"white"},displayLegend:showLegend,itemName:"",valueFormatter,timeFormatter,subDomainTextFormat})})}Calendar.displayName="Calendar";Calendar.propTypes=propTypes;/* harmony default export */ var src_Calendar = (Calendar);\n// CONCATENATED MODULE: /Users/kamilgabryjelski/projects/superset-ui/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx\nfunction _templateObject(){const data=_taggedTemplateLiteral(["\\n  .superset-legacy-chart-calendar {\\n    padding: 10px;\\n    position: static !important;\\n    overflow: auto !important;\\n  }\\n\\n  .superset-legacy-chart-calendar .ch-tooltip {\\n    margin-left: 20px;\\n    margin-top: 5px;\\n  }\\n"]);_templateObject=function(){return data};return data}function _taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function _objectWithoutProperties(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(0<=excluded.indexOf(key))continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(0<=excluded.indexOf(key))continue;target[key]=source[key]}return target}/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */const ReactComponent=Object(src["reactify"])(src_Calendar),Calender=(_ref)=>{let{className}=_ref,otherProps=_objectWithoutProperties(_ref,["className"]);return/*#__PURE__*/react_default.a.createElement("div",{className:className},/*#__PURE__*/react_default.a.createElement(ReactComponent,otherProps))};Calender.displayName="Calender";Calender.defaultProps={otherProps:{}};Calender.propTypes={className:prop_types_default.a.string.isRequired,otherProps:prop_types_default.a.objectOf(prop_types_default.a.any)};/* harmony default export */ var ReactCalendar = __webpack_exports__["default"] = (Object(style["c" /* styled */])(Calender)(_templateObject()));//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjQ5NC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvbm9kZV9tb2R1bGVzL2QzLWFycmF5L3NyYy9leHRlbnQuanM/YzU4ZSIsIndlYnBhY2s6Ly8vL1VzZXJzL2thbWlsZ2FicnlqZWxza2kvcHJvamVjdHMvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL25vZGVfbW9kdWxlcy9kMy1hcnJheS9zcmMvcmFuZ2UuanM/OThjZCIsIndlYnBhY2s6Ly8vL1VzZXJzL2thbWlsZ2FicnlqZWxza2kvcHJvamVjdHMvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy92ZW5kb3IvY2FsLWhlYXRtYXAuanM/ZDg1NSIsIndlYnBhY2s6Ly8vL1VzZXJzL2thbWlsZ2FicnlqZWxza2kvcHJvamVjdHMvc3VwZXJzZXQtdWkvcGx1Z2lucy9sZWdhY3ktcGx1Z2luLWNoYXJ0LWNhbGVuZGFyL3NyYy9DYWxlbmRhci5qcz82MDU4Iiwid2VicGFjazovLy8vVXNlcnMva2FtaWxnYWJyeWplbHNraS9wcm9qZWN0cy9zdXBlcnNldC11aS9wbHVnaW5zL2xlZ2FjeS1wbHVnaW4tY2hhcnQtY2FsZW5kYXIvc3JjL1JlYWN0Q2FsZW5kYXIuanN4PzZjZWMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24odmFsdWVzLCB2YWx1ZW9mKSB7XG4gIGxldCBtaW47XG4gIGxldCBtYXg7XG4gIGlmICh2YWx1ZW9mID09PSB1bmRlZmluZWQpIHtcbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlcykge1xuICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgaWYgKG1pbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKHZhbHVlID49IHZhbHVlKSBtaW4gPSBtYXggPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAobWluID4gdmFsdWUpIG1pbiA9IHZhbHVlO1xuICAgICAgICAgIGlmIChtYXggPCB2YWx1ZSkgbWF4ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGluZGV4ID0gLTE7XG4gICAgZm9yIChsZXQgdmFsdWUgb2YgdmFsdWVzKSB7XG4gICAgICBpZiAoKHZhbHVlID0gdmFsdWVvZih2YWx1ZSwgKytpbmRleCwgdmFsdWVzKSkgIT0gbnVsbCkge1xuICAgICAgICBpZiAobWluID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZiAodmFsdWUgPj0gdmFsdWUpIG1pbiA9IG1heCA9IHZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChtaW4gPiB2YWx1ZSkgbWluID0gdmFsdWU7XG4gICAgICAgICAgaWYgKG1heCA8IHZhbHVlKSBtYXggPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gW21pbiwgbWF4XTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7XG4gIHN0YXJ0ID0gK3N0YXJ0LCBzdG9wID0gK3N0b3AsIHN0ZXAgPSAobiA9IGFyZ3VtZW50cy5sZW5ndGgpIDwgMiA/IChzdG9wID0gc3RhcnQsIHN0YXJ0ID0gMCwgMSkgOiBuIDwgMyA/IDEgOiArc3RlcDtcblxuICB2YXIgaSA9IC0xLFxuICAgICAgbiA9IE1hdGgubWF4KDAsIE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApKSB8IDAsXG4gICAgICByYW5nZSA9IG5ldyBBcnJheShuKTtcblxuICB3aGlsZSAoKytpIDwgbikge1xuICAgIHJhbmdlW2ldID0gc3RhcnQgKyBpICogc3RlcDtcbiAgfVxuXG4gIHJldHVybiByYW5nZTtcbn1cbiIsIi8vIFtMSUNFTlNFIFRCRF1cbi8qIENvcGllZCBhbmQgYWx0ZXJlZCBmcm9tIGh0dHA6Ly9jYWwtaGVhdG1hcC5jb20vICwgYWx0ZXJhdGlvbnMgYXJvdW5kOlxuICogLSB0dW5pbmcgdG9vbHRpcHNcbiAqIC0gc3VwcG9ydGluZyBtdWx0aS1jb2xvcnMgc2NhbGVzXG4gKiAtIGxlZ2VuZCBmb3JtYXRcbiAqIC0gVVRDIGhhbmRsaW5nXG4gKi9cblxuLyogZXNsaW50LWRpc2FibGUgKi9cblxuaW1wb3J0IGQzdGlwIGZyb20gJ2QzLXRpcCc7XG5pbXBvcnQgJy4vZDN0aXAuY3NzJztcblxudmFyIGQzID0gdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicgPyByZXF1aXJlKCdkMycpIDogd2luZG93LmQzO1xuXG52YXIgZDMgPSB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJyA/IHJlcXVpcmUoJ2QzJykgOiB3aW5kb3cuZDM7XG5cbnZhciBDYWxIZWF0TWFwID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBzZWxmLnRpcCA9IGQzdGlwKClcbiAgICAuYXR0cignY2xhc3MnLCAnZDMtdGlwJylcbiAgICAuZGlyZWN0aW9uKCduJylcbiAgICAub2Zmc2V0KFstNSwgMF0pXG4gICAgLmh0bWwoXG4gICAgICBkID0+IGBcbiAgICAgICR7c2VsZi5vcHRpb25zLnRpbWVGb3JtYXR0ZXIoZC50KX06IDxzdHJvbmc+JHtzZWxmLm9wdGlvbnMudmFsdWVGb3JtYXR0ZXIoZC52KX08L3N0cm9uZz5cbiAgICBgLFxuICAgICk7XG4gIHNlbGYubGVnZW5kVGlwID0gZDN0aXAoKVxuICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKVxuICAgIC5kaXJlY3Rpb24oJ24nKVxuICAgIC5vZmZzZXQoWy01LCAwXSlcbiAgICAuaHRtbChkID0+IHNlbGYub3B0aW9ucy52YWx1ZUZvcm1hdHRlcihkKSk7XG5cbiAgdGhpcy5hbGxvd2VkRGF0YVR5cGUgPSBbJ2pzb24nLCAnY3N2JywgJ3RzdicsICd0eHQnXTtcblxuICAvLyBEZWZhdWx0IHNldHRpbmdzXG4gIHRoaXMub3B0aW9ucyA9IHtcbiAgICAvLyBzZWxlY3RvciBzdHJpbmcgb2YgdGhlIGNvbnRhaW5lciB0byBhcHBlbmQgdGhlIGdyYXBoIHRvXG4gICAgLy8gQWNjZXB0IGFueSBzdHJpbmcgdmFsdWUgYWNjZXB0ZWQgYnkgZG9jdW1lbnQucXVlcnlTZWxlY3RvciBvciBDU1MzXG4gICAgLy8gb3IgYW4gRWxlbWVudCBvYmplY3RcbiAgICBpdGVtU2VsZWN0b3I6ICcjY2FsLWhlYXRtYXAnLFxuXG4gICAgLy8gV2hldGhlciB0byBwYWludCB0aGUgY2FsZW5kYXIgb24gaW5pdCgpXG4gICAgLy8gVXNlZCBieSB0ZXN0c3VpdGUgdG8gcmVkdWNlIHRlc3RpbmcgdGltZVxuICAgIHBhaW50T25Mb2FkOiB0cnVlLFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gRE9NQUlOXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBOdW1iZXIgb2YgZG9tYWluIHRvIGRpc3BsYXkgb24gdGhlIGdyYXBoXG4gICAgcmFuZ2U6IDEyLFxuXG4gICAgLy8gU2l6ZSBvZiBlYWNoIGNlbGwsIGluIHBpeGVsXG4gICAgY2VsbFNpemU6IDEwLFxuXG4gICAgLy8gUGFkZGluZyBiZXR3ZWVuIGVhY2ggY2VsbCwgaW4gcGl4ZWxcbiAgICBjZWxsUGFkZGluZzogMixcblxuICAgIC8vIEZvciByb3VuZGVkIHN1YmRvbWFpbiByZWN0YW5nbGVzLCBpbiBwaXhlbHNcbiAgICBjZWxsUmFkaXVzOiAwLFxuXG4gICAgZG9tYWluR3V0dGVyOiAyLFxuXG4gICAgZG9tYWluTWFyZ2luOiBbMCwgMCwgMCwgMF0sXG5cbiAgICB2YWx1ZUZvcm1hdHRlcjogZCA9PiBkLFxuXG4gICAgdGltZUZvcm1hdHRlcjogZCA9PiBkLFxuXG4gICAgZG9tYWluOiAnaG91cicsXG5cbiAgICBzdWJEb21haW46ICdtaW4nLFxuXG4gICAgLy8gTnVtYmVyIG9mIGNvbHVtbnMgdG8gc3BsaXQgdGhlIHN1YkRvbWFpbnMgdG9cbiAgICAvLyBJZiBub3QgbnVsbCwgd2lsbCB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgcm93TGltaXRcbiAgICBjb2xMaW1pdDogbnVsbCxcblxuICAgIC8vIE51bWJlciBvZiByb3dzIHRvIHNwbGl0IHRoZSBzdWJEb21haW5zIHRvXG4gICAgLy8gV2lsbCBiZSBpZ25vcmVkIGlmIGNvbExpbWl0IGlzIG5vdCBudWxsXG4gICAgcm93TGltaXQ6IG51bGwsXG5cbiAgICAvLyBGaXJzdCBkYXkgb2YgdGhlIHdlZWsgaXMgTW9uZGF5XG4gICAgLy8gMCB0byBzdGFydCB0aGUgd2VlayBvbiBTdW5kYXlcbiAgICB3ZWVrU3RhcnRPbk1vbmRheTogdHJ1ZSxcblxuICAgIC8vIFN0YXJ0IGRhdGUgb2YgdGhlIGdyYXBoXG4gICAgLy8gQGRlZmF1bHQgbm93XG4gICAgc3RhcnQ6IG5ldyBEYXRlKCksXG5cbiAgICBtaW5EYXRlOiBudWxsLFxuXG4gICAgbWF4RGF0ZTogbnVsbCxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIERBVEFcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIERhdGEgc291cmNlXG4gICAgLy8gVVJMLCB3aGVyZSB0byBmZXRjaCB0aGUgb3JpZ2luYWwgZGF0YXNcbiAgICBkYXRhOiAnJyxcblxuICAgIC8vIERhdGEgdHlwZVxuICAgIC8vIERlZmF1bHQ6IGpzb25cbiAgICBkYXRhVHlwZTogdGhpcy5hbGxvd2VkRGF0YVR5cGVbMF0sXG5cbiAgICAvLyBQYXlsb2FkIHNlbnQgd2hlbiB1c2luZyBQT1NUIGh0dHAgbWV0aG9kXG4gICAgLy8gTGVhdmUgdG8gbnVsbCAoZGVmYXVsdCkgZm9yIEdFVCByZXF1ZXN0XG4gICAgLy8gRXhwZWN0IGEgc3RyaW5nLCBmb3JtYXR0ZWQgbGlrZSBcImE9YjtjPWRcIlxuICAgIGRhdGFQb3N0UGF5bG9hZDogbnVsbCxcblxuICAgIC8vIEFkZGl0aW9uYWwgaGVhZGVycyBzZW50IHdoZW4gcmVxdWVzdGluZyBkYXRhXG4gICAgLy8gRXhwZWN0IGFuIG9iamVjdCBmb3JtYXR0ZWQgbGlrZTpcbiAgICAvLyB7ICdYLUNTUkYtVE9LRU4nOiAndG9rZW4nIH1cbiAgICBkYXRhUmVxdWVzdEhlYWRlcnM6IG51bGwsXG5cbiAgICAvLyBXaGV0aGVyIHRvIGNvbnNpZGVyIG1pc3NpbmcgZGF0ZTp2YWx1ZSBmcm9tIHRoZSBkYXRhc291cmNlXG4gICAgLy8gYXMgZXF1YWwgdG8gMCwgb3IganVzdCBsZWF2ZSB0aGVtIGFzIG1pc3NpbmdcbiAgICBjb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvOiBmYWxzZSxcblxuICAgIC8vIExvYWQgcmVtb3RlIGRhdGEgb24gY2FsZW5kYXIgY3JlYXRpb25cbiAgICAvLyBXaGVuIGZhbHNlLCB0aGUgY2FsZW5kYXIgd2lsbCBiZSBsZWZ0IGVtcHR5XG4gICAgbG9hZE9uSW5pdDogdHJ1ZSxcblxuICAgIC8vIENhbGVuZGFyIG9yaWVudGF0aW9uXG4gICAgLy8gZmFsc2U6IGRpc3BsYXkgZG9tYWlucyBzaWRlIGJ5IHNpZGVcbiAgICAvLyB0cnVlIDogZGlzcGxheSBkb21haW5zIG9uZSB1bmRlciB0aGUgb3RoZXJcbiAgICB2ZXJ0aWNhbE9yaWVudGF0aW9uOiBmYWxzZSxcblxuICAgIC8vIERvbWFpbiBkeW5hbWljIHdpZHRoL2hlaWdodFxuICAgIC8vIFRoZSB3aWR0aCBvbiBhIGRvbWFpbiBkZXBlbmRzIG9uIHRoZSBudW1iZXIgb2ZcbiAgICBkb21haW5EeW5hbWljRGltZW5zaW9uOiB0cnVlLFxuXG4gICAgLy8gRG9tYWluIExhYmVsIHByb3BlcnRpZXNcbiAgICBsYWJlbDoge1xuICAgICAgLy8gdmFsaWQ6IHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdFxuICAgICAgcG9zaXRpb246ICdib3R0b20nLFxuXG4gICAgICAvLyBWYWxpZDogbGVmdCwgY2VudGVyLCByaWdodFxuICAgICAgLy8gQWxzbyB2YWxpZCBhcmUgdGhlIGRpcmVjdCBzdmcgdmFsdWVzOiBzdGFydCwgbWlkZGxlLCBlbmRcbiAgICAgIGFsaWduOiAnY2VudGVyJyxcblxuICAgICAgLy8gQnkgZGVmYXVsdCwgdGhlcmUgaXMgbm8gbWFyZ2luL3BhZGRpbmcgYXJvdW5kIHRoZSBsYWJlbFxuICAgICAgb2Zmc2V0OiB7XG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgICB9LFxuXG4gICAgICByb3RhdGU6IG51bGwsXG5cbiAgICAgIC8vIFVzZWQgb25seSBvbiB2ZXJ0aWNhbCBvcmllbnRhdGlvblxuICAgICAgd2lkdGg6IDEwMCxcblxuICAgICAgLy8gVXNlZCBvbmx5IG9uIGhvcml6b250YWwgb3JpZW50YXRpb25cbiAgICAgIGhlaWdodDogbnVsbCxcbiAgICB9LFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gTEVHRU5EXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICAvLyBUaHJlc2hvbGQgZm9yIHRoZSBsZWdlbmRcbiAgICBsZWdlbmQ6IFsxMCwgMjAsIDMwLCA0MF0sXG5cbiAgICAvLyBXaGV0aGVyIHRvIGRpc3BsYXkgdGhlIGxlZ2VuZFxuICAgIGRpc3BsYXlMZWdlbmQ6IHRydWUsXG5cbiAgICBsZWdlbmRDZWxsU2l6ZTogMTAsXG5cbiAgICBsZWdlbmRDZWxsUGFkZGluZzogMixcblxuICAgIGxlZ2VuZE1hcmdpbjogWzAsIDAsIDAsIDBdLFxuXG4gICAgLy8gTGVnZW5kIHZlcnRpY2FsIHBvc2l0aW9uXG4gICAgLy8gdG9wOiBwbGFjZSBsZWdlbmQgYWJvdmUgY2FsZW5kYXJcbiAgICAvLyBib3R0b206IHBsYWNlIGxlZ2VuZCBiZWxvdyB0aGUgY2FsZW5kYXJcbiAgICBsZWdlbmRWZXJ0aWNhbFBvc2l0aW9uOiAnYm90dG9tJyxcblxuICAgIC8vIExlZ2VuZCBob3Jpem9udGFsIHBvc2l0aW9uXG4gICAgLy8gYWNjZXB0ZWQgdmFsdWVzOiBsZWZ0LCBjZW50ZXIsIHJpZ2h0XG4gICAgbGVnZW5kSG9yaXpvbnRhbFBvc2l0aW9uOiAnbGVmdCcsXG5cbiAgICAvLyBMZWdlbmQgcm90YXRpb25cbiAgICAvLyBhY2NlcHRlZCB2YWx1ZXM6IGhvcml6b250YWwsIHZlcnRpY2FsXG4gICAgbGVnZW5kT3JpZW50YXRpb246ICdob3Jpem9udGFsJyxcblxuICAgIC8vIE9iamVjdHMgaG9sZGluZyBhbGwgdGhlIGhlYXRtYXAgZGlmZmVyZW50IGNvbG9yc1xuICAgIC8vIG51bGwgdG8gZGlzYWJsZSwgYW5kIHVzZSB0aGUgZGVmYXVsdCBjc3Mgc3R5bGVzXG4gICAgLy9cbiAgICAvLyBFeGFtcGxlczpcbiAgICAvLyBsZWdlbmRDb2xvcnM6IHtcbiAgICAvLyAgICBtaW46IFwiZ3JlZW5cIixcbiAgICAvLyAgICBtYXg6IFwicmVkXCIsXG4gICAgLy8gICAgZW1wdHk6IFwiI2ZmZmZmZlwiLFxuICAgIC8vICAgIGJhc2U6IFwiZ3JleVwiLFxuICAgIC8vICAgIG92ZXJmbG93OiBcInJlZFwiLFxuICAgIC8vICAgIGNvbG9yU2NhbGVyOiBudWxsLFxuICAgIC8vIH1cbiAgICBsZWdlbmRDb2xvcnM6IG51bGwsXG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBISUdITElHSFRcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIC8vIExpc3Qgb2YgZGF0ZXMgdG8gaGlnaGxpZ2h0XG4gICAgLy8gVmFsaWQgdmFsdWVzOlxuICAgIC8vIC0gW106IGRvbid0IGhpZ2hsaWdodCBhbnl0aGluZ1xuICAgIC8vIC0gXCJub3dcIjogaGlnaGxpZ2h0IHRoZSBjdXJyZW50IGRhdGVcbiAgICAvLyAtIGFuIGFycmF5IG9mIERhdGUgb2JqZWN0czogaGlnaGxpZ2h0IHRoZSBzcGVjaWZpZWQgZGF0ZXNcbiAgICBoaWdobGlnaHQ6IFtdLFxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLy8gVEVYVCBGT1JNQVRUSU5HIC8gaTE4blxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gTmFtZSBvZiB0aGUgaXRlbXMgdG8gcmVwcmVzZW50IGluIHRoZSBjYWxlbmRhclxuICAgIGl0ZW1OYW1lOiBbJ2l0ZW0nLCAnaXRlbXMnXSxcblxuICAgIC8vIEZvcm1hdHRpbmcgb2YgdGhlIGRvbWFpbiBsYWJlbFxuICAgIC8vIEBkZWZhdWx0OiBudWxsLCB3aWxsIHVzZSB0aGUgZm9ybWF0dGluZyBhY2NvcmRpbmcgdG8gZG9tYWluIHR5cGVcbiAgICAvLyBBY2NlcHQgYSBzdHJpbmcgdXNlZCBhcyBzcGVjaWZpZXIgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIC8vIG9yIGEgZnVuY3Rpb25cbiAgICAvL1xuICAgIC8vIFJlZmVyIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9tYm9zdG9jay9kMy93aWtpL1RpbWUtRm9ybWF0dGluZ1xuICAgIC8vIGZvciBhY2NlcHRlZCBkYXRlIGZvcm1hdHRpbmcgdXNlZCBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgZG9tYWluTGFiZWxGb3JtYXQ6IG51bGwsXG5cbiAgICAvLyBGb3JtYXR0aW5nIG9mIHRoZSB0aXRsZSBkaXNwbGF5ZWQgd2hlbiBob3ZlcmluZyBhIHN1YkRvbWFpbiBjZWxsXG4gICAgc3ViRG9tYWluVGl0bGVGb3JtYXQ6IHtcbiAgICAgIGVtcHR5OiAne2RhdGV9JyxcbiAgICAgIGZpbGxlZDogJ3tjb3VudH0ge25hbWV9IHtjb25uZWN0b3J9IHtkYXRlfScsXG4gICAgfSxcblxuICAgIC8vIEZvcm1hdHRpbmcgb2YgdGhlIHtkYXRlfSB1c2VkIGluIHN1YkRvbWFpblRpdGxlRm9ybWF0XG4gICAgLy8gQGRlZmF1bHQ6IG51bGwsIHdpbGwgdXNlIHRoZSBmb3JtYXR0aW5nIGFjY29yZGluZyB0byBzdWJEb21haW4gdHlwZVxuICAgIC8vIEFjY2VwdCBhIHN0cmluZyB1c2VkIGFzIHNwZWNpZmllciBieSBkMy50aW1lLmZvcm1hdCgpXG4gICAgLy8gb3IgYSBmdW5jdGlvblxuICAgIC8vXG4gICAgLy8gUmVmZXIgdG8gaHR0cHM6Ly9naXRodWIuY29tL21ib3N0b2NrL2QzL3dpa2kvVGltZS1Gb3JtYXR0aW5nXG4gICAgLy8gZm9yIGFjY2VwdGVkIGRhdGUgZm9ybWF0dGluZyB1c2VkIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICBzdWJEb21haW5EYXRlRm9ybWF0OiBudWxsLFxuXG4gICAgLy8gRm9ybWF0dGluZyBvZiB0aGUgdGV4dCBpbnNpZGUgZWFjaCBzdWJEb21haW4gY2VsbFxuICAgIC8vIEBkZWZhdWx0OiBudWxsLCBubyB0ZXh0XG4gICAgLy8gQWNjZXB0IGEgc3RyaW5nIHVzZWQgYXMgc3BlY2lmaWVyIGJ5IGQzLnRpbWUuZm9ybWF0KClcbiAgICAvLyBvciBhIGZ1bmN0aW9uXG4gICAgLy9cbiAgICAvLyBSZWZlciB0byBodHRwczovL2dpdGh1Yi5jb20vbWJvc3RvY2svZDMvd2lraS9UaW1lLUZvcm1hdHRpbmdcbiAgICAvLyBmb3IgYWNjZXB0ZWQgZGF0ZSBmb3JtYXR0aW5nIHVzZWQgYnkgZDMudGltZS5mb3JtYXQoKVxuICAgIHN1YkRvbWFpblRleHRGb3JtYXQ6IG51bGwsXG5cbiAgICAvLyBGb3JtYXR0aW5nIG9mIHRoZSB0aXRsZSBkaXNwbGF5ZWQgd2hlbiBob3ZlcmluZyBhIGxlZ2VuZCBjZWxsXG4gICAgbGVnZW5kVGl0bGVGb3JtYXQ6IHtcbiAgICAgIGxvd2VyOiAnbGVzcyB0aGFuIHttaW59IHtuYW1lfScsXG4gICAgICBpbm5lcjogJ2JldHdlZW4ge2Rvd259IGFuZCB7dXB9IHtuYW1lfScsXG4gICAgICB1cHBlcjogJ21vcmUgdGhhbiB7bWF4fSB7bmFtZX0nLFxuICAgIH0sXG5cbiAgICAvLyBBbmltYXRpb24gZHVyYXRpb24sIGluIG1zXG4gICAgYW5pbWF0aW9uRHVyYXRpb246IDUwMCxcblxuICAgIG5leHRTZWxlY3RvcjogZmFsc2UsXG5cbiAgICBwcmV2aW91c1NlbGVjdG9yOiBmYWxzZSxcblxuICAgIGl0ZW1OYW1lc3BhY2U6ICdjYWwtaGVhdG1hcCcsXG5cbiAgICB0b29sdGlwOiBmYWxzZSxcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8vIEVWRU5UUyBDQUxMQkFDS1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgLy8gQ2FsbGJhY2sgd2hlbiBjbGlja2luZyBvbiBhIHRpbWUgYmxvY2tcbiAgICBvbkNsaWNrOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgYWZ0ZXIgcGFpbnRpbmcgdGhlIGVtcHR5IGNhbGVuZGFyXG4gICAgLy8gQ2FuIGJlIHVzZWQgdG8gdHJpZ2dlciBhbiBBUEkgY2FsbCwgb25jZSB0aGUgY2FsZW5kYXIgaXMgcmVhZHkgdG8gYmUgZmlsbGVkXG4gICAgYWZ0ZXJMb2FkOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgYWZ0ZXIgbG9hZGluZyB0aGUgbmV4dCBkb21haW4gaW4gdGhlIGNhbGVuZGFyXG4gICAgYWZ0ZXJMb2FkTmV4dERvbWFpbjogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIGFmdGVyIGxvYWRpbmcgdGhlIHByZXZpb3VzIGRvbWFpbiBpbiB0aGUgY2FsZW5kYXJcbiAgICBhZnRlckxvYWRQcmV2aW91c0RvbWFpbjogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIGFmdGVyIGZpbmlzaGluZyBhbGwgYWN0aW9ucyBvbiB0aGUgY2FsZW5kYXJcbiAgICBvbkNvbXBsZXRlOiBudWxsLFxuXG4gICAgLy8gQ2FsbGJhY2sgYWZ0ZXIgZmV0Y2hpbmcgdGhlIGRhdGFzLCBidXQgYmVmb3JlIGFwcGx5aW5nIHRoZW0gdG8gdGhlIGNhbGVuZGFyXG4gICAgLy8gVXNlZCBtYWlubHkgdG8gY29udmVydCB0aGUgZGF0YXMgaWYgdGhleSdyZSBub3QgZm9ybWF0dGVkIGxpa2UgZXhwZWN0ZWRcbiAgICAvLyBUYWtlcyB0aGUgZmV0Y2hlZCBcImRhdGFcIiBvYmplY3QgYXMgYXJndW1lbnQsIG11c3QgcmV0dXJuIGEganNvbiBvYmplY3RcbiAgICAvLyBmb3JtYXR0ZWQgbGlrZSB7dGltZXN0YW1wOmNvdW50LCB0aW1lc3RhbXAyOmNvdW50Mn0sXG4gICAgYWZ0ZXJMb2FkRGF0YTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0sXG5cbiAgICAvLyBDYWxsYmFjayB0cmlnZ2VyZWQgYWZ0ZXIgY2FsbGluZyBhbmQgY29tcGxldGluZyB1cGRhdGUoKS5cbiAgICBhZnRlclVwZGF0ZTogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIHRyaWdnZXJlZCBhZnRlciBjYWxsaW5nIG5leHQoKS5cbiAgICAvLyBUaGUgYHN0YXR1c2AgYXJndW1lbnQgaXMgZXF1YWwgdG8gdHJ1ZSBpZiB0aGVyZSBpcyBub1xuICAgIC8vIG1vcmUgbmV4dCBkb21haW4gdG8gbG9hZFxuICAgIC8vXG4gICAgLy8gVGhpcyBjYWxsYmFjayBpcyBhbHNvIGV4ZWN1dGVkIG9uY2UsIGFmdGVyIGNhbGxpbmcgcHJldmlvdXMoKSxcbiAgICAvLyBvbmx5IHdoZW4gdGhlIG1heCBkb21haW4gaXMgcmVhY2hlZFxuICAgIG9uTWF4RG9tYWluUmVhY2hlZDogbnVsbCxcblxuICAgIC8vIENhbGxiYWNrIHRyaWdnZXJlZCBhZnRlciBjYWxsaW5nIHByZXZpb3VzKCkuXG4gICAgLy8gVGhlIGBzdGF0dXNgIGFyZ3VtZW50IGlzIGVxdWFsIHRvIHRydWUgaWYgdGhlcmUgaXMgbm9cbiAgICAvLyBtb3JlIHByZXZpb3VzIGRvbWFpbiB0byBsb2FkXG4gICAgLy9cbiAgICAvLyBUaGlzIGNhbGxiYWNrIGlzIGFsc28gZXhlY3V0ZWQgb25jZSwgYWZ0ZXIgY2FsbGluZyBuZXh0KCksXG4gICAgLy8gb25seSB3aGVuIHRoZSBtaW4gZG9tYWluIGlzIHJlYWNoZWRcbiAgICBvbk1pbkRvbWFpblJlYWNoZWQ6IG51bGwsXG4gIH07XG5cbiAgdGhpcy5fZG9tYWluVHlwZSA9IHtcbiAgICBtaW46IHtcbiAgICAgIG5hbWU6ICdtaW51dGUnLFxuICAgICAgbGV2ZWw6IDEwLFxuICAgICAgbWF4SXRlbU51bWJlcjogNjAsXG4gICAgICBkZWZhdWx0Um93TnVtYmVyOiAxMCxcbiAgICAgIGRlZmF1bHRDb2x1bW5OdW1iZXI6IDYsXG4gICAgICByb3c6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpblJvd051bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpbkNvbHVtbk51bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGQuZ2V0TWludXRlcygpIC8gc2VsZi5fZG9tYWluVHlwZS5taW4ucm93KGQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gZC5nZXRNaW51dGVzKCkgJSBzZWxmLl9kb21haW5UeXBlLm1pbi5yb3coZCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZm9ybWF0OiB7XG4gICAgICAgIGRhdGU6ICclSDolTSwgJUEgJUIgJS1lLCAlWScsXG4gICAgICAgIGxlZ2VuZDogJycsXG4gICAgICAgIGNvbm5lY3RvcjogJ2F0JyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKFxuICAgICAgICAgIGQuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICBkLmdldE1vbnRoKCksXG4gICAgICAgICAgZC5nZXREYXRlKCksXG4gICAgICAgICAgZC5nZXRIb3VycygpLFxuICAgICAgICAgIGQuZ2V0TWludXRlcygpLFxuICAgICAgICApLmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBob3VyOiB7XG4gICAgICBuYW1lOiAnaG91cicsXG4gICAgICBsZXZlbDogMjAsXG4gICAgICBtYXhJdGVtTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgcmV0dXJuIDI0O1xuICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgcmV0dXJuIDI0ICogNztcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICByZXR1cm4gMjQgKiAoc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb24gPyBzZWxmLmdldERheUNvdW50SW5Nb250aChkKSA6IDMxKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IDYsXG4gICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgcmV0dXJuIDQ7XG4gICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICByZXR1cm4gMjg7XG4gICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uID8gc2VsZi5nZXREYXlDb3VudEluTW9udGgoZCkgOiAzMTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJvdzogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluUm93TnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIGNvbHVtbjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluQ29sdW1uTnVtYmVyKGQpO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kb21haW4gPT09ICdtb250aCcpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoXG4gICAgICAgICAgICAgICAgKGQuZ2V0SG91cnMoKSArIChkLmdldERhdGUoKSAtIDEpICogMjQpIC8gc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGQuZ2V0SG91cnMoKSAvIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCkpICsgKGQuZ2V0RGF0ZSgpIC0gMSkgKiA0O1xuICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZi5vcHRpb25zLmRvbWFpbiA9PT0gJ3dlZWsnKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKFxuICAgICAgICAgICAgICAgIChkLmdldEhvdXJzKCkgKyBzZWxmLmdldFdlZWtEYXkoZCkgKiAyNCkgLyBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZC5nZXRIb3VycygpIC8gc2VsZi5fZG9tYWluVHlwZS5ob3VyLnJvdyhkKSkgKyBzZWxmLmdldFdlZWtEYXkoZCkgKiA0O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkLmdldEhvdXJzKCkgLyBzZWxmLl9kb21haW5UeXBlLmhvdXIucm93KGQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICB2YXIgcCA9IGQuZ2V0SG91cnMoKTtcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmNvbExpbWl0ID4gMCB8fCBzZWxmLm9wdGlvbnMucm93TGltaXQgPiAwKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgICAgIHAgKz0gKGQuZ2V0RGF0ZSgpIC0gMSkgKiAyNDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICAgICAgcCArPSBzZWxmLmdldFdlZWtEYXkoZCkgKiAyNDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IocCAlIHNlbGYuX2RvbWFpblR5cGUuaG91ci5yb3coZCkpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGZvcm1hdDoge1xuICAgICAgICBkYXRlOiAnJUhoLCAlQSAlQiAlLWUsICVZJyxcbiAgICAgICAgbGVnZW5kOiAnJUg6MDAnLFxuICAgICAgICBjb25uZWN0b3I6ICdhdCcsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCksIGQuZ2V0SG91cnMoKSkuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIGRheToge1xuICAgICAgbmFtZTogJ2RheScsXG4gICAgICBsZXZlbDogMzAsXG4gICAgICBtYXhJdGVtTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgIHJldHVybiA3O1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvbiA/IHNlbGYuZ2V0RGF5Q291bnRJbk1vbnRoKGQpIDogMzE7XG4gICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb24gPyBzZWxmLmdldERheUNvdW50SW5ZZWFyKGQpIDogMzY2O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuZG9tYWluRHluYW1pY0RpbWVuc2lvbiAmJiAhc2VsZi5vcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb25cbiAgICAgICAgICAgICAgPyBzZWxmLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkgKyAxLCAwKSkgLVxuICAgICAgICAgICAgICAgICAgc2VsZi5nZXRXZWVrTnVtYmVyKGQpICtcbiAgICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgOiA2O1xuICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYub3B0aW9ucy5kb21haW5EeW5hbWljRGltZW5zaW9uXG4gICAgICAgICAgICAgID8gc2VsZi5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgMTEsIDMxKSkgLVxuICAgICAgICAgICAgICAgICAgc2VsZi5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgMCkpICtcbiAgICAgICAgICAgICAgICAgIDFcbiAgICAgICAgICAgICAgOiA1NDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IDcsXG4gICAgICByb3c6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpblJvd051bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpbkNvbHVtbk51bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHNlbGYuZ2V0V2Vla0RheShkKSAvIHNlbGYuX2RvbWFpblR5cGUuZGF5LnJvdyhkKSk7XG4gICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoZC5nZXREYXRlKCkgLSAxKSAvIHNlbGYuX2RvbWFpblR5cGUuZGF5LnJvdyhkKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBzZWxmLmdldFdlZWtOdW1iZXIoZCkgLSBzZWxmLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkpKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuY29sTGltaXQgPiAwIHx8IHNlbGYub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoc2VsZi5nZXREYXlPZlllYXIoZCkgLSAxKSAvIHNlbGYuX2RvbWFpblR5cGUuZGF5LnJvdyhkKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0V2Vla051bWJlcihkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgdmFyIHAgPSBzZWxmLmdldFdlZWtEYXkoZCk7XG4gICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5jb2xMaW1pdCA+IDAgfHwgc2VsZi5vcHRpb25zLnJvd0xpbWl0ID4gMCkge1xuICAgICAgICAgICAgc3dpdGNoIChzZWxmLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgICAgIHAgPSBzZWxmLmdldERheU9mWWVhcihkKSAtIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgICAgIHAgPSBzZWxmLmdldFdlZWtEYXkoZCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgICBwID0gZC5nZXREYXRlKCkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihwICUgc2VsZi5fZG9tYWluVHlwZS5kYXkucm93KGQpKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVBICVCICUtZSwgJVknLFxuICAgICAgICBsZWdlbmQ6ICclZSAlYicsXG4gICAgICAgIGNvbm5lY3RvcjogJ29uJyxcbiAgICAgIH0sXG4gICAgICBleHRyYWN0VW5pdDogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIHdlZWs6IHtcbiAgICAgIG5hbWU6ICd3ZWVrJyxcbiAgICAgIGxldmVsOiA0MCxcbiAgICAgIG1heEl0ZW1OdW1iZXI6IDU0LFxuICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgZCA9IG5ldyBEYXRlKGQpO1xuICAgICAgICBzd2l0Y2ggKHNlbGYub3B0aW9ucy5kb21haW4pIHtcbiAgICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICAgIHJldHVybiBzZWxmLl9kb21haW5UeXBlLndlZWsubWF4SXRlbU51bWJlcjtcbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLmRvbWFpbkR5bmFtaWNEaW1lbnNpb25cbiAgICAgICAgICAgICAgPyBzZWxmLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkgKyAxLCAwKSkgLVxuICAgICAgICAgICAgICAgICAgc2VsZi5nZXRXZWVrTnVtYmVyKGQpXG4gICAgICAgICAgICAgIDogNTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IDEsXG4gICAgICByb3c6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpblJvd051bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBjb2x1bW46IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpbkNvbHVtbk51bWJlcihkKTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHN3aXRjaCAoc2VsZi5vcHRpb25zLmRvbWFpbikge1xuICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHNlbGYuZ2V0V2Vla051bWJlcihkKSAvIHNlbGYuX2RvbWFpblR5cGUud2Vlay5yb3coZCkpO1xuICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihzZWxmLmdldE1vbnRoV2Vla051bWJlcihkKSAvIHNlbGYuX2RvbWFpblR5cGUud2Vlay5yb3coZCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgeTogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5nZXRXZWVrTnVtYmVyKGQpICUgc2VsZi5fZG9tYWluVHlwZS53ZWVrLnJvdyhkKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVCIFdlZWsgIyVXJyxcbiAgICAgICAgbGVnZW5kOiAnJUIgV2VlayAjJVcnLFxuICAgICAgICBjb25uZWN0b3I6ICdpbicsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBkdCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSk7XG4gICAgICAgIC8vIEFjY29yZGluZyB0byBJU08tODYwMSwgd2VlayBudW1iZXIgY29tcHV0YXRpb24gYXJlIGJhc2VkIG9uIHdlZWsgc3RhcnRpbmcgb24gTW9uZGF5XG4gICAgICAgIHZhciB3ZWVrRGF5ID0gZHQuZ2V0RGF5KCkgLSAoc2VsZi5vcHRpb25zLndlZWtTdGFydE9uTW9uZGF5ID8gMSA6IDApO1xuICAgICAgICBpZiAod2Vla0RheSA8IDApIHtcbiAgICAgICAgICB3ZWVrRGF5ID0gNjtcbiAgICAgICAgfVxuICAgICAgICBkdC5zZXREYXRlKGR0LmdldERhdGUoKSAtIHdlZWtEYXkpO1xuICAgICAgICByZXR1cm4gZHQuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIG1vbnRoOiB7XG4gICAgICBuYW1lOiAnbW9udGgnLFxuICAgICAgbGV2ZWw6IDUwLFxuICAgICAgbWF4SXRlbU51bWJlcjogMTIsXG4gICAgICBkZWZhdWx0Q29sdW1uTnVtYmVyOiAxMixcbiAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IDEsXG4gICAgICByb3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuZ2V0U3ViRG9tYWluUm93TnVtYmVyKCk7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmdldFN1YkRvbWFpbkNvbHVtbk51bWJlcigpO1xuICAgICAgfSxcbiAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgIHg6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZC5nZXRNb250aCgpIC8gc2VsZi5fZG9tYWluVHlwZS5tb250aC5yb3coZCkpO1xuICAgICAgICB9LFxuICAgICAgICB5OiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHJldHVybiBkLmdldE1vbnRoKCkgJSBzZWxmLl9kb21haW5UeXBlLm1vbnRoLnJvdyhkKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVCICVZJyxcbiAgICAgICAgbGVnZW5kOiAnJUInLFxuICAgICAgICBjb25uZWN0b3I6ICdpbicsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSkuZ2V0VGltZSgpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIHllYXI6IHtcbiAgICAgIG5hbWU6ICd5ZWFyJyxcbiAgICAgIGxldmVsOiA2MCxcbiAgICAgIHJvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZi5vcHRpb25zLnJvd0xpbWl0IHx8IDE7XG4gICAgICB9LFxuICAgICAgY29sdW1uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLm9wdGlvbnMuY29sTGltaXQgfHwgMTtcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB4OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0sXG4gICAgICAgIHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBmb3JtYXQ6IHtcbiAgICAgICAgZGF0ZTogJyVZJyxcbiAgICAgICAgbGVnZW5kOiAnJVknLFxuICAgICAgICBjb25uZWN0b3I6ICdpbicsXG4gICAgICB9LFxuICAgICAgZXh0cmFjdFVuaXQ6IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCkpLmdldFRpbWUoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBmb3IgKHZhciB0eXBlIGluIHRoaXMuX2RvbWFpblR5cGUpIHtcbiAgICBpZiAodGhpcy5fZG9tYWluVHlwZS5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkge1xuICAgICAgdmFyIGQgPSB0aGlzLl9kb21haW5UeXBlW3R5cGVdO1xuICAgICAgdGhpcy5fZG9tYWluVHlwZVsneF8nICsgdHlwZV0gPSB7XG4gICAgICAgIG5hbWU6ICd4XycgKyB0eXBlLFxuICAgICAgICBsZXZlbDogZC50eXBlLFxuICAgICAgICBtYXhJdGVtTnVtYmVyOiBkLm1heEl0ZW1OdW1iZXIsXG4gICAgICAgIGRlZmF1bHRSb3dOdW1iZXI6IGQuZGVmYXVsdFJvd051bWJlcixcbiAgICAgICAgZGVmYXVsdENvbHVtbk51bWJlcjogZC5kZWZhdWx0Q29sdW1uTnVtYmVyLFxuICAgICAgICByb3c6IGQuY29sdW1uLFxuICAgICAgICBjb2x1bW46IGQucm93LFxuICAgICAgICBwb3NpdGlvbjoge1xuICAgICAgICAgIHg6IGQucG9zaXRpb24ueSxcbiAgICAgICAgICB5OiBkLnBvc2l0aW9uLngsXG4gICAgICAgIH0sXG4gICAgICAgIGZvcm1hdDogZC5mb3JtYXQsXG4gICAgICAgIGV4dHJhY3RVbml0OiBkLmV4dHJhY3RVbml0LFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBSZWNvcmQgdGhlIGFkZHJlc3Mgb2YgdGhlIGxhc3QgaW5zZXJ0ZWQgZG9tYWluIHdoZW4gYnJvd3NpbmdcbiAgdGhpcy5sYXN0SW5zZXJ0ZWRTdmcgPSBudWxsO1xuXG4gIHRoaXMuX2NvbXBsZXRlZCA9IGZhbHNlO1xuXG4gIC8vIFJlY29yZCBhbGwgdGhlIHZhbGlkIGRvbWFpbnNcbiAgLy8gRWFjaCBkb21haW4gdmFsdWUgaXMgYSB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gIHRoaXMuX2RvbWFpbnMgPSBkMy5tYXAoKTtcblxuICB0aGlzLmdyYXBoRGltID0ge1xuICAgIHdpZHRoOiAwLFxuICAgIGhlaWdodDogMCxcbiAgfTtcblxuICB0aGlzLmxlZ2VuZERpbSA9IHtcbiAgICB3aWR0aDogMCxcbiAgICBoZWlnaHQ6IDAsXG4gIH07XG5cbiAgdGhpcy5OQVZJR0FURV9MRUZUID0gMTtcbiAgdGhpcy5OQVZJR0FURV9SSUdIVCA9IDI7XG5cbiAgLy8gVmFyaW91cyB1cGRhdGUgbW9kZSB3aGVuIHVzaW5nIHRoZSB1cGRhdGUoKSBBUElcbiAgdGhpcy5SRVNFVF9BTExfT05fVVBEQVRFID0gMDtcbiAgdGhpcy5SRVNFVF9TSU5HTEVfT05fVVBEQVRFID0gMTtcbiAgdGhpcy5BUFBFTkRfT05fVVBEQVRFID0gMjtcblxuICB0aGlzLkRFRkFVTFRfTEVHRU5EX01BUkdJTiA9IDEwO1xuXG4gIHRoaXMucm9vdCA9IG51bGw7XG4gIHRoaXMudG9vbHRpcCA9IG51bGw7XG5cbiAgdGhpcy5fbWF4RG9tYWluUmVhY2hlZCA9IGZhbHNlO1xuICB0aGlzLl9taW5Eb21haW5SZWFjaGVkID0gZmFsc2U7XG5cbiAgdGhpcy5kb21haW5Qb3NpdGlvbiA9IG5ldyBEb21haW5Qb3NpdGlvbigpO1xuICB0aGlzLkxlZ2VuZCA9IG51bGw7XG4gIHRoaXMubGVnZW5kU2NhbGUgPSBudWxsO1xuXG4gIC8vIExpc3Qgb2YgZG9tYWlucyB0aGF0IGFyZSBza2lwcGVkIGJlY2F1c2Ugb2YgRFNUXG4gIC8vIEFsbCB0aW1lcyBiZWxvbmdpbmcgdG8gdGhlc2UgZG9tYWlucyBzaG91bGQgYmUgcmUtYXNzaWduZWQgdG8gdGhlIHByZXZpb3VzIGRvbWFpblxuICB0aGlzLkRTVERvbWFpbiA9IFtdO1xuXG4gIC8qKlxuICAgKiBEaXNwbGF5IHRoZSBncmFwaCBmb3IgdGhlIGZpcnN0IHRpbWVcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGNhbGVuZGFyIGlzIGNyZWF0ZWRcbiAgICovXG4gIHRoaXMuX2luaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgc2VsZlxuICAgICAgLmdldERvbWFpbihzZWxmLm9wdGlvbnMuc3RhcnQpXG4gICAgICAubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBkLmdldFRpbWUoKTtcbiAgICAgIH0pXG4gICAgICAubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHNlbGYuX2RvbWFpbnMuc2V0KFxuICAgICAgICAgIGQsXG4gICAgICAgICAgc2VsZi5nZXRTdWJEb21haW4oZCkubWFwKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICByZXR1cm4geyB0OiBzZWxmLl9kb21haW5UeXBlW3NlbGYub3B0aW9ucy5zdWJEb21haW5dLmV4dHJhY3RVbml0KGQpLCB2OiBudWxsIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgIHNlbGYucm9vdCA9IGQzXG4gICAgICAuc2VsZWN0KHNlbGYub3B0aW9ucy5pdGVtU2VsZWN0b3IpXG4gICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgJ2NhbC1oZWF0bWFwLWNvbnRhaW5lcicpO1xuXG4gICAgc2VsZi5yb290LmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXBwZW5kKCdzdmcnKS5hdHRyKCdjbGFzcycsICdncmFwaCcpO1xuXG4gICAgc2VsZi5MZWdlbmQgPSBuZXcgTGVnZW5kKHNlbGYpO1xuXG4gICAgaWYgKHNlbGYub3B0aW9ucy5wYWludE9uTG9hZCkge1xuICAgICAgX2luaXRDYWxlbmRhcigpO1xuICAgIH1cbiAgICBzZWxmLnJvb3QuY2FsbChzZWxmLnRpcCk7XG4gICAgc2VsZi5yb290LmNhbGwoc2VsZi5sZWdlbmRUaXApO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgZnVuY3Rpb24gX2luaXRDYWxlbmRhcigpIHtcbiAgICBzZWxmLnZlcnRpY2FsRG9tYWluTGFiZWwgPVxuICAgICAgc2VsZi5vcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAndG9wJyB8fCBzZWxmLm9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdib3R0b20nO1xuXG4gICAgc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0ID1cbiAgICAgIHNlbGYub3B0aW9ucy5sYWJlbC5oZWlnaHQgPT09IG51bGxcbiAgICAgICAgPyBNYXRoLm1heCgyNSwgc2VsZi5vcHRpb25zLmNlbGxTaXplICogMilcbiAgICAgICAgOiBzZWxmLm9wdGlvbnMubGFiZWwuaGVpZ2h0O1xuICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggPSAwO1xuXG4gICAgaWYgKHNlbGYub3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCA9PT0gJycgJiYgc2VsZi5vcHRpb25zLmxhYmVsLmhlaWdodCA9PT0gbnVsbCkge1xuICAgICAgc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0ID0gMDtcbiAgICB9XG5cbiAgICBpZiAoIXNlbGYudmVydGljYWxEb21haW5MYWJlbCkge1xuICAgICAgc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0ID0gMDtcbiAgICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggPSBzZWxmLm9wdGlvbnMubGFiZWwud2lkdGg7XG4gICAgfVxuXG4gICAgc2VsZi5wYWludCgpO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gQVRUQUNISU5HIERPTUFJTiBOQVZJR0FUSU9OIEVWRU5UICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIGlmIChzZWxmLm9wdGlvbnMubmV4dFNlbGVjdG9yICE9PSBmYWxzZSkge1xuICAgICAgZDMuc2VsZWN0KHNlbGYub3B0aW9ucy5uZXh0U2VsZWN0b3IpLm9uKCdjbGljay4nICsgc2VsZi5vcHRpb25zLml0ZW1OYW1lc3BhY2UsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZDMuZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIHNlbGYubG9hZE5leHREb21haW4oMSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoc2VsZi5vcHRpb25zLnByZXZpb3VzU2VsZWN0b3IgIT09IGZhbHNlKSB7XG4gICAgICBkMy5zZWxlY3Qoc2VsZi5vcHRpb25zLnByZXZpb3VzU2VsZWN0b3IpLm9uKFxuICAgICAgICAnY2xpY2suJyArIHNlbGYub3B0aW9ucy5pdGVtTmFtZXNwYWNlLFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZDMuZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICByZXR1cm4gc2VsZi5sb2FkUHJldmlvdXNEb21haW4oMSk7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIHNlbGYuTGVnZW5kLnJlZHJhdyhzZWxmLmdyYXBoRGltLndpZHRoIC0gc2VsZi5vcHRpb25zLmRvbWFpbkd1dHRlciAtIHNlbGYub3B0aW9ucy5jZWxsUGFkZGluZyk7XG4gICAgc2VsZi5hZnRlckxvYWQoKTtcblxuICAgIHZhciBkb21haW5zID0gc2VsZi5nZXREb21haW5LZXlzKCk7XG5cbiAgICAvLyBGaWxsIHRoZSBncmFwaCB3aXRoIHNvbWUgZGF0YXNcbiAgICBpZiAoc2VsZi5vcHRpb25zLmxvYWRPbkluaXQpIHtcbiAgICAgIHNlbGYuZ2V0RGF0YXMoXG4gICAgICAgIHNlbGYub3B0aW9ucy5kYXRhLFxuICAgICAgICBuZXcgRGF0ZShkb21haW5zWzBdKSxcbiAgICAgICAgc2VsZi5nZXRTdWJEb21haW4oZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdKS5wb3AoKSxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNlbGYuZmlsbCgpO1xuICAgICAgICAgIHNlbGYub25Db21wbGV0ZSgpO1xuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5vbkNvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgc2VsZi5jaGVja0lmTWluRG9tYWluSXNSZWFjaGVkKGRvbWFpbnNbMF0pO1xuICAgIHNlbGYuY2hlY2tJZk1heERvbWFpbklzUmVhY2hlZChzZWxmLmdldE5leHREb21haW4oKS5nZXRUaW1lKCkpO1xuICB9XG5cbiAgLy8gUmV0dXJuIHRoZSB3aWR0aCBvZiB0aGUgZG9tYWluIGJsb2NrLCB3aXRob3V0IHRoZSBkb21haW4gZ3V0dGVyXG4gIC8vIEBwYXJhbSBpbnQgZCBEb21haW4gc3RhcnQgdGltZXN0YW1wXG4gIGZ1bmN0aW9uIHcoZCwgb3V0ZXIpIHtcbiAgICB2YXIgd2lkdGggPVxuICAgICAgc2VsZi5vcHRpb25zLmNlbGxTaXplICogc2VsZi5fZG9tYWluVHlwZVtzZWxmLm9wdGlvbnMuc3ViRG9tYWluXS5jb2x1bW4oZCkgK1xuICAgICAgc2VsZi5vcHRpb25zLmNlbGxQYWRkaW5nICogc2VsZi5fZG9tYWluVHlwZVtzZWxmLm9wdGlvbnMuc3ViRG9tYWluXS5jb2x1bW4oZCk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgb3V0ZXIgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiAod2lkdGggKz1cbiAgICAgICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCArXG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5HdXR0ZXIgK1xuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluTWFyZ2luWzFdICtcbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbk1hcmdpblszXSk7XG4gICAgfVxuICAgIHJldHVybiB3aWR0aDtcbiAgfVxuXG4gIC8vIFJldHVybiB0aGUgaGVpZ2h0IG9mIHRoZSBkb21haW4gYmxvY2ssIHdpdGhvdXQgdGhlIGRvbWFpbiBndXR0ZXJcbiAgZnVuY3Rpb24gaChkLCBvdXRlcikge1xuICAgIHZhciBoZWlnaHQgPVxuICAgICAgc2VsZi5vcHRpb25zLmNlbGxTaXplICogc2VsZi5fZG9tYWluVHlwZVtzZWxmLm9wdGlvbnMuc3ViRG9tYWluXS5yb3coZCkgK1xuICAgICAgc2VsZi5vcHRpb25zLmNlbGxQYWRkaW5nICogc2VsZi5fZG9tYWluVHlwZVtzZWxmLm9wdGlvbnMuc3ViRG9tYWluXS5yb3coZCk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgb3V0ZXIgPT09IHRydWUpIHtcbiAgICAgIGhlaWdodCArPVxuICAgICAgICBzZWxmLm9wdGlvbnMuZG9tYWluR3V0dGVyICtcbiAgICAgICAgc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0ICtcbiAgICAgICAgc2VsZi5vcHRpb25zLmRvbWFpbk1hcmdpblswXSArXG4gICAgICAgIHNlbGYub3B0aW9ucy5kb21haW5NYXJnaW5bMl07XG4gICAgfVxuICAgIHJldHVybiBoZWlnaHQ7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICpcbiAgICogQHBhcmFtIGludCBuYXZpZ2F0aW9uRGlyXG4gICAqL1xuICB0aGlzLnBhaW50ID0gZnVuY3Rpb24gKG5hdmlnYXRpb25EaXIpIHtcbiAgICB2YXIgb3B0aW9ucyA9IHNlbGYub3B0aW9ucztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBuYXZpZ2F0aW9uRGlyID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gUGFpbnRpbmcgYWxsIHRoZSBkb21haW5zXG4gICAgdmFyIGRvbWFpblN2ZyA9IHNlbGYucm9vdFxuICAgICAgLnNlbGVjdCgnLmdyYXBoJylcbiAgICAgIC5zZWxlY3RBbGwoJy5ncmFwaC1kb21haW4nKVxuICAgICAgLmRhdGEoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgZGF0YSA9IHNlbGYuZ2V0RG9tYWluS2V5cygpO1xuICAgICAgICAgIHJldHVybiBuYXZpZ2F0aW9uRGlyID09PSBzZWxmLk5BVklHQVRFX0xFRlQgPyBkYXRhLnJldmVyc2UoKSA6IGRhdGE7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIGQ7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIHZhciBlbnRlcmluZ0RvbWFpbkRpbSA9IDA7XG4gICAgdmFyIGV4aXRpbmdEb21haW5EaW0gPSAwO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gUEFJTlRJTkcgRE9NQUlOICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAgIHZhciBzdmcgPSBkb21haW5TdmdcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKCdzdmcnKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHcoZCwgdHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBoKGQsIHRydWUpO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbikge1xuICAgICAgICAgIHNlbGYuZ3JhcGhEaW0ud2lkdGggPSBNYXRoLm1heChzZWxmLmdyYXBoRGltLndpZHRoLCB3KGQsIHRydWUpKTtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZ2V0RG9tYWluUG9zaXRpb24oZCwgc2VsZi5ncmFwaERpbSwgJ3dpZHRoJywgdyhkLCB0cnVlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24pIHtcbiAgICAgICAgICByZXR1cm4gZ2V0RG9tYWluUG9zaXRpb24oZCwgc2VsZi5ncmFwaERpbSwgJ2hlaWdodCcsIGgoZCwgdHJ1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuZ3JhcGhEaW0uaGVpZ2h0ID0gTWF0aC5tYXgoc2VsZi5ncmFwaERpbS5oZWlnaHQsIGgoZCwgdHJ1ZSkpO1xuICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGNsYXNzbmFtZSA9ICdncmFwaC1kb21haW4nO1xuICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGQpO1xuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMuZG9tYWluKSB7XG4gICAgICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgICAgICBjbGFzc25hbWUgKz0gJyBoXycgKyBkYXRlLmdldEhvdXJzKCk7XG4gICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqL1xuICAgICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgICBjbGFzc25hbWUgKz0gJyBkXycgKyBkYXRlLmdldERhdGUoKSArICcgZHlfJyArIGRhdGUuZ2V0RGF5KCk7XG4gICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqL1xuICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgY2xhc3NuYW1lICs9ICcgd18nICsgc2VsZi5nZXRXZWVrTnVtYmVyKGRhdGUpO1xuICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICBjbGFzc25hbWUgKz0gJyBtXycgKyAoZGF0ZS5nZXRNb250aCgpICsgMSk7XG4gICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqL1xuICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgY2xhc3NuYW1lICs9ICcgeV8nICsgZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjbGFzc25hbWU7XG4gICAgICB9KTtcbiAgICBzZWxmLmxhc3RJbnNlcnRlZFN2ZyA9IHN2ZztcblxuICAgIGZ1bmN0aW9uIGdldERvbWFpblBvc2l0aW9uKGRvbWFpbkluZGV4LCBncmFwaERpbSwgYXhpcywgZG9tYWluRGltKSB7XG4gICAgICB2YXIgdG1wID0gMDtcbiAgICAgIHN3aXRjaCAobmF2aWdhdGlvbkRpcikge1xuICAgICAgICBjYXNlIGZhbHNlOlxuICAgICAgICAgIHRtcCA9IGdyYXBoRGltW2F4aXNdO1xuXG4gICAgICAgICAgZ3JhcGhEaW1bYXhpc10gKz0gZG9tYWluRGltO1xuICAgICAgICAgIHNlbGYuZG9tYWluUG9zaXRpb24uc2V0UG9zaXRpb24oZG9tYWluSW5kZXgsIHRtcCk7XG4gICAgICAgICAgcmV0dXJuIHRtcDtcblxuICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfUklHSFQ6XG4gICAgICAgICAgc2VsZi5kb21haW5Qb3NpdGlvbi5zZXRQb3NpdGlvbihkb21haW5JbmRleCwgZ3JhcGhEaW1bYXhpc10pO1xuXG4gICAgICAgICAgZW50ZXJpbmdEb21haW5EaW0gPSBkb21haW5EaW07XG4gICAgICAgICAgZXhpdGluZ0RvbWFpbkRpbSA9IHNlbGYuZG9tYWluUG9zaXRpb24uZ2V0UG9zaXRpb25Gcm9tSW5kZXgoMSk7XG5cbiAgICAgICAgICBzZWxmLmRvbWFpblBvc2l0aW9uLnNoaWZ0UmlnaHRCeShleGl0aW5nRG9tYWluRGltKTtcbiAgICAgICAgICByZXR1cm4gZ3JhcGhEaW1bYXhpc107XG5cbiAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX0xFRlQ6XG4gICAgICAgICAgdG1wID0gLWRvbWFpbkRpbTtcblxuICAgICAgICAgIGVudGVyaW5nRG9tYWluRGltID0gLXRtcDtcbiAgICAgICAgICBleGl0aW5nRG9tYWluRGltID0gZ3JhcGhEaW1bYXhpc10gLSBzZWxmLmRvbWFpblBvc2l0aW9uLmdldExhc3QoKTtcblxuICAgICAgICAgIHNlbGYuZG9tYWluUG9zaXRpb24uc2V0UG9zaXRpb24oZG9tYWluSW5kZXgsIHRtcCk7XG4gICAgICAgICAgc2VsZi5kb21haW5Qb3NpdGlvbi5zaGlmdExlZnRCeShlbnRlcmluZ0RvbWFpbkRpbSk7XG4gICAgICAgICAgcmV0dXJuIHRtcDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzdmdcbiAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHcoZCwgdHJ1ZSkgLSBvcHRpb25zLmRvbWFpbkd1dHRlciAtIG9wdGlvbnMuY2VsbFBhZGRpbmc7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBoKGQsIHRydWUpIC0gb3B0aW9ucy5kb21haW5HdXR0ZXIgLSBvcHRpb25zLmNlbGxQYWRkaW5nO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCdjbGFzcycsICdkb21haW4tYmFja2dyb3VuZCcpO1xuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgLy8gUEFJTlRJTkcgU1VCRE9NQUlOUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIHZhciBzdWJEb21haW5TdmdHcm91cCA9IHN2Z1xuICAgICAgLmFwcGVuZCgnc3ZnJylcbiAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ2xlZnQnKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggKyBvcHRpb25zLmRvbWFpbk1hcmdpblszXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5kb21haW5NYXJnaW5bM107XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuYXR0cigneScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCArIG9wdGlvbnMuZG9tYWluTWFyZ2luWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBvcHRpb25zLmRvbWFpbk1hcmdpblswXTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5hdHRyKCdjbGFzcycsICdncmFwaC1zdWJkb21haW4tZ3JvdXAnKTtcbiAgICB2YXIgcmVjdCA9IHN1YkRvbWFpblN2Z0dyb3VwXG4gICAgICAuc2VsZWN0QWxsKCdnJylcbiAgICAgIC5kYXRhKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLl9kb21haW5zLmdldChkKTtcbiAgICAgIH0pXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZCgnZycpO1xuICAgIHJlY3RcbiAgICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAnZ3JhcGgtcmVjdCcgK1xuICAgICAgICAgIHNlbGYuZ2V0SGlnaGxpZ2h0Q2xhc3NOYW1lKGQudCkgK1xuICAgICAgICAgIChvcHRpb25zLm9uQ2xpY2sgIT09IG51bGwgPyAnIGhvdmVyX2N1cnNvcicgOiAnJylcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgICAuYXR0cignd2lkdGgnLCBvcHRpb25zLmNlbGxTaXplKVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIG9wdGlvbnMuY2VsbFNpemUpXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnBvc2l0aW9uU3ViRG9tYWluWChkLnQpO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYucG9zaXRpb25TdWJEb21haW5ZKGQudCk7XG4gICAgICB9KVxuICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLm9uQ2xpY2sgIT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5vbkNsaWNrKG5ldyBEYXRlKGQudCksIGQudik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2FsbChmdW5jdGlvbiAoc2VsZWN0aW9uKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmNlbGxSYWRpdXMgPiAwKSB7XG4gICAgICAgICAgc2VsZWN0aW9uLmF0dHIoJ3J4Jywgb3B0aW9ucy5jZWxsUmFkaXVzKS5hdHRyKCdyeScsIG9wdGlvbnMuY2VsbFJhZGl1cyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgc2VsZi5sZWdlbmRTY2FsZSAhPT0gbnVsbCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzICE9PSBudWxsICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2Jhc2UnKVxuICAgICAgICApIHtcbiAgICAgICAgICBzZWxlY3Rpb24uYXR0cignZmlsbCcsIG9wdGlvbnMubGVnZW5kQ29sb3JzLmJhc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMudG9vbHRpcCkge1xuICAgICAgICAgIHNlbGVjdGlvblxuICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICBzZWxmLnRpcC5zaG93KGQsIHRoaXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHNlbGYudGlwLmhpZGUoZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAvLyBBcHBlbmRpbmcgYSB0aXRsZSB0byBlYWNoIHN1YmRvbWFpblxuICAgIGlmICghb3B0aW9ucy50b29sdGlwKSB7XG4gICAgICByZWN0LmFwcGVuZCgndGl0bGUnKS50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmZvcm1hdERhdGUobmV3IERhdGUoZC50KSwgb3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIFBBSU5USU5HIExBQkVMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICBpZiAob3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCAhPT0gJycpIHtcbiAgICAgIHN2Z1xuICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2dyYXBoLWxhYmVsJylcbiAgICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgIHZhciB5ID0gb3B0aW9ucy5kb21haW5NYXJnaW5bMF07XG4gICAgICAgICAgc3dpdGNoIChvcHRpb25zLmxhYmVsLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgICAgICB5ICs9IHNlbGYuZG9tYWluVmVydGljYWxMYWJlbEhlaWdodCAvIDI7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYm90dG9tJzpcbiAgICAgICAgICAgICAgeSArPSBoKGQpICsgc2VsZi5kb21haW5WZXJ0aWNhbExhYmVsSGVpZ2h0IC8gMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgeSArXG4gICAgICAgICAgICBvcHRpb25zLmxhYmVsLm9mZnNldC55ICpcbiAgICAgICAgICAgICAgKChvcHRpb25zLmxhYmVsLnJvdGF0ZSA9PT0gJ3JpZ2h0JyAmJiBvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAncmlnaHQnKSB8fFxuICAgICAgICAgICAgICAob3B0aW9ucy5sYWJlbC5yb3RhdGUgPT09ICdsZWZ0JyAmJiBvcHRpb25zLmxhYmVsLnBvc2l0aW9uID09PSAnbGVmdCcpXG4gICAgICAgICAgICAgICAgPyAtMVxuICAgICAgICAgICAgICAgIDogMSlcbiAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgdmFyIHggPSBvcHRpb25zLmRvbWFpbk1hcmdpblszXTtcbiAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucG9zaXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgeCArPSB3KGQpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgICBjYXNlICd0b3AnOlxuICAgICAgICAgICAgICB4ICs9IHcoZCkgLyAyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChvcHRpb25zLmxhYmVsLmFsaWduID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICB4ICtcbiAgICAgICAgICAgICAgc2VsZi5kb21haW5Ib3Jpem9udGFsTGFiZWxXaWR0aCAtXG4gICAgICAgICAgICAgIG9wdGlvbnMubGFiZWwub2Zmc2V0LnggKiAob3B0aW9ucy5sYWJlbC5yb3RhdGUgPT09ICdyaWdodCcgPyAtMSA6IDEpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4geCArIG9wdGlvbnMubGFiZWwub2Zmc2V0Lng7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwuYWxpZ24pIHtcbiAgICAgICAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgICAgICAgICByZXR1cm4gJ3N0YXJ0JztcbiAgICAgICAgICAgIGNhc2UgJ2VuZCc6XG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgIHJldHVybiAnZW5kJztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHJldHVybiAnbWlkZGxlJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCdkb21pbmFudC1iYXNlbGluZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi52ZXJ0aWNhbERvbWFpbkxhYmVsID8gJ21pZGRsZScgOiAndG9wJztcbiAgICAgICAgfSlcbiAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtYXREYXRlKG5ldyBEYXRlKGQpLCBvcHRpb25zLmRvbWFpbkxhYmVsRm9ybWF0KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhbGwoZG9tYWluUm90YXRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkb21haW5Sb3RhdGUoc2VsZWN0aW9uKSB7XG4gICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucm90YXRlKSB7XG4gICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICBzZWxlY3Rpb24uYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIHZhciBzID0gJ3JvdGF0ZSg5MCksICc7XG4gICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgICAgIHMgKz0gJ3RyYW5zbGF0ZSgtJyArIHcoZCkgKyAnICwgLScgKyB3KGQpICsgJyknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgICAgICBzICs9ICd0cmFuc2xhdGUoMCwgLScgKyBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoICsgJyknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgc2VsZWN0aW9uLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICB2YXIgcyA9ICdyb3RhdGUoMjcwKSwgJztcbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbikge1xuICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgcyArPSAndHJhbnNsYXRlKC0nICsgKHcoZCkgKyBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoKSArICcgLCAnICsgdyhkKSArICcpJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgICAgcyArPVxuICAgICAgICAgICAgICAgICAgJ3RyYW5zbGF0ZSgtJyArXG4gICAgICAgICAgICAgICAgICBzZWxmLmRvbWFpbkhvcml6b250YWxMYWJlbFdpZHRoICtcbiAgICAgICAgICAgICAgICAgICcgLCAnICtcbiAgICAgICAgICAgICAgICAgIHNlbGYuZG9tYWluSG9yaXpvbnRhbExhYmVsV2lkdGggK1xuICAgICAgICAgICAgICAgICAgJyknO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyBQQUlOVElORyBET01BSU4gU1VCRE9NQUlOIENPTlRFTlQgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gICAgaWYgKG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCAhPT0gbnVsbCkge1xuICAgICAgcmVjdFxuICAgICAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gJ3N1YmRvbWFpbi10ZXh0JyArIHNlbGYuZ2V0SGlnaGxpZ2h0Q2xhc3NOYW1lKGQudCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5wb3NpdGlvblN1YkRvbWFpblgoZC50KSArIG9wdGlvbnMuY2VsbFNpemUgLyAyO1xuICAgICAgICB9KVxuICAgICAgICAuYXR0cigneScsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIHNlbGYucG9zaXRpb25TdWJEb21haW5ZKGQudCkgKyBvcHRpb25zLmNlbGxTaXplIC8gMjtcbiAgICAgICAgfSlcbiAgICAgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpXG4gICAgICAgIC5hdHRyKCdkb21pbmFudC1iYXNlbGluZScsICdjZW50cmFsJylcbiAgICAgICAgLnRleHQoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gc2VsZi5mb3JtYXREYXRlKG5ldyBEYXRlKGQudCksIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vIEFOSU1BVElPTiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAgIGlmIChuYXZpZ2F0aW9uRGlyICE9PSBmYWxzZSkge1xuICAgICAgZG9tYWluU3ZnXG4gICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAgIC5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uID8gMCA6IHNlbGYuZG9tYWluUG9zaXRpb24uZ2V0UG9zaXRpb24oZCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uID8gc2VsZi5kb21haW5Qb3NpdGlvbi5nZXRQb3NpdGlvbihkKSA6IDA7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHZhciB0ZW1wV2lkdGggPSBzZWxmLmdyYXBoRGltLndpZHRoO1xuICAgIHZhciB0ZW1wSGVpZ2h0ID0gc2VsZi5ncmFwaERpbS5oZWlnaHQ7XG5cbiAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbE9yaWVudGF0aW9uKSB7XG4gICAgICBzZWxmLmdyYXBoRGltLmhlaWdodCArPSBlbnRlcmluZ0RvbWFpbkRpbSAtIGV4aXRpbmdEb21haW5EaW07XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYuZ3JhcGhEaW0ud2lkdGggKz0gZW50ZXJpbmdEb21haW5EaW0gLSBleGl0aW5nRG9tYWluRGltO1xuICAgIH1cblxuICAgIC8vIEF0IHRoZSB0aW1lIG9mIGV4aXQsIGRvbWFpbnNXaWR0aCBhbmQgZG9tYWluc0hlaWdodCBhbHJlYWR5IGF1dG9tYXRpY2FsbHkgc2hpZnRlZFxuICAgIGRvbWFpblN2Z1xuICAgICAgLmV4aXQoKVxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2FsT3JpZW50YXRpb24pIHtcbiAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzd2l0Y2ggKG5hdmlnYXRpb25EaXIpIHtcbiAgICAgICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9MRUZUOlxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oc2VsZi5ncmFwaERpbS53aWR0aCwgdGVtcFdpZHRoKTtcbiAgICAgICAgICAgIGNhc2Ugc2VsZi5OQVZJR0FURV9SSUdIVDpcbiAgICAgICAgICAgICAgcmV0dXJuIC13KGQsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudmVydGljYWxPcmllbnRhdGlvbikge1xuICAgICAgICAgIHN3aXRjaCAobmF2aWdhdGlvbkRpcikge1xuICAgICAgICAgICAgY2FzZSBzZWxmLk5BVklHQVRFX0xFRlQ6XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihzZWxmLmdyYXBoRGltLmhlaWdodCwgdGVtcEhlaWdodCk7XG4gICAgICAgICAgICBjYXNlIHNlbGYuTkFWSUdBVEVfUklHSFQ6XG4gICAgICAgICAgICAgIHJldHVybiAtaChkLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAucmVtb3ZlKCk7XG5cbiAgICAvLyBSZXNpemUgdGhlIHJvb3QgY29udGFpbmVyXG4gICAgc2VsZi5yZXNpemUoKTtcbiAgfTtcbn07XG5cbkNhbEhlYXRNYXAucHJvdG90eXBlID0ge1xuICAvKipcbiAgICogVmFsaWRhdGUgYW5kIG1lcmdlIHVzZXIgc2V0dGluZ3Mgd2l0aCBkZWZhdWx0IHNldHRpbmdzXG4gICAqXG4gICAqIEBwYXJhbSAge29iamVjdH0gc2V0dGluZ3MgVXNlciBzZXR0aW5nc1xuICAgKiBAcmV0dXJuIHtib29sfSBGYWxzZSBpZiBzZXR0aW5ncyBjb250YWlucyBlcnJvclxuICAgKi9cbiAgLyoganNoaW50IG1heHN0YXRlbWVudHM6ZmFsc2UgKi9cbiAgaW5pdDogZnVuY3Rpb24gKHNldHRpbmdzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IChwYXJlbnQub3B0aW9ucyA9IG1lcmdlUmVjdXJzaXZlKHBhcmVudC5vcHRpb25zLCBzZXR0aW5ncykpO1xuXG4gICAgLy8gRmF0YWwgZXJyb3JzXG4gICAgLy8gU3RvcCBzY3JpcHQgZXhlY3V0aW9uIG9uIGVycm9yXG4gICAgdmFsaWRhdGVEb21haW5UeXBlKCk7XG4gICAgdmFsaWRhdGVTZWxlY3RvcihvcHRpb25zLml0ZW1TZWxlY3RvciwgZmFsc2UsICdpdGVtU2VsZWN0b3InKTtcblxuICAgIGlmIChwYXJlbnQuYWxsb3dlZERhdGFUeXBlLmluZGV4T2Yob3B0aW9ucy5kYXRhVHlwZSkgPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZGF0YSB0eXBlICdcIiArIG9wdGlvbnMuZGF0YVR5cGUgKyBcIicgaXMgbm90IHZhbGlkIGRhdGEgdHlwZVwiKTtcbiAgICB9XG5cbiAgICBpZiAoZDMuc2VsZWN0KG9wdGlvbnMuaXRlbVNlbGVjdG9yKVswXVswXSA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIlRoZSBub2RlICdcIiArIG9wdGlvbnMuaXRlbVNlbGVjdG9yICsgXCInIHNwZWNpZmllZCBpbiBpdGVtU2VsZWN0b3IgZG9lcyBub3QgZXhpc3RzXCIsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZVNlbGVjdG9yKG9wdGlvbnMubmV4dFNlbGVjdG9yLCB0cnVlLCAnbmV4dFNlbGVjdG9yJyk7XG4gICAgICB2YWxpZGF0ZVNlbGVjdG9yKG9wdGlvbnMucHJldmlvdXNTZWxlY3RvciwgdHJ1ZSwgJ3ByZXZpb3VzU2VsZWN0b3InKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IubWVzc2FnZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gSWYgb3RoZXIgc2V0dGluZ3MgY29udGFpbnMgZXJyb3IsIHdpbGwgZmFsbGJhY2sgdG8gZGVmYXVsdFxuXG4gICAgaWYgKCFzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnc3ViRG9tYWluJykpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5zdWJEb21haW4gPSBnZXRPcHRpbWFsU3ViRG9tYWluKHNldHRpbmdzLmRvbWFpbik7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBvcHRpb25zLml0ZW1OYW1lc3BhY2UgIT09ICdzdHJpbmcnIHx8IG9wdGlvbnMuaXRlbU5hbWVzcGFjZSA9PT0gJycpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdpdGVtTmFtZXNwYWNlIGNhbiBub3QgYmUgZW1wdHksIGZhbGxpbmcgYmFjayB0byBjYWwtaGVhdG1hcCcpO1xuICAgICAgb3B0aW9ucy5pdGVtTmFtZXNwYWNlID0gJ2NhbC1oZWF0bWFwJztcbiAgICB9XG5cbiAgICAvLyBEb24ndCB0b3VjaCB0aGVzZSBzZXR0aW5nc1xuICAgIHZhciBzID0gW1xuICAgICAgJ2RhdGEnLFxuICAgICAgJ29uQ29tcGxldGUnLFxuICAgICAgJ29uQ2xpY2snLFxuICAgICAgJ2FmdGVyTG9hZCcsXG4gICAgICAnYWZ0ZXJMb2FkRGF0YScsXG4gICAgICAnYWZ0ZXJMb2FkUHJldmlvdXNEb21haW4nLFxuICAgICAgJ2FmdGVyTG9hZE5leHREb21haW4nLFxuICAgICAgJ2FmdGVyVXBkYXRlJyxcbiAgICBdO1xuXG4gICAgZm9yICh2YXIgayBpbiBzKSB7XG4gICAgICBpZiAoc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoc1trXSkpIHtcbiAgICAgICAgb3B0aW9uc1tzW2tdXSA9IHNldHRpbmdzW3Nba11dO1xuICAgICAgfVxuICAgIH1cblxuICAgIG9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCA9XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0ID09PSAnc3RyaW5nJyB8fFxuICAgICAgdHlwZW9mIG9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICA/IG9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdFxuICAgICAgICA6IHRoaXMuX2RvbWFpblR5cGVbb3B0aW9ucy5zdWJEb21haW5dLmZvcm1hdC5kYXRlO1xuICAgIG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQgPVxuICAgICAgdHlwZW9mIG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXQgPT09ICdzdHJpbmcnIHx8XG4gICAgICB0eXBlb2Ygb3B0aW9ucy5kb21haW5MYWJlbEZvcm1hdCA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICA/IG9wdGlvbnMuZG9tYWluTGFiZWxGb3JtYXRcbiAgICAgICAgOiB0aGlzLl9kb21haW5UeXBlW29wdGlvbnMuZG9tYWluXS5mb3JtYXQubGVnZW5kO1xuICAgIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCA9XG4gICAgICAodHlwZW9mIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdCA9PT0gJ3N0cmluZycgJiYgb3B0aW9ucy5zdWJEb21haW5UZXh0Rm9ybWF0ICE9PSAnJykgfHxcbiAgICAgIHR5cGVvZiBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXRcbiAgICAgICAgOiBudWxsO1xuICAgIG9wdGlvbnMuZG9tYWluTWFyZ2luID0gZXhwYW5kTWFyZ2luU2V0dGluZyhvcHRpb25zLmRvbWFpbk1hcmdpbik7XG4gICAgb3B0aW9ucy5sZWdlbmRNYXJnaW4gPSBleHBhbmRNYXJnaW5TZXR0aW5nKG9wdGlvbnMubGVnZW5kTWFyZ2luKTtcbiAgICBvcHRpb25zLmhpZ2hsaWdodCA9IHBhcmVudC5leHBhbmREYXRlU2V0dGluZyhvcHRpb25zLmhpZ2hsaWdodCk7XG4gICAgb3B0aW9ucy5pdGVtTmFtZSA9IGV4cGFuZEl0ZW1OYW1lKG9wdGlvbnMuaXRlbU5hbWUpO1xuICAgIG9wdGlvbnMuY29sTGltaXQgPSBwYXJzZUNvbExpbWl0KG9wdGlvbnMuY29sTGltaXQpO1xuICAgIG9wdGlvbnMucm93TGltaXQgPSBwYXJzZVJvd0xpbWl0KG9wdGlvbnMucm93TGltaXQpO1xuICAgIGlmICghc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ2xlZ2VuZE1hcmdpbicpKSB7XG4gICAgICBhdXRvQWRkTGVnZW5kTWFyZ2luKCk7XG4gICAgfVxuICAgIGF1dG9BbGlnbkxhYmVsKCk7XG5cbiAgICAvKipcbiAgICAgKiBWYWxpZGF0ZSB0aGF0IGEgcXVlcnlTdHJpbmcgaXMgdmFsaWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSAge0VsZW1lbnR8c3RyaW5nfGJvb2x9IHNlbGVjdG9yICAgVGhlIHF1ZXJ5U3RyaW5nIHRvIHRlc3RcbiAgICAgKiBAcGFyYW0gIHtib29sfSAgY2FuQmVGYWxzZSAgV2hldGhlciBmYWxzZSBpcyBhbiBhY2NlcHRlZCBhbmQgdmFsaWQgdmFsdWVcbiAgICAgKiBAcGFyYW0gIHtzdHJpbmd9IG5hbWUgICAgTmFtZSBvZiB0aGUgdGVzdGVkIHNlbGVjdG9yXG4gICAgICogQHRocm93cyB7RXJyb3J9ICAgICAgICBJZiB0aGUgc2VsZWN0b3IgaXMgbm90IHZhbGlkXG4gICAgICogQHJldHVybiB7Ym9vbH0gICAgICAgIFRydWUgaWYgdGhlIHNlbGVjdG9yIGlzIGEgdmFsaWQgcXVlcnlTdHJpbmdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB2YWxpZGF0ZVNlbGVjdG9yKHNlbGVjdG9yLCBjYW5CZUZhbHNlLCBuYW1lKSB7XG4gICAgICBpZiAoXG4gICAgICAgICgoY2FuQmVGYWxzZSAmJiBzZWxlY3RvciA9PT0gZmFsc2UpIHx8XG4gICAgICAgICAgc2VsZWN0b3IgaW5zdGFuY2VvZiBFbGVtZW50IHx8XG4gICAgICAgICAgdHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykgJiZcbiAgICAgICAgc2VsZWN0b3IgIT09ICcnXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSAnICsgbmFtZSArICcgaXMgbm90IHZhbGlkJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBvcHRpbWFsIHN1YkRvbWFpbiBmb3IgdGhlIHNwZWNpZmllZCBkb21haW5cbiAgICAgKlxuICAgICAqIEBwYXJhbSAge3N0cmluZ30gZG9tYWluIGEgZG9tYWluIG5hbWVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9ICAgICAgICB0aGUgc3ViRG9tYWluIG5hbWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRPcHRpbWFsU3ViRG9tYWluKGRvbWFpbikge1xuICAgICAgc3dpdGNoIChkb21haW4pIHtcbiAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgcmV0dXJuICdtb250aCc7XG4gICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICByZXR1cm4gJ2RheSc7XG4gICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgIHJldHVybiAnZGF5JztcbiAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICByZXR1cm4gJ2hvdXInO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHJldHVybiAnbWluJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbnN1cmUgdGhhdCB0aGUgZG9tYWluIGFuZCBzdWJkb21haW4gYXJlIHZhbGlkXG4gICAgICpcbiAgICAgKiBAdGhyb3cge0Vycm9yfSB3aGVuIGRvbWFpbiBvciBzdWJkb21haW4gYXJlIG5vdCB2YWxpZFxuICAgICAqIEByZXR1cm4ge2Jvb2x9IFRydWUgaWYgZG9tYWluIGFuZCBzdWJkb21haW4gYXJlIHZhbGlkIGFuZCBjb21wYXRpYmxlXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsaWRhdGVEb21haW5UeXBlKCkge1xuICAgICAgaWYgKFxuICAgICAgICAhcGFyZW50Ll9kb21haW5UeXBlLmhhc093blByb3BlcnR5KG9wdGlvbnMuZG9tYWluKSB8fFxuICAgICAgICBvcHRpb25zLmRvbWFpbiA9PT0gJ21pbicgfHxcbiAgICAgICAgb3B0aW9ucy5kb21haW4uc3Vic3RyaW5nKDAsIDIpID09PSAneF8nXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGRvbWFpbiAnXCIgKyBvcHRpb25zLmRvbWFpbiArIFwiJyBpcyBub3QgdmFsaWRcIik7XG4gICAgICB9XG5cbiAgICAgIGlmICghcGFyZW50Ll9kb21haW5UeXBlLmhhc093blByb3BlcnR5KG9wdGlvbnMuc3ViRG9tYWluKSB8fCBvcHRpb25zLnN1YkRvbWFpbiA9PT0gJ3llYXInKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBzdWJEb21haW4gJ1wiICsgb3B0aW9ucy5zdWJEb21haW4gKyBcIicgaXMgbm90IHZhbGlkXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAocGFyZW50Ll9kb21haW5UeXBlW29wdGlvbnMuZG9tYWluXS5sZXZlbCA8PSBwYXJlbnQuX2RvbWFpblR5cGVbb3B0aW9ucy5zdWJEb21haW5dLmxldmVsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIidcIiArIG9wdGlvbnMuc3ViRG9tYWluICsgXCInIGlzIG5vdCBhIHZhbGlkIHN1YkRvbWFpbiB0byAnXCIgKyBvcHRpb25zLmRvbWFpbiArIFwiJ1wiLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5lLXR1bmUgdGhlIGxhYmVsIGFsaWduZW1lbnQgZGVwZW5kaW5nIG9uIGl0cyBwb3NpdGlvblxuICAgICAqXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXV0b0FsaWduTGFiZWwoKSB7XG4gICAgICAvLyBBdXRvLWFsaWduIGxhYmVsLCBkZXBlbmRpbmcgb24gaXQncyBwb3NpdGlvblxuICAgICAgaWYgKFxuICAgICAgICAhc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ2xhYmVsJykgfHxcbiAgICAgICAgKHNldHRpbmdzLmhhc093blByb3BlcnR5KCdsYWJlbCcpICYmICFzZXR0aW5ncy5sYWJlbC5oYXNPd25Qcm9wZXJ0eSgnYWxpZ24nKSlcbiAgICAgICkge1xuICAgICAgICBzd2l0Y2ggKG9wdGlvbnMubGFiZWwucG9zaXRpb24pIHtcbiAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgIG9wdGlvbnMubGFiZWwuYWxpZ24gPSAncmlnaHQnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncmlnaHQnOlxuICAgICAgICAgICAgb3B0aW9ucy5sYWJlbC5hbGlnbiA9ICdsZWZ0JztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBvcHRpb25zLmxhYmVsLmFsaWduID0gJ2NlbnRlcic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5sYWJlbC5yb3RhdGUgPT09ICdsZWZ0Jykge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWwuYWxpZ24gPSAncmlnaHQnO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMubGFiZWwucm90YXRlID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgb3B0aW9ucy5sYWJlbC5hbGlnbiA9ICdsZWZ0JztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgICFzZXR0aW5ncy5oYXNPd25Qcm9wZXJ0eSgnbGFiZWwnKSB8fFxuICAgICAgICAoc2V0dGluZ3MuaGFzT3duUHJvcGVydHkoJ2xhYmVsJykgJiYgIXNldHRpbmdzLmxhYmVsLmhhc093blByb3BlcnR5KCdvZmZzZXQnKSlcbiAgICAgICkge1xuICAgICAgICBpZiAob3B0aW9ucy5sYWJlbC5wb3NpdGlvbiA9PT0gJ2xlZnQnIHx8IG9wdGlvbnMubGFiZWwucG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICBvcHRpb25zLmxhYmVsLm9mZnNldCA9IHtcbiAgICAgICAgICAgIHg6IDEwLFxuICAgICAgICAgICAgeTogMTUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIElmIG5vdCBzcGVjaWZpZWQsIGFkZCBzb21lIG1hcmdpbiBhcm91bmQgdGhlIGxlZ2VuZCBkZXBlbmRpbmcgb24gaXRzIHBvc2l0aW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhdXRvQWRkTGVnZW5kTWFyZ2luKCkge1xuICAgICAgc3dpdGNoIChvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24pIHtcbiAgICAgICAgY2FzZSAndG9wJzpcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZE1hcmdpblsyXSA9IHBhcmVudC5ERUZBVUxUX0xFR0VORF9NQVJHSU47XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2JvdHRvbSc6XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMF0gPSBwYXJlbnQuREVGQVVMVF9MRUdFTkRfTUFSR0lOO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdtaWRkbGUnOlxuICAgICAgICBjYXNlICdjZW50ZXInOlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kTWFyZ2luW29wdGlvbnMubGVnZW5kSG9yaXpvbnRhbFBvc2l0aW9uID09PSAncmlnaHQnID8gMyA6IDFdID1cbiAgICAgICAgICAgIHBhcmVudC5ERUZBVUxUX0xFR0VORF9NQVJHSU47XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhwYW5kIGEgbnVtYmVyIG9mIGFuIGFycmF5IG9mIG51bWJlcnMgdG8gYW4gdXNhYmxlIDQgdmFsdWVzIGFycmF5XG4gICAgICpcbiAgICAgKiBAcGFyYW0gIHtpbnRlZ2VyfGFycmF5fSB2YWx1ZVxuICAgICAqIEByZXR1cm4ge2FycmF5fSAgICAgICAgYXJyYXlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBleHBhbmRNYXJnaW5TZXR0aW5nKHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICB2YWx1ZSA9IFt2YWx1ZV07XG4gICAgICB9XG5cbiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ01hcmdpbiBvbmx5IHRha2VzIGFuIGludGVnZXIgb3IgYW4gYXJyYXkgb2YgaW50ZWdlcnMnKTtcbiAgICAgICAgdmFsdWUgPSBbMF07XG4gICAgICB9XG5cbiAgICAgIHN3aXRjaCAodmFsdWUubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICByZXR1cm4gW3ZhbHVlWzBdLCB2YWx1ZVswXSwgdmFsdWVbMF0sIHZhbHVlWzBdXTtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIHJldHVybiBbdmFsdWVbMF0sIHZhbHVlWzFdLCB2YWx1ZVswXSwgdmFsdWVbMV1dO1xuICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgcmV0dXJuIFt2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdLCB2YWx1ZVsxXV07XG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIHZhbHVlLnNsaWNlKDAsIDQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgYSBzdHJpbmcgdG8gYW4gYXJyYXkgbGlrZSBbc2luZ3VsYXItZm9ybSwgcGx1cmFsLWZvcm1dXG4gICAgICpcbiAgICAgKiBAcGFyYW0gIHtzdHJpbmd8YXJyYXl9IHZhbHVlIERhdGUgdG8gY29udmVydFxuICAgICAqIEByZXR1cm4ge2FycmF5fSAgICAgICBBbiBhcnJheSBsaWtlIFtzaW5ndWxhci1mb3JtLCBwbHVyYWwtZm9ybV1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBleHBhbmRJdGVtTmFtZSh2YWx1ZSkge1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIFt2YWx1ZSwgdmFsdWUgKyAodmFsdWUgIT09ICcnID8gJ3MnIDogJycpXTtcbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICByZXR1cm4gW3ZhbHVlWzBdLCB2YWx1ZVswXSArICdzJ107XG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUubGVuZ3RoID4gMikge1xuICAgICAgICAgIHJldHVybiB2YWx1ZS5zbGljZSgwLCAyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFsnaXRlbScsICdpdGVtcyddO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhcnNlQ29sTGltaXQodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA+IDAgPyB2YWx1ZSA6IG51bGw7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFyc2VSb3dMaW1pdCh2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlID4gMCAmJiBvcHRpb25zLmNvbExpbWl0ID4gMCkge1xuICAgICAgICBjb25zb2xlLmxvZygnY29sTGltaXQgYW5kIHJvd0xpbWl0IGFyZSBtdXR1YWxseSBleGNsdXNpdmUsIHJvd0xpbWl0IHdpbGwgYmUgaWdub3JlZCcpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZSA+IDAgPyB2YWx1ZSA6IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX2luaXQoKTtcbiAgfSxcblxuICAvKipcbiAgICogQ29udmVydCBhIGtleXdvcmQgb3IgYW4gYXJyYXkgb2Yga2V5d29yZC9kYXRlIHRvIGFuIGFycmF5IG9mIGRhdGUgb2JqZWN0c1xuICAgKlxuICAgKiBAcGFyYW0gIHtzdHJpbmd8YXJyYXl8RGF0ZX0gdmFsdWUgRGF0YSB0byBjb252ZXJ0XG4gICAqIEByZXR1cm4ge2FycmF5fSAgICAgICBBbiBhcnJheSBvZiBEYXRlc1xuICAgKi9cbiAgZXhwYW5kRGF0ZVNldHRpbmc6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIHZhbHVlID0gW3ZhbHVlXTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWVcbiAgICAgIC5tYXAoZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEgPT09ICdub3cnKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSlcbiAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGQgIT09IGZhbHNlO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEZpbGwgdGhlIGNhbGVuZGFyIGJ5IGNvbG9yaW5nIHRoZSBjZWxsc1xuICAgKlxuICAgKiBAcGFyYW0gYXJyYXkgc3ZnIEFuIGFycmF5IG9mIGh0bWwgbm9kZSB0byBhcHBseSB0aGUgdHJhbnNmb3JtYXRpb24gdG8gKG9wdGlvbmFsKVxuICAgKiAgICAgICAgICAgICAgICAgIEl0J3MgdXNlZCB0byBsaW1pdCB0aGUgcGFpbnRpbmcgdG8gb25seSBhIHN1YnNldCBvZiB0aGUgY2FsZW5kYXJcbiAgICogQHJldHVybiB2b2lkXG4gICAqL1xuICBmaWxsOiBmdW5jdGlvbiAoc3ZnKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgdmFyIG9wdGlvbnMgPSBwYXJlbnQub3B0aW9ucztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBzdmcgPSBwYXJlbnQucm9vdC5zZWxlY3RBbGwoJy5ncmFwaC1kb21haW4nKTtcbiAgICB9XG5cbiAgICB2YXIgcmVjdCA9IHN2Z1xuICAgICAgLnNlbGVjdEFsbCgnc3ZnJylcbiAgICAgIC5zZWxlY3RBbGwoJ2cnKVxuICAgICAgLmRhdGEoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHBhcmVudC5fZG9tYWlucy5nZXQoZCk7XG4gICAgICB9KTtcbiAgICAvKipcbiAgICAgKiBDb2xvcml6ZSB0aGUgY2VsbCB2aWEgYSBzdHlsZSBhdHRyaWJ1dGUgaWYgZW5hYmxlZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZFN0eWxlKGVsZW1lbnQpIHtcbiAgICAgIGlmIChwYXJlbnQubGVnZW5kU2NhbGUgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBlbGVtZW50LmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZC52ID09PSBudWxsICYmXG4gICAgICAgICAgb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVybycpICYmXG4gICAgICAgICAgIW9wdGlvbnMuY29uc2lkZXJNaXNzaW5nRGF0YUFzWmVyb1xuICAgICAgICApIHtcbiAgICAgICAgICBpZiAob3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2Jhc2UnKSkge1xuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMubGVnZW5kQ29sb3JzLmJhc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzICE9PSBudWxsICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2VtcHR5JykgJiZcbiAgICAgICAgICAoZC52ID09PSAwIHx8XG4gICAgICAgICAgICAoZC52ID09PSBudWxsICYmXG4gICAgICAgICAgICAgIG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2NvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8nKSAmJlxuICAgICAgICAgICAgICBvcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8pKVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gb3B0aW9ucy5sZWdlbmRDb2xvcnMuZW1wdHk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgZC52IDwgMCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kWzBdID4gMCAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzICE9PSBudWxsICYmXG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ292ZXJmbG93JylcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMubGVnZW5kQ29sb3JzLm92ZXJmbG93O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHBhcmVudC5sZWdlbmRTY2FsZShNYXRoLm1pbihkLnYsIG9wdGlvbnMubGVnZW5kW29wdGlvbnMubGVnZW5kLmxlbmd0aCAtIDFdKSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZWN0XG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5zZWxlY3QoJ3JlY3QnKVxuICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGh0bWxDbGFzcyA9IHBhcmVudC5nZXRIaWdobGlnaHRDbGFzc05hbWUoZC50KS50cmltKCkuc3BsaXQoJyAnKTtcbiAgICAgICAgdmFyIHBhc3REYXRlID0gcGFyZW50LmRhdGVJc0xlc3NUaGFuKGQudCwgbmV3IERhdGUoKSk7XG4gICAgICAgIHZhciBzYW1lRGF0ZSA9IHBhcmVudC5kYXRlSXNFcXVhbChkLnQsIG5ldyBEYXRlKCkpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBwYXJlbnQubGVnZW5kU2NhbGUgPT09IG51bGwgfHxcbiAgICAgICAgICAoZC52ID09PSBudWxsICYmXG4gICAgICAgICAgICBvcHRpb25zLmhhc093blByb3BlcnR5KCdjb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvJykgJiZcbiAgICAgICAgICAgICFvcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8gJiZcbiAgICAgICAgICAgICFvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnYmFzZScpKVxuICAgICAgICApIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaCgnZ3JhcGgtcmVjdCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNhbWVEYXRlKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2goJ25vdycpO1xuICAgICAgICB9IGVsc2UgaWYgKCFwYXN0RGF0ZSkge1xuICAgICAgICAgIGh0bWxDbGFzcy5wdXNoKCdmdXR1cmUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkLnYgIT09IG51bGwpIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaChwYXJlbnQuTGVnZW5kLmdldENsYXNzKGQudiwgcGFyZW50LmxlZ2VuZFNjYWxlID09PSBudWxsKSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jb25zaWRlck1pc3NpbmdEYXRhQXNaZXJvICYmIHBhc3REYXRlKSB7XG4gICAgICAgICAgaHRtbENsYXNzLnB1c2gocGFyZW50LkxlZ2VuZC5nZXRDbGFzcygwLCBwYXJlbnQubGVnZW5kU2NhbGUgPT09IG51bGwpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLm9uQ2xpY2sgIT09IG51bGwpIHtcbiAgICAgICAgICBodG1sQ2xhc3MucHVzaCgnaG92ZXJfY3Vyc29yJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaHRtbENsYXNzLmpvaW4oJyAnKTtcbiAgICAgIH0pXG4gICAgICAuY2FsbChhZGRTdHlsZSk7XG5cbiAgICByZWN0XG4gICAgICAudHJhbnNpdGlvbigpXG4gICAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5zZWxlY3QoJ3RpdGxlJylcbiAgICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHJldHVybiBwYXJlbnQuZ2V0U3ViRG9tYWluVGl0bGUoZCk7XG4gICAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGZvcm1hdFN1YkRvbWFpblRleHQoZWxlbWVudCkge1xuICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnN1YkRvbWFpblRleHRGb3JtYXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZWxlbWVudC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgcmV0dXJuIG9wdGlvbnMuc3ViRG9tYWluVGV4dEZvcm1hdChkLnQsIGQudik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoYW5nZSB0aGUgc3ViRG9tYWluVGV4dCBjbGFzcyBpZiBuZWNlc3NhcnlcbiAgICAgKiBBbHNvIGNoYW5nZSB0aGUgdGV4dCwgZS5nIHdoZW4gdGV4dCBpcyByZXByZXNlbnRpbmcgdGhlIHZhbHVlXG4gICAgICogaW5zdGVhZCBvZiB0aGUgZGF0ZVxuICAgICAqL1xuICAgIHJlY3RcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLnNlbGVjdCgndGV4dCcpXG4gICAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICByZXR1cm4gJ3N1YmRvbWFpbi10ZXh0JyArIHBhcmVudC5nZXRIaWdobGlnaHRDbGFzc05hbWUoZC50KTtcbiAgICAgIH0pXG4gICAgICAuY2FsbChmb3JtYXRTdWJEb21haW5UZXh0KTtcbiAgfSxcblxuICAvKipcbiAgICogU3ByaW50ZiBsaWtlIGZ1bmN0aW9uLlxuICAgKiBSZXBsYWNlcyBwbGFjZWhvbGRlcnMgezB9IGluIHN0cmluZyB3aXRoIHZhbHVlcyBmcm9tIHByb3ZpZGVkIG9iamVjdC5cbiAgICpcbiAgICogQHBhcmFtIHN0cmluZyBmb3JtYXR0ZWQgU3RyaW5nIGNvbnRhaW5pbmcgcGxhY2Vob2xkZXJzLlxuICAgKiBAcGFyYW0gb2JqZWN0IGFyZ3MgT2JqZWN0IHdpdGggcHJvcGVydGllcyB0byByZXBsYWNlIHBsYWNlaG9sZGVycyBpbiBzdHJpbmcuXG4gICAqXG4gICAqIEByZXR1cm4gU3RyaW5nXG4gICAqL1xuICBmb3JtYXRTdHJpbmdXaXRoT2JqZWN0OiBmdW5jdGlvbiAoZm9ybWF0dGVkLCBhcmdzKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIGZvciAodmFyIHByb3AgaW4gYXJncykge1xuICAgICAgaWYgKGFyZ3MuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcbiAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ1xcXFx7JyArIHByb3AgKyAnXFxcXH0nLCAnZ2knKTtcbiAgICAgICAgZm9ybWF0dGVkID0gZm9ybWF0dGVkLnJlcGxhY2UocmVnZXhwLCBhcmdzW3Byb3BdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZvcm1hdHRlZDtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gRVZFTlRTIENBTExCQUNLICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2QgZm9yIHRyaWdnZXJpbmcgZXZlbnQgY2FsbGJhY2tcbiAgICpcbiAgICogQHBhcmFtICBzdHJpbmcgIGV2ZW50TmFtZSAgICAgICBOYW1lIG9mIHRoZSBldmVudCB0byB0cmlnZ2VyXG4gICAqIEBwYXJhbSAgYXJyYXkgIHN1Y2Nlc3NBcmdzICAgICBMaXN0IG9mIGFyZ3VtZW50IHRvIHBhc3MgdG8gdGhlIGNhbGxiYWNrXG4gICAqIEBwYXJhbSAgYm9vbGVhbiAgc2tpcCAgICAgIFdoZXRoZXIgdG8gc2tpcCB0aGUgZXZlbnQgdHJpZ2dlcmluZ1xuICAgKiBAcmV0dXJuIG1peGVkICBUcnVlIHdoZW4gdGhlIHRyaWdnZXJpbmcgd2FzIHNraXBwZWQsIGZhbHNlIG9uIGVycm9yLCBlbHNlIHRoZSBjYWxsYmFjayBmdW5jdGlvblxuICAgKi9cbiAgdHJpZ2dlckV2ZW50OiBmdW5jdGlvbiAoZXZlbnROYW1lLCBzdWNjZXNzQXJncywgc2tpcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICgoYXJndW1lbnRzLmxlbmd0aCA9PT0gMyAmJiBza2lwKSB8fCB0aGlzLm9wdGlvbnNbZXZlbnROYW1lXSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnNbZXZlbnROYW1lXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgaWYgKHR5cGVvZiBzdWNjZXNzQXJncyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBzdWNjZXNzQXJncyA9IHN1Y2Nlc3NBcmdzKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zW2V2ZW50TmFtZV0uYXBwbHkodGhpcywgc3VjY2Vzc0FyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnUHJvdmlkZWQgY2FsbGJhY2sgZm9yICcgKyBldmVudE5hbWUgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uLicpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIG9uIGEgbW91c2UgY2xpY2sgb24gYSBzdWJEb21haW4gY2VsbFxuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgICAgZCAgICBEYXRlIG9mIHRoZSBzdWJkb21haW4gYmxvY2tcbiAgICogQHBhcmFtICBpbnQgICAgaXRlbU5iICBOdW1iZXIgb2YgaXRlbXMgaW4gdGhhdCBkYXRlXG4gICAqL1xuICBvbkNsaWNrOiBmdW5jdGlvbiAoZCwgaXRlbU5iKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdvbkNsaWNrJywgW2QsIGl0ZW1OYl0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgZHJhd2luZyB0aGUgY2FsZW5kYXIsIGJ5dCBiZWZvcmUgZmlsbGluZyBpdCB3aXRoIGRhdGFcbiAgICovXG4gIGFmdGVyTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnYWZ0ZXJMb2FkJyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEV2ZW50IHRyaWdnZXJlZCBhZnRlciBjb21wbGV0aW5nIGRyYXdpbmcgYW5kIGZpbGxpbmcgdGhlIGNhbGVuZGFyXG4gICAqL1xuICBvbkNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHJlc3BvbnNlID0gdGhpcy50cmlnZ2VyRXZlbnQoJ29uQ29tcGxldGUnLCBbXSwgdGhpcy5fY29tcGxldGVkKTtcbiAgICB0aGlzLl9jb21wbGV0ZWQgPSB0cnVlO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIHNoaWZ0aW5nIHRoZSBjYWxlbmRhciBvbmUgZG9tYWluIGJhY2tcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICAgIHN0YXJ0ICBEb21haW4gc3RhcnQgZGF0ZVxuICAgKiBAcGFyYW0gIERhdGUgICAgZW5kICAgIERvbWFpbiBlbmQgZGF0ZVxuICAgKi9cbiAgYWZ0ZXJMb2FkUHJldmlvdXNEb21haW46IGZ1bmN0aW9uIChzdGFydCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnYWZ0ZXJMb2FkUHJldmlvdXNEb21haW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3ViRG9tYWluID0gcGFyZW50LmdldFN1YkRvbWFpbihzdGFydCk7XG4gICAgICByZXR1cm4gW3N1YkRvbWFpbi5zaGlmdCgpLCBzdWJEb21haW4ucG9wKCldO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBFdmVudCB0cmlnZ2VyZWQgYWZ0ZXIgc2hpZnRpbmcgdGhlIGNhbGVuZGFyIG9uZSBkb21haW4gYWJvdmVcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICAgIHN0YXJ0ICBEb21haW4gc3RhcnQgZGF0ZVxuICAgKiBAcGFyYW0gIERhdGUgICAgZW5kICAgIERvbWFpbiBlbmQgZGF0ZVxuICAgKi9cbiAgYWZ0ZXJMb2FkTmV4dERvbWFpbjogZnVuY3Rpb24gKHN0YXJ0KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdhZnRlckxvYWROZXh0RG9tYWluJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN1YkRvbWFpbiA9IHBhcmVudC5nZXRTdWJEb21haW4oc3RhcnQpO1xuICAgICAgcmV0dXJuIFtzdWJEb21haW4uc2hpZnQoKSwgc3ViRG9tYWluLnBvcCgpXTtcbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIGxvYWRpbmcgdGhlIGxlZnRtb3N0IGRvbWFpbiBhbGxvd2VkIGJ5IG1pbkRhdGVcbiAgICpcbiAgICogQHBhcmFtICBib29sZWFuICByZWFjaGVkIFRydWUgaWYgdGhlIGxlZnRtb3N0IGRvbWFpbiB3YXMgcmVhY2hlZFxuICAgKi9cbiAgb25NaW5Eb21haW5SZWFjaGVkOiBmdW5jdGlvbiAocmVhY2hlZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHRoaXMuX21pbkRvbWFpblJlYWNoZWQgPSByZWFjaGVkO1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnb25NaW5Eb21haW5SZWFjaGVkJywgW3JlYWNoZWRdKTtcbiAgfSxcblxuICAvKipcbiAgICogRXZlbnQgdHJpZ2dlcmVkIGFmdGVyIGxvYWRpbmcgdGhlIHJpZ2h0bW9zdCBkb21haW4gYWxsb3dlZCBieSBtYXhEYXRlXG4gICAqXG4gICAqIEBwYXJhbSAgYm9vbGVhbiAgcmVhY2hlZCBUcnVlIGlmIHRoZSByaWdodG1vc3QgZG9tYWluIHdhcyByZWFjaGVkXG4gICAqL1xuICBvbk1heERvbWFpblJlYWNoZWQ6IGZ1bmN0aW9uIChyZWFjaGVkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdGhpcy5fbWF4RG9tYWluUmVhY2hlZCA9IHJlYWNoZWQ7XG4gICAgcmV0dXJuIHRoaXMudHJpZ2dlckV2ZW50KCdvbk1heERvbWFpblJlYWNoZWQnLCBbcmVhY2hlZF0pO1xuICB9LFxuXG4gIGNoZWNrSWZNaW5Eb21haW5Jc1JlYWNoZWQ6IGZ1bmN0aW9uIChkYXRlLCB1cHBlckJvdW5kKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMubWluRG9tYWluSXNSZWFjaGVkKGRhdGUpKSB7XG4gICAgICB0aGlzLm9uTWluRG9tYWluUmVhY2hlZCh0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgICAgaWYgKHRoaXMuX21heERvbWFpblJlYWNoZWQgJiYgIXRoaXMubWF4RG9tYWluSXNSZWFjaGVkKHVwcGVyQm91bmQpKSB7XG4gICAgICAgIHRoaXMub25NYXhEb21haW5SZWFjaGVkKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgY2hlY2tJZk1heERvbWFpbklzUmVhY2hlZDogZnVuY3Rpb24gKGRhdGUsIGxvd2VyQm91bmQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5tYXhEb21haW5Jc1JlYWNoZWQoZGF0ZSkpIHtcbiAgICAgIHRoaXMub25NYXhEb21haW5SZWFjaGVkKHRydWUpO1xuICAgIH1cblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICBpZiAodGhpcy5fbWluRG9tYWluUmVhY2hlZCAmJiAhdGhpcy5taW5Eb21haW5Jc1JlYWNoZWQobG93ZXJCb3VuZCkpIHtcbiAgICAgICAgdGhpcy5vbk1pbkRvbWFpblJlYWNoZWQoZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBhZnRlclVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLnRyaWdnZXJFdmVudCgnYWZ0ZXJVcGRhdGUnKTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gRk9STUFUVEVSICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICBmb3JtYXROdW1iZXI6IGQzLmZvcm1hdCgnLGcnKSxcblxuICBmb3JtYXREYXRlOiBmdW5jdGlvbiAoZCwgZm9ybWF0KSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7XG4gICAgICBmb3JtYXQgPSAndGl0bGUnO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZm9ybWF0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gZm9ybWF0KGQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZiA9IGQzLnRpbWUuZm9ybWF0KGZvcm1hdCk7XG4gICAgICByZXR1cm4gZihkKTtcbiAgICB9XG4gIH0sXG5cbiAgZ2V0U3ViRG9tYWluVGl0bGU6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKGQudiA9PT0gbnVsbCAmJiAhdGhpcy5vcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8pIHtcbiAgICAgIHJldHVybiB0aGlzLmZvcm1hdFN0cmluZ1dpdGhPYmplY3QodGhpcy5vcHRpb25zLnN1YkRvbWFpblRpdGxlRm9ybWF0LmVtcHR5LCB7XG4gICAgICAgIGRhdGU6IHRoaXMuZm9ybWF0RGF0ZShuZXcgRGF0ZShkLnQpLCB0aGlzLm9wdGlvbnMuc3ViRG9tYWluRGF0ZUZvcm1hdCksXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHZhbHVlID0gZC52O1xuICAgICAgLy8gQ29uc2lkZXIgbnVsbCBhcyAwXG4gICAgICBpZiAodmFsdWUgPT09IG51bGwgJiYgdGhpcy5vcHRpb25zLmNvbnNpZGVyTWlzc2luZ0RhdGFBc1plcm8pIHtcbiAgICAgICAgdmFsdWUgPSAwO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5mb3JtYXRTdHJpbmdXaXRoT2JqZWN0KHRoaXMub3B0aW9ucy5zdWJEb21haW5UaXRsZUZvcm1hdC5maWxsZWQsIHtcbiAgICAgICAgY291bnQ6IHRoaXMuZm9ybWF0TnVtYmVyKHZhbHVlKSxcbiAgICAgICAgbmFtZTogdGhpcy5vcHRpb25zLml0ZW1OYW1lW3ZhbHVlICE9PSAxID8gMSA6IDBdLFxuICAgICAgICBjb25uZWN0b3I6IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0uZm9ybWF0LmNvbm5lY3RvcixcbiAgICAgICAgZGF0ZTogdGhpcy5mb3JtYXREYXRlKG5ldyBEYXRlKGQudCksIHRoaXMub3B0aW9ucy5zdWJEb21haW5EYXRlRm9ybWF0KSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gRE9NQUlOIE5BVklHQVRJT04gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgLyoqXG4gICAqIFNoaWZ0IHRoZSBjYWxlbmRhciBvbmUgZG9tYWluIGZvcndhcmRcbiAgICpcbiAgICogVGhlIG5ldyBkb21haW4gaXMgbG9hZGVkIG9ubHkgaWYgaXQncyBub3QgYmV5b25kIG1heERhdGVcbiAgICpcbiAgICogQHBhcmFtIGludCBuIE51bWJlciBvZiBkb21haW5zIHRvIGxvYWRcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIG5leHQgZG9tYWluIHdhcyBsb2FkZWQsIGVsc2UgZmFsc2VcbiAgICovXG4gIGxvYWROZXh0RG9tYWluOiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLl9tYXhEb21haW5SZWFjaGVkIHx8IG4gPT09IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgYm91bmQgPSB0aGlzLmxvYWROZXdEb21haW5zKHRoaXMuTkFWSUdBVEVfUklHSFQsIHRoaXMuZ2V0RG9tYWluKHRoaXMuZ2V0TmV4dERvbWFpbigpLCBuKSk7XG5cbiAgICB0aGlzLmFmdGVyTG9hZE5leHREb21haW4oYm91bmQuZW5kKTtcbiAgICB0aGlzLmNoZWNrSWZNYXhEb21haW5Jc1JlYWNoZWQodGhpcy5nZXROZXh0RG9tYWluKCkuZ2V0VGltZSgpLCBib3VuZC5zdGFydCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxuICAvKipcbiAgICogU2hpZnQgdGhlIGNhbGVuZGFyIG9uZSBkb21haW4gYmFja3dhcmRcbiAgICpcbiAgICogVGhlIHByZXZpb3VzIGRvbWFpbiBpcyBsb2FkZWQgb25seSBpZiBpdCdzIG5vdCBiZXlvbmQgdGhlIG1pbkRhdGVcbiAgICpcbiAgICogQHBhcmFtIGludCBuIE51bWJlciBvZiBkb21haW5zIHRvIGxvYWRcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIHByZXZpb3VzIGRvbWFpbiB3YXMgbG9hZGVkLCBlbHNlIGZhbHNlXG4gICAqL1xuICBsb2FkUHJldmlvdXNEb21haW46IGZ1bmN0aW9uIChuKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMuX21pbkRvbWFpblJlYWNoZWQgfHwgbiA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHZhciBib3VuZCA9IHRoaXMubG9hZE5ld0RvbWFpbnMoXG4gICAgICB0aGlzLk5BVklHQVRFX0xFRlQsXG4gICAgICB0aGlzLmdldERvbWFpbih0aGlzLmdldERvbWFpbktleXMoKVswXSwgLW4pLnJldmVyc2UoKSxcbiAgICApO1xuXG4gICAgdGhpcy5hZnRlckxvYWRQcmV2aW91c0RvbWFpbihib3VuZC5zdGFydCk7XG4gICAgdGhpcy5jaGVja0lmTWluRG9tYWluSXNSZWFjaGVkKGJvdW5kLnN0YXJ0LCBib3VuZC5lbmQpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH0sXG5cbiAgbG9hZE5ld0RvbWFpbnM6IGZ1bmN0aW9uIChkaXJlY3Rpb24sIG5ld0RvbWFpbnMpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgcGFyZW50ID0gdGhpcztcbiAgICB2YXIgYmFja3dhcmQgPSBkaXJlY3Rpb24gPT09IHRoaXMuTkFWSUdBVEVfTEVGVDtcbiAgICB2YXIgaSA9IC0xO1xuICAgIHZhciB0b3RhbCA9IG5ld0RvbWFpbnMubGVuZ3RoO1xuICAgIHZhciBkb21haW5zID0gdGhpcy5nZXREb21haW5LZXlzKCk7XG5cbiAgICBmdW5jdGlvbiBidWlsZFN1YkRvbWFpbihkKSB7XG4gICAgICByZXR1cm4geyB0OiBwYXJlbnQuX2RvbWFpblR5cGVbcGFyZW50Lm9wdGlvbnMuc3ViRG9tYWluXS5leHRyYWN0VW5pdChkKSwgdjogbnVsbCB9O1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBvdXQgb2YgYm91bmQgZG9tYWlucyBmcm9tIGxpc3Qgb2YgbmV3IGRvbWFpbnMgdG8gcHJlcGVuZFxuICAgIHdoaWxlICgrK2kgPCB0b3RhbCkge1xuICAgICAgaWYgKGJhY2t3YXJkICYmIHRoaXMubWluRG9tYWluSXNSZWFjaGVkKG5ld0RvbWFpbnNbaV0pKSB7XG4gICAgICAgIG5ld0RvbWFpbnMgPSBuZXdEb21haW5zLnNsaWNlKDAsIGkgKyAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoIWJhY2t3YXJkICYmIHRoaXMubWF4RG9tYWluSXNSZWFjaGVkKG5ld0RvbWFpbnNbaV0pKSB7XG4gICAgICAgIG5ld0RvbWFpbnMgPSBuZXdEb21haW5zLnNsaWNlKDAsIGkpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBuZXdEb21haW5zID0gbmV3RG9tYWlucy5zbGljZSgtdGhpcy5vcHRpb25zLnJhbmdlKTtcblxuICAgIGZvciAoaSA9IDAsIHRvdGFsID0gbmV3RG9tYWlucy5sZW5ndGg7IGkgPCB0b3RhbDsgaSsrKSB7XG4gICAgICB0aGlzLl9kb21haW5zLnNldChcbiAgICAgICAgbmV3RG9tYWluc1tpXS5nZXRUaW1lKCksXG4gICAgICAgIHRoaXMuZ2V0U3ViRG9tYWluKG5ld0RvbWFpbnNbaV0pLm1hcChidWlsZFN1YkRvbWFpbiksXG4gICAgICApO1xuXG4gICAgICB0aGlzLl9kb21haW5zLnJlbW92ZShiYWNrd2FyZCA/IGRvbWFpbnMucG9wKCkgOiBkb21haW5zLnNoaWZ0KCkpO1xuICAgIH1cblxuICAgIGRvbWFpbnMgPSB0aGlzLmdldERvbWFpbktleXMoKTtcblxuICAgIGlmIChiYWNrd2FyZCkge1xuICAgICAgbmV3RG9tYWlucyA9IG5ld0RvbWFpbnMucmV2ZXJzZSgpO1xuICAgIH1cblxuICAgIHRoaXMucGFpbnQoZGlyZWN0aW9uKTtcblxuICAgIHRoaXMuZ2V0RGF0YXMoXG4gICAgICB0aGlzLm9wdGlvbnMuZGF0YSxcbiAgICAgIG5ld0RvbWFpbnNbMF0sXG4gICAgICB0aGlzLmdldFN1YkRvbWFpbihuZXdEb21haW5zW25ld0RvbWFpbnMubGVuZ3RoIC0gMV0pLnBvcCgpLFxuICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICBwYXJlbnQuZmlsbChwYXJlbnQubGFzdEluc2VydGVkU3ZnKTtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGFydDogbmV3RG9tYWluc1tiYWNrd2FyZCA/IDAgOiAxXSxcbiAgICAgIGVuZDogZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdLFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB3aGV0aGVyIGEgZGF0ZSBpcyBpbnNpZGUgdGhlIHNjb3BlIGRldGVybWluZWQgYnkgbWF4RGF0ZVxuICAgKlxuICAgKiBAcGFyYW0gaW50IGRhdGV0aW1lc3RhbXAgVGhlIHRpbWVzdGFtcCBpbiBtcyB0byB0ZXN0XG4gICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBzcGVjaWZpZWQgZGF0ZSBjb3JyZXNwb25kIHRvIHRoZSBjYWxlbmRhciB1cHBlciBib3VuZFxuICAgKi9cbiAgbWF4RG9tYWluSXNSZWFjaGVkOiBmdW5jdGlvbiAoZGF0ZXRpbWVzdGFtcCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMubWF4RGF0ZSAhPT0gbnVsbCAmJiB0aGlzLm9wdGlvbnMubWF4RGF0ZS5nZXRUaW1lKCkgPCBkYXRldGltZXN0YW1wO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gd2hldGhlciBhIGRhdGUgaXMgaW5zaWRlIHRoZSBzY29wZSBkZXRlcm1pbmVkIGJ5IG1pbkRhdGVcbiAgICpcbiAgICogQHBhcmFtIGludCBkYXRldGltZXN0YW1wIFRoZSB0aW1lc3RhbXAgaW4gbXMgdG8gdGVzdFxuICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgc3BlY2lmaWVkIGRhdGUgY29ycmVzcG9uZCB0byB0aGUgY2FsZW5kYXIgbG93ZXIgYm91bmRcbiAgICovXG4gIG1pbkRvbWFpbklzUmVhY2hlZDogZnVuY3Rpb24gKGRhdGV0aW1lc3RhbXApIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1pbkRhdGUgIT09IG51bGwgJiYgdGhpcy5vcHRpb25zLm1pbkRhdGUuZ2V0VGltZSgpID49IGRhdGV0aW1lc3RhbXA7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgbGlzdCBvZiB0aGUgY2FsZW5kYXIncyBkb21haW4gdGltZXN0YW1wXG4gICAqXG4gICAqIEByZXR1cm4gQXJyYXkgYSBzb3J0ZWQgYXJyYXkgb2YgdGltZXN0YW1wXG4gICAqL1xuICBnZXREb21haW5LZXlzOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbnNcbiAgICAgIC5rZXlzKClcbiAgICAgIC5tYXAoZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGQsIDEwKTtcbiAgICAgIH0pXG4gICAgICAuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICByZXR1cm4gYSAtIGI7XG4gICAgICB9KTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gUE9TSVRJT05OSU5HICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICBwb3NpdGlvblN1YkRvbWFpblg6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGluZGV4ID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5wb3NpdGlvbi54KG5ldyBEYXRlKGQpKTtcbiAgICByZXR1cm4gaW5kZXggKiB0aGlzLm9wdGlvbnMuY2VsbFNpemUgKyBpbmRleCAqIHRoaXMub3B0aW9ucy5jZWxsUGFkZGluZztcbiAgfSxcblxuICBwb3NpdGlvblN1YkRvbWFpblk6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGluZGV4ID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5wb3NpdGlvbi55KG5ldyBEYXRlKGQpKTtcbiAgICByZXR1cm4gaW5kZXggKiB0aGlzLm9wdGlvbnMuY2VsbFNpemUgKyBpbmRleCAqIHRoaXMub3B0aW9ucy5jZWxsUGFkZGluZztcbiAgfSxcblxuICBnZXRTdWJEb21haW5Db2x1bW5OdW1iZXI6IGZ1bmN0aW9uIChkKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5yb3dMaW1pdCA+IDApIHtcbiAgICAgIHZhciBpID0gdGhpcy5fZG9tYWluVHlwZVt0aGlzLm9wdGlvbnMuc3ViRG9tYWluXS5tYXhJdGVtTnVtYmVyO1xuICAgICAgaWYgKHR5cGVvZiBpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGkgPSBpKGQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE1hdGguY2VpbChpIC8gdGhpcy5vcHRpb25zLnJvd0xpbWl0KTtcbiAgICB9XG5cbiAgICB2YXIgaiA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0uZGVmYXVsdENvbHVtbk51bWJlcjtcbiAgICBpZiAodHlwZW9mIGogPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGogPSBqKGQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmNvbExpbWl0IHx8IGo7XG4gIH0sXG5cbiAgZ2V0U3ViRG9tYWluUm93TnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuY29sTGltaXQgPiAwKSB7XG4gICAgICB2YXIgaSA9IHRoaXMuX2RvbWFpblR5cGVbdGhpcy5vcHRpb25zLnN1YkRvbWFpbl0ubWF4SXRlbU51bWJlcjtcbiAgICAgIGlmICh0eXBlb2YgaSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBpID0gaShkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBNYXRoLmNlaWwoaSAvIHRoaXMub3B0aW9ucy5jb2xMaW1pdCk7XG4gICAgfVxuXG4gICAgdmFyIGogPSB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLmRlZmF1bHRSb3dOdW1iZXI7XG4gICAgaWYgKHR5cGVvZiBqID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBqID0gaihkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yb3dMaW1pdCB8fCBqO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYSBjbGFzc25hbWUgaWYgdGhlIHNwZWNpZmllZCBkYXRlIHNob3VsZCBiZSBoaWdobGlnaHRlZFxuICAgKlxuICAgKiBAcGFyYW0gIHRpbWVzdGFtcCBkYXRlIERhdGUgb2YgdGhlIGN1cnJlbnQgc3ViRG9tYWluXG4gICAqIEByZXR1cm4gU3RyaW5nIHRoZSBoaWdobGlnaHQgY2xhc3NcbiAgICovXG4gIGdldEhpZ2hsaWdodENsYXNzTmFtZTogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBkID0gbmV3IERhdGUoZCk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLmhpZ2hsaWdodC5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKHZhciBpIGluIHRoaXMub3B0aW9ucy5oaWdobGlnaHQpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0ZUlzRXF1YWwodGhpcy5vcHRpb25zLmhpZ2hsaWdodFtpXSwgZCkpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pc05vdyh0aGlzLm9wdGlvbnMuaGlnaGxpZ2h0W2ldKSA/ICcgaGlnaGxpZ2h0LW5vdycgOiAnIGhpZ2hsaWdodCc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gd2hldGhlciB0aGUgc3BlY2lmaWVkIGRhdGUgaXMgbm93LFxuICAgKiBhY2NvcmRpbmcgdG8gdGhlIHR5cGUgb2Ygc3ViZG9tYWluXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSBkIFRoZSBkYXRlIHRvIGNvbXBhcmVcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGRhdGUgY29ycmVzcG9uZCB0byBhIHN1YmRvbWFpbiBjZWxsXG4gICAqL1xuICBpc05vdzogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy5kYXRlSXNFcXVhbChkLCBuZXcgRGF0ZSgpKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHdoZXRoZXIgMiBkYXRlcyBhcmUgZXF1YWxzXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgc3ViZG9tYWluLWF3YXJlLFxuICAgKiBhbmQgZGF0ZXMgY29tcGFyaXNvbiBhcmUgZGVwZW5kZW50IG9mIHRoZSBzdWJkb21haW5cbiAgICpcbiAgICogQHBhcmFtICBEYXRlIGRhdGVBIEZpcnN0IGRhdGUgdG8gY29tcGFyZVxuICAgKiBAcGFyYW0gIERhdGUgZGF0ZUIgU2Vjb24gZGF0ZSB0byBjb21wYXJlXG4gICAqIEByZXR1cm4gYm9vbCB0cnVlIGlmIHRoZSAyIGRhdGVzIGFyZSBlcXVhbHNcbiAgICovXG4gIC8qIGpzaGludCBtYXhjb21wbGV4aXR5OiBmYWxzZSAqL1xuICBkYXRlSXNFcXVhbDogZnVuY3Rpb24gKGRhdGVBLCBkYXRlQikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICghKGRhdGVBIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgIGRhdGVBID0gbmV3IERhdGUoZGF0ZUEpO1xuICAgIH1cblxuICAgIGlmICghKGRhdGVCIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgIGRhdGVCID0gbmV3IERhdGUoZGF0ZUIpO1xuICAgIH1cblxuICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnN1YkRvbWFpbikge1xuICAgICAgY2FzZSAneF9taW4nOlxuICAgICAgY2FzZSAnbWluJzpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBkYXRlQS5nZXRGdWxsWWVhcigpID09PSBkYXRlQi5nZXRGdWxsWWVhcigpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0TW9udGgoKSA9PT0gZGF0ZUIuZ2V0TW9udGgoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldERhdGUoKSA9PT0gZGF0ZUIuZ2V0RGF0ZSgpICYmXG4gICAgICAgICAgZGF0ZUEuZ2V0SG91cnMoKSA9PT0gZGF0ZUIuZ2V0SG91cnMoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldE1pbnV0ZXMoKSA9PT0gZGF0ZUIuZ2V0TWludXRlcygpXG4gICAgICAgICk7XG4gICAgICBjYXNlICd4X2hvdXInOlxuICAgICAgY2FzZSAnaG91cic6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZGF0ZUEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZUIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldE1vbnRoKCkgPT09IGRhdGVCLmdldE1vbnRoKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXREYXRlKCkgPT09IGRhdGVCLmdldERhdGUoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldEhvdXJzKCkgPT09IGRhdGVCLmdldEhvdXJzKClcbiAgICAgICAgKTtcbiAgICAgIGNhc2UgJ3hfZGF5JzpcbiAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZGF0ZUEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZUIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICAgIGRhdGVBLmdldE1vbnRoKCkgPT09IGRhdGVCLmdldE1vbnRoKCkgJiZcbiAgICAgICAgICBkYXRlQS5nZXREYXRlKCkgPT09IGRhdGVCLmdldERhdGUoKVxuICAgICAgICApO1xuICAgICAgY2FzZSAneF93ZWVrJzpcbiAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGRhdGVBLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVCLmdldEZ1bGxZZWFyKCkgJiZcbiAgICAgICAgICB0aGlzLmdldFdlZWtOdW1iZXIoZGF0ZUEpID09PSB0aGlzLmdldFdlZWtOdW1iZXIoZGF0ZUIpXG4gICAgICAgICk7XG4gICAgICBjYXNlICd4X21vbnRoJzpcbiAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgcmV0dXJuIGRhdGVBLmdldEZ1bGxZZWFyKCkgPT09IGRhdGVCLmdldEZ1bGxZZWFyKCkgJiYgZGF0ZUEuZ2V0TW9udGgoKSA9PT0gZGF0ZUIuZ2V0TW9udGgoKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgd2V0aGVyIG9yIG5vdCBkYXRlQSBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gZGF0ZUIuIFRoaXMgZnVuY3Rpb24gaXMgc3ViZG9tYWluIGF3YXJlLlxuICAgKiBQZXJmb3JtcyBhdXRvbWF0aWMgY29udmVyc2lvbiBvZiB2YWx1ZXMuXG4gICAqIEBwYXJhbSBkYXRlQSBtYXkgYmUgYSBudW1iZXIgb3IgYSBEYXRlXG4gICAqIEBwYXJhbSBkYXRlQiBtYXkgYmUgYSBudW1iZXIgb3IgYSBEYXRlXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgZGF0ZUlzTGVzc1RoYW46IGZ1bmN0aW9uIChkYXRlQSwgZGF0ZUIpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoIShkYXRlQSBpbnN0YW5jZW9mIERhdGUpKSB7XG4gICAgICBkYXRlQSA9IG5ldyBEYXRlKGRhdGVBKTtcbiAgICB9XG5cbiAgICBpZiAoIShkYXRlQiBpbnN0YW5jZW9mIERhdGUpKSB7XG4gICAgICBkYXRlQiA9IG5ldyBEYXRlKGRhdGVCKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBub3JtYWxpemVkTWlsbGlzKGRhdGUsIHN1YmRvbWFpbikge1xuICAgICAgc3dpdGNoIChzdWJkb21haW4pIHtcbiAgICAgICAgY2FzZSAneF9taW4nOlxuICAgICAgICBjYXNlICdtaW4nOlxuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShcbiAgICAgICAgICAgIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0TW9udGgoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgZGF0ZS5nZXRIb3VycygpLFxuICAgICAgICAgICAgZGF0ZS5nZXRNaW51dGVzKCksXG4gICAgICAgICAgKS5nZXRUaW1lKCk7XG4gICAgICAgIGNhc2UgJ3hfaG91cic6XG4gICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShcbiAgICAgICAgICAgIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0TW9udGgoKSxcbiAgICAgICAgICAgIGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICAgICAgZGF0ZS5nZXRIb3VycygpLFxuICAgICAgICAgICkuZ2V0VGltZSgpO1xuICAgICAgICBjYXNlICd4X2RheSc6XG4gICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpLCBkYXRlLmdldERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgICBjYXNlICd4X3dlZWsnOlxuICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgY2FzZSAneF9tb250aCc6XG4gICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkpLmdldFRpbWUoKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gZGF0ZS5nZXRUaW1lKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIG5vcm1hbGl6ZWRNaWxsaXMoZGF0ZUEsIHRoaXMub3B0aW9ucy5zdWJEb21haW4pIDxcbiAgICAgIG5vcm1hbGl6ZWRNaWxsaXMoZGF0ZUIsIHRoaXMub3B0aW9ucy5zdWJEb21haW4pXG4gICAgKTtcbiAgfSxcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgLy8gREFURSBDT01QVVRBVElPTiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGRheSBvZiB0aGUgeWVhciBmb3IgdGhlIGRhdGVcbiAgICogQHBhcmFtICBEYXRlXG4gICAqIEByZXR1cm4gIGludCBEYXkgb2YgdGhlIHllYXIgWzEsMzY2XVxuICAgKi9cbiAgZ2V0RGF5T2ZZZWFyOiBkMy50aW1lLmZvcm1hdCgnJWonKSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSB3ZWVrIG51bWJlciBvZiB0aGUgeWVhclxuICAgKiBNb25kYXkgYXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2Vla1xuICAgKiBAcmV0dXJuIGludCAgV2VlayBudW1iZXIgWzAtNTNdXG4gICAqL1xuICBnZXRXZWVrTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBmID0gdGhpcy5vcHRpb25zLndlZWtTdGFydE9uTW9uZGF5ID09PSB0cnVlID8gZDMudGltZS5mb3JtYXQoJyVXJykgOiBkMy50aW1lLmZvcm1hdCgnJVUnKTtcbiAgICByZXR1cm4gZihkKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSB3ZWVrIG51bWJlciwgcmVsYXRpdmUgdG8gaXRzIG1vbnRoXG4gICAqXG4gICAqIEBwYXJhbSAgaW50fERhdGUgZCBEYXRlIG9yIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgICogQHJldHVybiBpbnQgV2VlayBudW1iZXIsIHJlbGF0aXZlIHRvIHRoZSBtb250aCBbMC01XVxuICAgKi9cbiAgZ2V0TW9udGhXZWVrTnVtYmVyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICB9XG5cbiAgICB2YXIgbW9udGhGaXJzdFdlZWtOdW1iZXIgPSB0aGlzLmdldFdlZWtOdW1iZXIobmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCkpKTtcbiAgICByZXR1cm4gdGhpcy5nZXRXZWVrTnVtYmVyKGQpIC0gbW9udGhGaXJzdFdlZWtOdW1iZXIgLSAxO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIG51bWJlciBvZiB3ZWVrcyBpbiB0aGUgZGF0ZXMnIHllYXJcbiAgICpcbiAgICogQHBhcmFtICBpbnR8RGF0ZSBkIERhdGUgb3IgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcmV0dXJuIGludCBOdW1iZXIgb2Ygd2Vla3MgaW4gdGhlIGRhdGUncyB5ZWFyXG4gICAqL1xuICBnZXRXZWVrTnVtYmVySW5ZZWFyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiB0aGUgbnVtYmVyIG9mIGRheXMgaW4gdGhlIGRhdGUncyBtb250aFxuICAgKlxuICAgKiBAcGFyYW0gIGludHxEYXRlIGQgRGF0ZSBvciB0aW1lc3RhbXAgaW4gbWlsbGlzZWNvbmRzXG4gICAqIEByZXR1cm4gaW50IE51bWJlciBvZiBkYXlzIGluIHRoZSBkYXRlJ3MgbW9udGhcbiAgICovXG4gIGdldERheUNvdW50SW5Nb250aDogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICByZXR1cm4gdGhpcy5nZXRFbmRPZk1vbnRoKGQpLmdldERhdGUoKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgZGF0ZSdzIHllYXJcbiAgICpcbiAgICogQHBhcmFtICBpbnR8RGF0ZSBkIERhdGUgb3IgdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcmV0dXJuIGludCBOdW1iZXIgb2YgZGF5cyBpbiB0aGUgZGF0ZSdzIHllYXJcbiAgICovXG4gIGdldERheUNvdW50SW5ZZWFyOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgMSwgMjkpLmdldE1vbnRoKCkgPT09IDEgPyAzNjYgOiAzNjU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgd2Vla2RheSBmcm9tIGEgZGF0ZVxuICAgKlxuICAgKiBSZXR1cm4gdGhlIHdlZWsgZGF5IG51bWJlciAoMC02KSBvZiBhIGRhdGUsXG4gICAqIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3ZWVrIHN0YXJ0IG9uIG1vbmRheSBvciBzdW5kYXlcbiAgICpcbiAgICogQHBhcmFtICBEYXRlIGRcbiAgICogQHJldHVybiBpbnQgVGhlIHdlZWsgZGF5IG51bWJlciAoMC02KVxuICAgKi9cbiAgZ2V0V2Vla0RheTogZnVuY3Rpb24gKGQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zLndlZWtTdGFydE9uTW9uZGF5ID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGQuZ2V0RGF5KCk7XG4gICAgfVxuICAgIHJldHVybiBkLmdldERheSgpID09PSAwID8gNiA6IGQuZ2V0RGF5KCkgLSAxO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGxhc3QgZGF5IG9mIHRoZSBtb250aFxuICAgKiBAcGFyYW0gIERhdGV8aW50ICBkICBEYXRlIG9yIHRpbWVzdGFtcCBpbiBtaWxsaXNlY29uZHNcbiAgICogQHJldHVybiBEYXRlICAgICAgTGFzdCBkYXkgb2YgdGhlIG1vbnRoXG4gICAqL1xuICBnZXRFbmRPZk1vbnRoOiBmdW5jdGlvbiAoZCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh0eXBlb2YgZCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGQgPSBuZXcgRGF0ZShkKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpICsgMSwgMCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSBkYXRlXG4gICAqIEBwYXJhbSAgaW50IGNvdW50XG4gICAqIEBwYXJhbSAgc3RyaW5nIHN0ZXBcbiAgICogQHJldHVybiBEYXRlXG4gICAqL1xuICBqdW1wRGF0ZTogZnVuY3Rpb24gKGRhdGUsIGNvdW50LCBzdGVwKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGQgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICBzd2l0Y2ggKHN0ZXApIHtcbiAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICBkLnNldEhvdXJzKGQuZ2V0SG91cnMoKSArIGNvdW50KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdkYXknOlxuICAgICAgICBkLnNldEhvdXJzKGQuZ2V0SG91cnMoKSArIGNvdW50ICogMjQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICBkLnNldEhvdXJzKGQuZ2V0SG91cnMoKSArIGNvdW50ICogMjQgKiA3KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdtb250aCc6XG4gICAgICAgIGQuc2V0TW9udGgoZC5nZXRNb250aCgpICsgY291bnQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICBkLnNldEZ1bGxZZWFyKGQuZ2V0RnVsbFllYXIoKSArIGNvdW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IERhdGUoZCk7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIERPTUFJTiBDT01QVVRBVElPTiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgbWludXRlcyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICBkICBkYXRlICBBIGRhdGVcbiAgICogQHBhcmFtICBpbnR8ZGF0ZSAgcmFuZ2UgIE51bWJlciBvZiBtaW51dGVzIGluIHRoZSByYW5nZSwgb3IgYSBzdG9wIGRhdGVcbiAgICogQHJldHVybiBhcnJheSAgQW4gYXJyYXkgb2YgbWludXRlc1xuICAgKi9cbiAgZ2V0TWludXRlRG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCksIGQuZ2V0SG91cnMoKSk7XG4gICAgdmFyIHN0b3AgPSBudWxsO1xuICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShyYW5nZS5nZXRGdWxsWWVhcigpLCByYW5nZS5nZXRNb250aCgpLCByYW5nZS5nZXREYXRlKCksIHJhbmdlLmdldEhvdXJzKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoK3N0YXJ0ICsgcmFuZ2UgKiAxMDAwICogNjApO1xuICAgIH1cbiAgICByZXR1cm4gZDMudGltZS5taW51dGVzKE1hdGgubWluKHN0YXJ0LCBzdG9wKSwgTWF0aC5tYXgoc3RhcnQsIHN0b3ApKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgaG91cnMgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgZCAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgaG91cnMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiBob3Vyc1xuICAgKi9cbiAgZ2V0SG91ckRvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIGQuZ2V0RGF0ZSgpLCBkLmdldEhvdXJzKCkpO1xuICAgIHZhciBzdG9wID0gbnVsbDtcbiAgICBpZiAocmFuZ2UgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUocmFuZ2UuZ2V0RnVsbFllYXIoKSwgcmFuZ2UuZ2V0TW9udGgoKSwgcmFuZ2UuZ2V0RGF0ZSgpLCByYW5nZS5nZXRIb3VycygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHN0YXJ0KTtcbiAgICAgIHN0b3Auc2V0SG91cnMoc3RvcC5nZXRIb3VycygpICsgcmFuZ2UpO1xuICAgIH1cblxuICAgIHZhciBkb21haW5zID0gZDMudGltZS5ob3VycyhNYXRoLm1pbihzdGFydCwgc3RvcCksIE1hdGgubWF4KHN0YXJ0LCBzdG9wKSk7XG5cbiAgICAvLyBQYXNzaW5nIGZyb20gRFNUIHRvIHN0YW5kYXJkIHRpbWVcbiAgICAvLyBJZiB0aGVyZSBhcmUgMjUgaG91cnMsIGxldCdzIGNvbXByZXNzIHRoZSBkdXBsaWNhdGUgaG91cnNcbiAgICB2YXIgaSA9IDA7XG4gICAgdmFyIHRvdGFsID0gZG9tYWlucy5sZW5ndGg7XG4gICAgZm9yIChpID0gMDsgaSA8IHRvdGFsOyBpKyspIHtcbiAgICAgIGlmIChpID4gMCAmJiBkb21haW5zW2ldLmdldEhvdXJzKCkgPT09IGRvbWFpbnNbaSAtIDFdLmdldEhvdXJzKCkpIHtcbiAgICAgICAgdGhpcy5EU1REb21haW4ucHVzaChkb21haW5zW2ldLmdldFRpbWUoKSk7XG4gICAgICAgIGRvbWFpbnMuc3BsaWNlKGksIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBkMy50aW1lLmhvdXJzIGlzIHJldHVybmluZyBtb3JlIGhvdXJzIHRoYW4gbmVlZGVkIHdoZW4gY2hhbmdpbmdcbiAgICAvLyBmcm9tIERTVCB0byBzdGFuZGFyZCB0aW1lLCBiZWNhdXNlIHRoZXJlIGlzIHJlYWxseSAyIGhvdXJzIGJldHdlZW5cbiAgICAvLyAxYW0gYW5kIDJhbSFcbiAgICBpZiAodHlwZW9mIHJhbmdlID09PSAnbnVtYmVyJyAmJiBkb21haW5zLmxlbmd0aCA+IE1hdGguYWJzKHJhbmdlKSkge1xuICAgICAgZG9tYWlucy5zcGxpY2UoZG9tYWlucy5sZW5ndGggLSAxLCAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG9tYWlucztcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgZGF5cyBiZXR3ZWVuIDIgZGF0ZXNcbiAgICpcbiAgICogQHBhcmFtICBEYXRlICAgIGQgICAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgZGF5cyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIHdlZWtzXG4gICAqL1xuICBnZXREYXlEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSk7XG4gICAgdmFyIHN0b3AgPSBudWxsO1xuICAgIGlmIChyYW5nZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHN0b3AgPSBuZXcgRGF0ZShyYW5nZS5nZXRGdWxsWWVhcigpLCByYW5nZS5nZXRNb250aCgpLCByYW5nZS5nZXREYXRlKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoc3RhcnQpO1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHN0b3Auc2V0RGF0ZShzdG9wLmdldERhdGUoKSArIHBhcnNlSW50KHJhbmdlLCAxMCkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZDMudGltZS5kYXlzKE1hdGgubWluKHN0YXJ0LCBzdG9wKSwgTWF0aC5tYXgoc3RhcnQsIHN0b3ApKTtcbiAgfSxcblxuICAvKipcbiAgICogUmV0dXJuIGFsbCB0aGUgd2Vla3MgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgZCAgQSBkYXRlXG4gICAqIEBwYXJhbSAgaW50fGRhdGUgIHJhbmdlICBOdW1iZXIgb2YgbWludXRlcyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIHdlZWtzXG4gICAqL1xuICBnZXRXZWVrRG9tYWluOiBmdW5jdGlvbiAoZCwgcmFuZ2UpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgd2Vla1N0YXJ0O1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy53ZWVrU3RhcnRPbk1vbmRheSA9PT0gZmFsc2UpIHtcbiAgICAgIHdlZWtTdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSAtIGQuZ2V0RGF5KCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZC5nZXREYXkoKSA9PT0gMSkge1xuICAgICAgICB3ZWVrU3RhcnQgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkpO1xuICAgICAgfSBlbHNlIGlmIChkLmdldERheSgpID09PSAwKSB7XG4gICAgICAgIHdlZWtTdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSk7XG4gICAgICAgIHdlZWtTdGFydC5zZXREYXRlKHdlZWtTdGFydC5nZXREYXRlKCkgLSA2KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdlZWtTdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSAtIGQuZ2V0RGF5KCkgKyAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZW5kRGF0ZSA9IG5ldyBEYXRlKHdlZWtTdGFydCk7XG5cbiAgICB2YXIgc3RvcCA9IHJhbmdlO1xuICAgIGlmICh0eXBlb2YgcmFuZ2UgIT09ICdvYmplY3QnKSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoZW5kRGF0ZS5zZXREYXRlKGVuZERhdGUuZ2V0RGF0ZSgpICsgcmFuZ2UgKiA3KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy53ZWVrU3RhcnRPbk1vbmRheSA9PT0gdHJ1ZVxuICAgICAgPyBkMy50aW1lLm1vbmRheXMoTWF0aC5taW4od2Vla1N0YXJ0LCBzdG9wKSwgTWF0aC5tYXgod2Vla1N0YXJ0LCBzdG9wKSlcbiAgICAgIDogZDMudGltZS5zdW5kYXlzKE1hdGgubWluKHdlZWtTdGFydCwgc3RvcCksIE1hdGgubWF4KHdlZWtTdGFydCwgc3RvcCkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYWxsIHRoZSBtb250aHMgYmV0d2VlbiAyIGRhdGVzXG4gICAqXG4gICAqIEBwYXJhbSAgRGF0ZSAgICBkICAgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIG1vbnRocyBpbiB0aGUgcmFuZ2UsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gYXJyYXkgIEFuIGFycmF5IG9mIG1vbnRoc1xuICAgKi9cbiAgZ2V0TW9udGhEb21haW46IGZ1bmN0aW9uIChkLCByYW5nZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpKTtcbiAgICB2YXIgc3RvcCA9IG51bGw7XG4gICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHJhbmdlLmdldEZ1bGxZZWFyKCksIHJhbmdlLmdldE1vbnRoKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoc3RhcnQpO1xuICAgICAgc3RvcCA9IHN0b3Auc2V0TW9udGgoc3RvcC5nZXRNb250aCgpICsgcmFuZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiBkMy50aW1lLm1vbnRocyhNYXRoLm1pbihzdGFydCwgc3RvcCksIE1hdGgubWF4KHN0YXJ0LCBzdG9wKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybiBhbGwgdGhlIHllYXJzIGJldHdlZW4gMiBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIERhdGUgIGQgIGRhdGUgIEEgZGF0ZVxuICAgKiBAcGFyYW0gIGludHxkYXRlICByYW5nZSAgTnVtYmVyIG9mIG1pbnV0ZXMgaW4gdGhlIHJhbmdlLCBvciBhIHN0b3AgZGF0ZVxuICAgKiBAcmV0dXJuIGFycmF5ICBBbiBhcnJheSBvZiBob3Vyc1xuICAgKi9cbiAgZ2V0WWVhckRvbWFpbjogZnVuY3Rpb24gKGQsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpLCAwKTtcbiAgICB2YXIgc3RvcCA9IG51bGw7XG4gICAgaWYgKHJhbmdlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgc3RvcCA9IG5ldyBEYXRlKHJhbmdlLmdldEZ1bGxZZWFyKCksIDApO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdG9wID0gbmV3IERhdGUoZC5nZXRGdWxsWWVhcigpICsgcmFuZ2UsIDApO1xuICAgIH1cblxuICAgIHJldHVybiBkMy50aW1lLnllYXJzKE1hdGgubWluKHN0YXJ0LCBzdG9wKSwgTWF0aC5tYXgoc3RhcnQsIHN0b3ApKTtcbiAgfSxcblxuICAvKipcbiAgICogR2V0IGFuIGFycmF5IG9mIGRvbWFpbiBzdGFydCBkYXRlc1xuICAgKlxuICAgKiBAcGFyYW0gIGludHxEYXRlIGRhdGUgQSByYW5kb20gZGF0ZSBpbmNsdWRlZCBpbiB0aGUgd2FudGVkIGRvbWFpblxuICAgKiBAcGFyYW0gIGludHxEYXRlIHJhbmdlIE51bWJlciBvZiBkYXRlcyB0byBnZXQsIG9yIGEgc3RvcCBkYXRlXG4gICAqIEByZXR1cm4gQXJyYXkgb2YgZGF0ZXNcbiAgICovXG4gIGdldERvbWFpbjogZnVuY3Rpb24gKGRhdGUsIHJhbmdlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkYXRlID09PSAnbnVtYmVyJykge1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIH1cblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgcmFuZ2UgPSB0aGlzLm9wdGlvbnMucmFuZ2U7XG4gICAgfVxuXG4gICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuZG9tYWluKSB7XG4gICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgdmFyIGRvbWFpbnMgPSB0aGlzLmdldEhvdXJEb21haW4oZGF0ZSwgcmFuZ2UpO1xuXG4gICAgICAgIC8vIENhc2Ugd2hlcmUgYW4gaG91ciBpcyBtaXNzaW5nLCB3aGVuIHBhc3NpbmcgZnJvbSBzdGFuZGFyZCB0aW1lIHRvIERTVFxuICAgICAgICAvLyBNaXNzaW5nIGhvdXIgaXMgcGVyZmVjdGx5IGFjY2VwdGFibCBpbiBzdWJEb21haW4sIGJ1dCBub3QgaW4gZG9tYWluc1xuICAgICAgICBpZiAodHlwZW9mIHJhbmdlID09PSAnbnVtYmVyJyAmJiBkb21haW5zLmxlbmd0aCA8IHJhbmdlKSB7XG4gICAgICAgICAgaWYgKHJhbmdlID4gMCkge1xuICAgICAgICAgICAgZG9tYWlucy5wdXNoKHRoaXMuZ2V0SG91ckRvbWFpbihkb21haW5zW2RvbWFpbnMubGVuZ3RoIC0gMV0sIDIpWzFdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZG9tYWlucy5zaGlmdCh0aGlzLmdldEhvdXJEb21haW4oZG9tYWluc1swXSwgLTIpWzBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRvbWFpbnM7XG4gICAgICBjYXNlICdkYXknOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXREYXlEb21haW4oZGF0ZSwgcmFuZ2UpO1xuICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFdlZWtEb21haW4oZGF0ZSwgcmFuZ2UpO1xuICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICByZXR1cm4gdGhpcy5nZXRNb250aERvbWFpbihkYXRlLCByYW5nZSk7XG4gICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0WWVhckRvbWFpbihkYXRlLCByYW5nZSk7XG4gICAgfVxuICB9LFxuXG4gIC8qIGpzaGludCBtYXhjb21wbGV4aXR5OiBmYWxzZSAqL1xuICBnZXRTdWJEb21haW46IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHR5cGVvZiBkYXRlID09PSAnbnVtYmVyJykge1xuICAgICAgZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIH1cblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiBpbnRcbiAgICAgKi9cbiAgICB2YXIgY29tcHV0ZURheVN1YkRvbWFpblNpemUgPSBmdW5jdGlvbiAoZGF0ZSwgZG9tYWluKSB7XG4gICAgICBzd2l0Y2ggKGRvbWFpbikge1xuICAgICAgICBjYXNlICd5ZWFyJzpcbiAgICAgICAgICByZXR1cm4gcGFyZW50LmdldERheUNvdW50SW5ZZWFyKGRhdGUpO1xuICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgcmV0dXJuIHBhcmVudC5nZXREYXlDb3VudEluTW9udGgoZGF0ZSk7XG4gICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgIHJldHVybiA3O1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIGludFxuICAgICAqL1xuICAgIHZhciBjb21wdXRlTWluU3ViRG9tYWluU2l6ZSA9IGZ1bmN0aW9uIChkYXRlLCBkb21haW4pIHtcbiAgICAgIHN3aXRjaCAoZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgIHJldHVybiA2MDtcbiAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICByZXR1cm4gNjAgKiAyNDtcbiAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgcmV0dXJuIDYwICogMjQgKiA3O1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIGludFxuICAgICAqL1xuICAgIHZhciBjb21wdXRlSG91clN1YkRvbWFpblNpemUgPSBmdW5jdGlvbiAoZGF0ZSwgZG9tYWluKSB7XG4gICAgICBzd2l0Y2ggKGRvbWFpbikge1xuICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgIHJldHVybiAyNDtcbiAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgcmV0dXJuIDE2ODtcbiAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgIHJldHVybiBwYXJlbnQuZ2V0RGF5Q291bnRJbk1vbnRoKGRhdGUpICogMjQ7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4gaW50XG4gICAgICovXG4gICAgdmFyIGNvbXB1dGVXZWVrU3ViRG9tYWluU2l6ZSA9IGZ1bmN0aW9uIChkYXRlLCBkb21haW4pIHtcbiAgICAgIGlmIChkb21haW4gPT09ICdtb250aCcpIHtcbiAgICAgICAgdmFyIGVuZE9mTW9udGggPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDEsIDApO1xuICAgICAgICB2YXIgZW5kV2Vla05iID0gcGFyZW50LmdldFdlZWtOdW1iZXIoZW5kT2ZNb250aCk7XG4gICAgICAgIHZhciBzdGFydFdlZWtOYiA9IHBhcmVudC5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpKSk7XG5cbiAgICAgICAgaWYgKHN0YXJ0V2Vla05iID4gZW5kV2Vla05iKSB7XG4gICAgICAgICAgc3RhcnRXZWVrTmIgPSAwO1xuICAgICAgICAgIGVuZFdlZWtOYisrO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGVuZFdlZWtOYiAtIHN0YXJ0V2Vla05iICsgMTtcbiAgICAgIH0gZWxzZSBpZiAoZG9tYWluID09PSAneWVhcicpIHtcbiAgICAgICAgcmV0dXJuIHBhcmVudC5nZXRXZWVrTnVtYmVyKG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMTEsIDMxKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnN1YkRvbWFpbikge1xuICAgICAgY2FzZSAneF9taW4nOlxuICAgICAgY2FzZSAnbWluJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWludXRlRG9tYWluKGRhdGUsIGNvbXB1dGVNaW5TdWJEb21haW5TaXplKGRhdGUsIHRoaXMub3B0aW9ucy5kb21haW4pKTtcbiAgICAgIGNhc2UgJ3hfaG91cic6XG4gICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SG91ckRvbWFpbihkYXRlLCBjb21wdXRlSG91clN1YkRvbWFpblNpemUoZGF0ZSwgdGhpcy5vcHRpb25zLmRvbWFpbikpO1xuICAgICAgY2FzZSAneF9kYXknOlxuICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF5RG9tYWluKGRhdGUsIGNvbXB1dGVEYXlTdWJEb21haW5TaXplKGRhdGUsIHRoaXMub3B0aW9ucy5kb21haW4pKTtcbiAgICAgIGNhc2UgJ3hfd2Vlayc6XG4gICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0V2Vla0RvbWFpbihkYXRlLCBjb21wdXRlV2Vla1N1YkRvbWFpblNpemUoZGF0ZSwgdGhpcy5vcHRpb25zLmRvbWFpbikpO1xuICAgICAgY2FzZSAneF9tb250aCc6XG4gICAgICBjYXNlICdtb250aCc6XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1vbnRoRG9tYWluKGRhdGUsIDEyKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbi10aCBuZXh0IGRvbWFpbiBhZnRlciB0aGUgY2FsZW5kYXIgbmV3ZXN0IChyaWdodG1vc3QpIGRvbWFpblxuICAgKiBAcGFyYW0gIGludCBuXG4gICAqIEByZXR1cm4gRGF0ZSBUaGUgc3RhcnQgZGF0ZSBvZiB0aGUgd2FudGVkIGRvbWFpblxuICAgKi9cbiAgZ2V0TmV4dERvbWFpbjogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbiA9IDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdldERvbWFpbih0aGlzLmp1bXBEYXRlKHRoaXMuZ2V0RG9tYWluS2V5cygpLnBvcCgpLCBuLCB0aGlzLm9wdGlvbnMuZG9tYWluKSwgMSlbMF07XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldCB0aGUgbi10aCBkb21haW4gYmVmb3JlIHRoZSBjYWxlbmRhciBvbGRlc3QgKGxlZnRtb3N0KSBkb21haW5cbiAgICogQHBhcmFtICBpbnQgblxuICAgKiBAcmV0dXJuIERhdGUgVGhlIHN0YXJ0IGRhdGUgb2YgdGhlIHdhbnRlZCBkb21haW5cbiAgICovXG4gIGdldFByZXZpb3VzRG9tYWluOiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBuID0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZ2V0RG9tYWluKFxuICAgICAgdGhpcy5qdW1wRGF0ZSh0aGlzLmdldERvbWFpbktleXMoKS5zaGlmdCgpLCAtbiwgdGhpcy5vcHRpb25zLmRvbWFpbiksXG4gICAgICAxLFxuICAgIClbMF07XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIERBVEFTICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBGZXRjaCBhbmQgaW50ZXJwcmV0IGRhdGEgZnJvbSB0aGUgZGF0YXNvdXJjZVxuICAgKlxuICAgKiBAcGFyYW0gc3RyaW5nfG9iamVjdCBzb3VyY2VcbiAgICogQHBhcmFtIERhdGUgc3RhcnREYXRlXG4gICAqIEBwYXJhbSBEYXRlIGVuZERhdGVcbiAgICogQHBhcmFtIGZ1bmN0aW9uIGNhbGxiYWNrXG4gICAqIEBwYXJhbSBmdW5jdGlvbnxib29sZWFuIGFmdGVyTG9hZCBmdW5jdGlvbiB1c2VkIHRvIGNvbnZlcnQgdGhlIGRhdGEgaW50byBhIGpzb24gb2JqZWN0LiBVc2UgdHJ1ZSB0byB1c2UgdGhlIGFmdGVyTG9hZCBjYWxsYmFja1xuICAgKiBAcGFyYW0gdXBkYXRlTW9kZVxuICAgKlxuICAgKiBAcmV0dXJuIG1peGVkXG4gICAqIC0gVHJ1ZSBpZiB0aGVyZSBhcmUgbm8gZGF0YSB0byBsb2FkXG4gICAqIC0gRmFsc2UgaWYgZGF0YSBhcmUgbG9hZGVkIGFzeW5jaHJvbm91c2x5XG4gICAqL1xuICBnZXREYXRhczogZnVuY3Rpb24gKHNvdXJjZSwgc3RhcnREYXRlLCBlbmREYXRlLCBjYWxsYmFjaywgYWZ0ZXJMb2FkLCB1cGRhdGVNb2RlKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgNSkge1xuICAgICAgYWZ0ZXJMb2FkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCA2KSB7XG4gICAgICB1cGRhdGVNb2RlID0gdGhpcy5BUFBFTkRfT05fVVBEQVRFO1xuICAgIH1cbiAgICB2YXIgX2NhbGxiYWNrID0gZnVuY3Rpb24gKGVycm9yLCBkYXRhKSB7XG4gICAgICBpZiAoYWZ0ZXJMb2FkICE9PSBmYWxzZSkge1xuICAgICAgICBpZiAodHlwZW9mIGFmdGVyTG9hZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGRhdGEgPSBhZnRlckxvYWQoZGF0YSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNlbGYub3B0aW9ucy5hZnRlckxvYWREYXRhID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgZGF0YSA9IHNlbGYub3B0aW9ucy5hZnRlckxvYWREYXRhKGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm92aWRlZCBjYWxsYmFjayBmb3IgYWZ0ZXJMb2FkRGF0YSBpcyBub3QgYSBmdW5jdGlvbi4nKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzZWxmLm9wdGlvbnMuZGF0YVR5cGUgPT09ICdjc3YnIHx8IHNlbGYub3B0aW9ucy5kYXRhVHlwZSA9PT0gJ3RzdicpIHtcbiAgICAgICAgZGF0YSA9IHRoaXMuaW50ZXJwcmV0Q1NWKGRhdGEpO1xuICAgICAgfVxuICAgICAgc2VsZi5wYXJzZURhdGFzKGRhdGEsIHVwZGF0ZU1vZGUsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG4gICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHN3aXRjaCAodHlwZW9mIHNvdXJjZSkge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgaWYgKHNvdXJjZSA9PT0gJycpIHtcbiAgICAgICAgICBfY2FsbGJhY2sobnVsbCwge30pO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnBhcnNlVVJJKHNvdXJjZSwgc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgICAgICB2YXIgcmVxdWVzdFR5cGUgPSAnR0VUJztcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmRhdGFQb3N0UGF5bG9hZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVxdWVzdFR5cGUgPSAnUE9TVCc7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBwYXlsb2FkID0gbnVsbDtcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmRhdGFQb3N0UGF5bG9hZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcGF5bG9hZCA9IHRoaXMucGFyc2VVUkkoc2VsZi5vcHRpb25zLmRhdGFQb3N0UGF5bG9hZCwgc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgeGhyID0gbnVsbDtcbiAgICAgICAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5kYXRhVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnanNvbic6XG4gICAgICAgICAgICAgIHhociA9IGQzLmpzb24odXJsKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdjc3YnOlxuICAgICAgICAgICAgICB4aHIgPSBkMy5jc3YodXJsKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0c3YnOlxuICAgICAgICAgICAgICB4aHIgPSBkMy50c3YodXJsKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0eHQnOlxuICAgICAgICAgICAgICB4aHIgPSBkMy50ZXh0KHVybCwgJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8ganNoaW50IG1heGRlcHRoOjVcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmRhdGFSZXF1ZXN0SGVhZGVycyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaGVhZGVyIGluIHNlbGYub3B0aW9ucy5kYXRhUmVxdWVzdEhlYWRlcnMpIHtcbiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5kYXRhUmVxdWVzdEhlYWRlcnMuaGFzT3duUHJvcGVydHkoaGVhZGVyKSkge1xuICAgICAgICAgICAgICAgIHhoci5oZWFkZXIoaGVhZGVyLCBzZWxmLm9wdGlvbnMuZGF0YVJlcXVlc3RIZWFkZXJzW2hlYWRlcl0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgeGhyLnNlbmQocmVxdWVzdFR5cGUsIHBheWxvYWQsIF9jYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgaWYgKHNvdXJjZSA9PT0gT2JqZWN0KHNvdXJjZSkpIHtcbiAgICAgICAgICBfY2FsbGJhY2sobnVsbCwgc291cmNlKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi9cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIF9jYWxsYmFjayhudWxsLCB7fSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogUG9wdWxhdGUgdGhlIGNhbGVuZGFyIGludGVybmFsIGRhdGFcbiAgICpcbiAgICogQHBhcmFtIG9iamVjdCBkYXRhXG4gICAqIEBwYXJhbSBjb25zdGFudCB1cGRhdGVNb2RlXG4gICAqIEBwYXJhbSBEYXRlIHN0YXJ0RGF0ZVxuICAgKiBAcGFyYW0gRGF0ZSBlbmREYXRlXG4gICAqXG4gICAqIEByZXR1cm4gdm9pZFxuICAgKi9cbiAgcGFyc2VEYXRhczogZnVuY3Rpb24gKGRhdGEsIHVwZGF0ZU1vZGUsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICh1cGRhdGVNb2RlID09PSB0aGlzLlJFU0VUX0FMTF9PTl9VUERBVEUpIHtcbiAgICAgIHRoaXMuX2RvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICB2YWx1ZS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50LCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICBhcnJheVtpbmRleF0udiA9IG51bGw7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHRlbXAgPSB7fTtcblxuICAgIHZhciBleHRyYWN0VGltZSA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICByZXR1cm4gZC50O1xuICAgIH07XG5cbiAgICAvKmpzaGludCBmb3JpbjpmYWxzZSAqL1xuICAgIGZvciAodmFyIGQgaW4gZGF0YSkge1xuICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShkICogMTAwMCk7XG4gICAgICB2YXIgZG9tYWluVW5pdCA9IHRoaXMuZ2V0RG9tYWluKGRhdGUpWzBdLmdldFRpbWUoKTtcbiAgICAgIC8vIFRoZSBjdXJyZW50IGRhdGEgYmVsb25ncyB0byBhIGRvbWFpbiB0aGF0IHdhcyBjb21wcmVzc2VkXG4gICAgICAvLyBDb21wcmVzcyB0aGUgZGF0YSBmb3IgdGhlIHR3byBkdXBsaWNhdGUgaG91cnMgaW50byB0aGUgc2FtZSBob3VyXG4gICAgICBpZiAodGhpcy5EU1REb21haW4uaW5kZXhPZihkb21haW5Vbml0KSA+PSAwKSB7XG4gICAgICAgIC8vIFJlLWFzc2lnbiBhbGwgZGF0YSB0byB0aGUgZmlyc3Qgb3IgdGhlIHNlY29uZCBkdXBsaWNhdGUgaG91cnNcbiAgICAgICAgLy8gZGVwZW5kaW5nIG9uIHdoaWNoIGlzIHZpc2libGVcbiAgICAgICAgaWYgKHRoaXMuX2RvbWFpbnMuaGFzKGRvbWFpblVuaXQgLSAzNjAwICogMTAwMCkpIHtcbiAgICAgICAgICBkb21haW5Vbml0IC09IDM2MDAgKiAxMDAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNraXAgaWYgZGF0YSBpcyBub3QgcmVsZXZhbnQgdG8gY3VycmVudCBkb21haW5cbiAgICAgIGlmIChcbiAgICAgICAgaXNOYU4oZCkgfHxcbiAgICAgICAgIWRhdGEuaGFzT3duUHJvcGVydHkoZCkgfHxcbiAgICAgICAgIXRoaXMuX2RvbWFpbnMuaGFzKGRvbWFpblVuaXQpIHx8XG4gICAgICAgICEoZG9tYWluVW5pdCA+PSArc3RhcnREYXRlICYmIGRvbWFpblVuaXQgPCArZW5kRGF0ZSlcbiAgICAgICkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIHN1YkRvbWFpbnNEYXRhID0gdGhpcy5fZG9tYWlucy5nZXQoZG9tYWluVW5pdCk7XG5cbiAgICAgIGlmICghdGVtcC5oYXNPd25Qcm9wZXJ0eShkb21haW5Vbml0KSkge1xuICAgICAgICB0ZW1wW2RvbWFpblVuaXRdID0gc3ViRG9tYWluc0RhdGEubWFwKGV4dHJhY3RUaW1lKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGluZGV4ID0gdGVtcFtkb21haW5Vbml0XS5pbmRleE9mKFxuICAgICAgICB0aGlzLl9kb21haW5UeXBlW3RoaXMub3B0aW9ucy5zdWJEb21haW5dLmV4dHJhY3RVbml0KGRhdGUpLFxuICAgICAgKTtcblxuICAgICAgaWYgKHVwZGF0ZU1vZGUgPT09IHRoaXMuUkVTRVRfU0lOR0xFX09OX1VQREFURSkge1xuICAgICAgICBzdWJEb21haW5zRGF0YVtpbmRleF0udiA9IGRhdGFbZF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIWlzTmFOKHN1YkRvbWFpbnNEYXRhW2luZGV4XS52KSkge1xuICAgICAgICAgIHN1YkRvbWFpbnNEYXRhW2luZGV4XS52ICs9IGRhdGFbZF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3ViRG9tYWluc0RhdGFbaW5kZXhdLnYgPSBkYXRhW2RdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHBhcnNlVVJJOiBmdW5jdGlvbiAoc3RyLCBzdGFydERhdGUsIGVuZERhdGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvLyBVc2UgYSB0aW1lc3RhbXAgaW4gc2Vjb25kc1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHtcXHt0OnN0YXJ0XFx9XFx9L2csIHN0YXJ0RGF0ZS5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx7XFx7dDplbmRcXH1cXH0vZywgZW5kRGF0ZS5nZXRUaW1lKCkgLyAxMDAwKTtcblxuICAgIC8vIFVzZSBhIHN0cmluZyBkYXRlLCBmb2xsb3dpbmcgdGhlIElTTy04NjAxXG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xce1xce2Q6c3RhcnRcXH1cXH0vZywgc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkpO1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHtcXHtkOmVuZFxcfVxcfS9nLCBlbmREYXRlLnRvSVNPU3RyaW5nKCkpO1xuXG4gICAgcmV0dXJuIHN0cjtcbiAgfSxcblxuICBpbnRlcnByZXRDU1Y6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIGQgPSB7fTtcbiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGRhdGFbMF0pO1xuICAgIHZhciBpLCB0b3RhbDtcbiAgICBmb3IgKGkgPSAwLCB0b3RhbCA9IGRhdGEubGVuZ3RoOyBpIDwgdG90YWw7IGkrKykge1xuICAgICAgZFtkYXRhW2ldW2tleXNbMF1dXSA9ICtkYXRhW2ldW2tleXNbMV1dO1xuICAgIH1cbiAgICByZXR1cm4gZDtcbiAgfSxcblxuICAvKipcbiAgICogSGFuZGxlIHRoZSBjYWxlbmRhciBsYXlvdXQgYW5kIGRpbWVuc2lvblxuICAgKlxuICAgKiBFeHBhbmQgYW5kIHNocmluayB0aGUgY29udGFpbmVyIGRlcGVuZGluZyBvbiBpdHMgY2hpbGRyZW4gZGltZW5zaW9uXG4gICAqIEFsc28gcmVhcnJhbmdlIHRoZSBjaGlsZHJlbiBwb3NpdGlvbiBkZXBlbmRpbmcgb24gdGhlaXIgZGltZW5zaW9uLFxuICAgKiBhbmQgdGhlIGxlZ2VuZCBwb3NpdGlvblxuICAgKlxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIHJlc2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBwYXJlbnQgPSB0aGlzO1xuICAgIHZhciBvcHRpb25zID0gcGFyZW50Lm9wdGlvbnM7XG4gICAgdmFyIGxlZ2VuZFdpZHRoID0gb3B0aW9ucy5kaXNwbGF5TGVnZW5kXG4gICAgICA/IHBhcmVudC5MZWdlbmQuZ2V0RGltKCd3aWR0aCcpICsgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMV0gKyBvcHRpb25zLmxlZ2VuZE1hcmdpblszXVxuICAgICAgOiAwO1xuICAgIHZhciBsZWdlbmRIZWlnaHQgPSBvcHRpb25zLmRpc3BsYXlMZWdlbmRcbiAgICAgID8gcGFyZW50LkxlZ2VuZC5nZXREaW0oJ2hlaWdodCcpICsgb3B0aW9ucy5sZWdlbmRNYXJnaW5bMF0gKyBvcHRpb25zLmxlZ2VuZE1hcmdpblsyXVxuICAgICAgOiAwO1xuXG4gICAgdmFyIGdyYXBoV2lkdGggPSBwYXJlbnQuZ3JhcGhEaW0ud2lkdGggLSBvcHRpb25zLmRvbWFpbkd1dHRlciAtIG9wdGlvbnMuY2VsbFBhZGRpbmc7XG4gICAgdmFyIGdyYXBoSGVpZ2h0ID0gcGFyZW50LmdyYXBoRGltLmhlaWdodCAtIG9wdGlvbnMuZG9tYWluR3V0dGVyIC0gb3B0aW9ucy5jZWxsUGFkZGluZztcblxuICAgIHRoaXMucm9vdFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKG9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24pXG4gICAgICAuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdtaWRkbGUnIHx8XG4gICAgICAgICAgb3B0aW9ucy5sZWdlbmRWZXJ0aWNhbFBvc2l0aW9uID09PSAnY2VudGVyJ1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gZ3JhcGhXaWR0aCArIGxlZ2VuZFdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBNYXRoLm1heChncmFwaFdpZHRoLCBsZWdlbmRXaWR0aCk7XG4gICAgICB9KVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ21pZGRsZScgfHxcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdjZW50ZXInXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBNYXRoLm1heChncmFwaEhlaWdodCwgbGVnZW5kSGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ3JhcGhIZWlnaHQgKyBsZWdlbmRIZWlnaHQ7XG4gICAgICB9KTtcblxuICAgIHRoaXMucm9vdFxuICAgICAgLnNlbGVjdCgnLmdyYXBoJylcbiAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgICAgLmF0dHIoJ3knLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICAgICAgcmV0dXJuIGxlZ2VuZEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0pXG4gICAgICAuYXR0cigneCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdtaWRkbGUnIHx8XG4gICAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdjZW50ZXInKSAmJlxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kSG9yaXpvbnRhbFBvc2l0aW9uID09PSAnbGVmdCdcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGxlZ2VuZFdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG4gIC8vIFBVQkxJQyBBUEkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gIC8qKlxuICAgKiBTaGlmdCB0aGUgY2FsZW5kYXIgZm9yd2FyZFxuICAgKi9cbiAgbmV4dDogZnVuY3Rpb24gKG4pIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbiA9IDE7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmxvYWROZXh0RG9tYWluKG4pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBTaGlmdCB0aGUgY2FsZW5kYXIgYmFja3dhcmRcbiAgICovXG4gIHByZXZpb3VzOiBmdW5jdGlvbiAobikge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBuID0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubG9hZFByZXZpb3VzRG9tYWluKG4pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBKdW1wIGRpcmVjdGx5IHRvIGEgc3BlY2lmaWMgZGF0ZVxuICAgKlxuICAgKiBKdW1wVG8gd2lsbCBzY3JvbGwgdGhlIGNhbGVuZGFyIHVudGlsIHRoZSB3YW50ZWQgZG9tYWluIHdpdGggdGhlIHNwZWNpZmllZFxuICAgKiBkYXRlIGlzIHZpc2libGUuIFVubGVzcyB5b3Ugc2V0IHJlc2V0IHRvIHRydWUsIHRoZSB3YW50ZWQgZG9tYWluXG4gICAqIHdpbGwgbm90IG5lY2Vzc2FyaWx5IGJlIHRoZSBmaXJzdCAobGVmdG1vc3QpIGRvbWFpbiBvZiB0aGUgY2FsZW5kYXIuXG4gICAqXG4gICAqIEBwYXJhbSBEYXRlIGRhdGUgSnVtcCB0byB0aGUgZG9tYWluIGNvbnRhaW5pbmcgdGhhdCBkYXRlXG4gICAqIEBwYXJhbSBib29sIHJlc2V0IFdoZXRoZXIgdGhlIHdhbnRlZCBkb21haW4gc2hvdWxkIGJlIHRoZSBmaXJzdCBkb21haW4gb2YgdGhlIGNhbGVuZGFyXG4gICAqIEBwYXJhbSBib29sIFRydWUgb2YgdGhlIGNhbGVuZGFyIHdhcyBzY3JvbGxlZFxuICAgKi9cbiAganVtcFRvOiBmdW5jdGlvbiAoZGF0ZSwgcmVzZXQpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJlc2V0ID0gZmFsc2U7XG4gICAgfVxuICAgIHZhciBkb21haW5zID0gdGhpcy5nZXREb21haW5LZXlzKCk7XG4gICAgdmFyIGZpcnN0RG9tYWluID0gZG9tYWluc1swXTtcbiAgICB2YXIgbGFzdERvbWFpbiA9IGRvbWFpbnNbZG9tYWlucy5sZW5ndGggLSAxXTtcblxuICAgIGlmIChkYXRlIDwgZmlyc3REb21haW4pIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRQcmV2aW91c0RvbWFpbih0aGlzLmdldERvbWFpbihmaXJzdERvbWFpbiwgZGF0ZSkubGVuZ3RoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHJlc2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvYWROZXh0RG9tYWluKHRoaXMuZ2V0RG9tYWluKGZpcnN0RG9tYWluLCBkYXRlKS5sZW5ndGgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0ZSA+IGxhc3REb21haW4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZE5leHREb21haW4odGhpcy5nZXREb21haW4obGFzdERvbWFpbiwgZGF0ZSkubGVuZ3RoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE5hdmlnYXRlIGJhY2sgdG8gdGhlIHN0YXJ0IGRhdGVcbiAgICpcbiAgICogQHNpbmNlICAzLjMuOFxuICAgKiBAcmV0dXJuIHZvaWRcbiAgICovXG4gIHJld2luZDogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHRoaXMuanVtcFRvKHRoaXMub3B0aW9ucy5zdGFydCwgdHJ1ZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgY2FsZW5kYXIgd2l0aCBuZXcgZGF0YVxuICAgKlxuICAgKiBAcGFyYW0gIG9iamVjdHxzdHJpbmcgICAgZGF0YVNvdXJjZSAgICBUaGUgY2FsZW5kYXIncyBkYXRhc291cmNlLCBzYW1lIHR5cGUgYXMgdGhpcy5vcHRpb25zLmRhdGFcbiAgICogQHBhcmFtICBib29sZWFufGZ1bmN0aW9uICAgIGFmdGVyTG9hZCAgICBXaGV0aGVyIHRvIGV4ZWN1dGUgYWZ0ZXJMb2FkKCkgb24gdGhlIGRhdGEuIFBhc3MgZGlyZWN0bHkgYSBmdW5jdGlvblxuICAgKiBpZiB5b3UgZG9uJ3Qgd2FudCB0byB1c2UgdGhlIGFmdGVyTG9hZCgpIGNhbGxiYWNrXG4gICAqL1xuICB1cGRhdGU6IGZ1bmN0aW9uIChkYXRhU291cmNlLCBhZnRlckxvYWQsIHVwZGF0ZU1vZGUpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZGF0YVNvdXJjZSA9IHRoaXMub3B0aW9ucy5kYXRhO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHtcbiAgICAgIGFmdGVyTG9hZCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykge1xuICAgICAgdXBkYXRlTW9kZSA9IHRoaXMuUkVTRVRfQUxMX09OX1VQREFURTtcbiAgICB9XG5cbiAgICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0RG9tYWluS2V5cygpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLmdldERhdGFzKFxuICAgICAgZGF0YVNvdXJjZSxcbiAgICAgIG5ldyBEYXRlKGRvbWFpbnNbMF0pLFxuICAgICAgdGhpcy5nZXRTdWJEb21haW4oZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdKS5wb3AoKSxcbiAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5maWxsKCk7XG4gICAgICAgIHNlbGYuYWZ0ZXJVcGRhdGUoKTtcbiAgICAgIH0sXG4gICAgICBhZnRlckxvYWQsXG4gICAgICB1cGRhdGVNb2RlLFxuICAgICk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbGVnZW5kXG4gICAqXG4gICAqIEBwYXJhbSBhcnJheSBsZWdlbmQgYW4gYXJyYXkgb2YgaW50ZWdlciwgcmVwcmVzZW50aW5nIHRoZSBkaWZmZXJlbnQgdGhyZXNob2xkIHZhbHVlXG4gICAqIEBwYXJhbSBhcnJheSBjb2xvclJhbmdlIGFuIGFycmF5IG9mIDIgaGV4IGNvbG9ycywgZm9yIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGNvbG9yc1xuICAgKi9cbiAgc2V0TGVnZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIG9sZExlZ2VuZCA9IHRoaXMub3B0aW9ucy5sZWdlbmQuc2xpY2UoMCk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gMSAmJiBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5sZWdlbmQgPSBhcmd1bWVudHNbMF07XG4gICAgfVxuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDIpIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZ3VtZW50c1sxXSkgJiYgYXJndW1lbnRzWzFdLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sZWdlbmRDb2xvcnMgPSBbYXJndW1lbnRzWzFdWzBdLCBhcmd1bWVudHNbMV1bMV1dO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmxlZ2VuZENvbG9ycyA9IGFyZ3VtZW50c1sxXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgIWFycmF5RXF1YWxzKG9sZExlZ2VuZCwgdGhpcy5vcHRpb25zLmxlZ2VuZCkpIHx8XG4gICAgICBhcmd1bWVudHMubGVuZ3RoID49IDJcbiAgICApIHtcbiAgICAgIHRoaXMuTGVnZW5kLmJ1aWxkQ29sb3JzKCk7XG4gICAgICB0aGlzLmZpbGwoKTtcbiAgICB9XG5cbiAgICB0aGlzLkxlZ2VuZC5yZWRyYXcodGhpcy5ncmFwaERpbS53aWR0aCAtIHRoaXMub3B0aW9ucy5kb21haW5HdXR0ZXIgLSB0aGlzLm9wdGlvbnMuY2VsbFBhZGRpbmcpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdGhlIGxlZ2VuZFxuICAgKlxuICAgKiBAcmV0dXJuIGJvb2wgRmFsc2UgaWYgdGhlcmUgaXMgbm8gbGVnZW5kIHRvIHJlbW92ZVxuICAgKi9cbiAgcmVtb3ZlTGVnZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKCF0aGlzLm9wdGlvbnMuZGlzcGxheUxlZ2VuZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMuZGlzcGxheUxlZ2VuZCA9IGZhbHNlO1xuICAgIHRoaXMuTGVnZW5kLnJlbW92ZSgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEaXNwbGF5IHRoZSBsZWdlbmRcbiAgICpcbiAgICogQHJldHVybiBib29sIEZhbHNlIGlmIHRoZSBsZWdlbmQgd2FzIGFscmVhZHkgZGlzcGxheWVkXG4gICAqL1xuICBzaG93TGVnZW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5kaXNwbGF5TGVnZW5kKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMub3B0aW9ucy5kaXNwbGF5TGVnZW5kID0gdHJ1ZTtcbiAgICB0aGlzLkxlZ2VuZC5yZWRyYXcodGhpcy5ncmFwaERpbS53aWR0aCAtIHRoaXMub3B0aW9ucy5kb21haW5HdXR0ZXIgLSB0aGlzLm9wdGlvbnMuY2VsbFBhZGRpbmcpO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIC8qKlxuICAgKiBIaWdobGlnaHQgZGF0ZXNcbiAgICpcbiAgICogQWRkIGEgaGlnaGxpZ2h0IGNsYXNzIHRvIGEgc2V0IG9mIGRhdGVzXG4gICAqXG4gICAqIEBzaW5jZSAgMy4zLjVcbiAgICogQHBhcmFtICBhcnJheSBBcnJheSBvZiBkYXRlcyB0byBoaWdobGlnaHRcbiAgICogQHJldHVybiBib29sIFRydWUgaWYgZGF0ZXMgd2VyZSBoaWdobGlnaHRlZFxuICAgKi9cbiAgaGlnaGxpZ2h0OiBmdW5jdGlvbiAoYXJncykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGlmICgodGhpcy5vcHRpb25zLmhpZ2hsaWdodCA9IHRoaXMuZXhwYW5kRGF0ZVNldHRpbmcoYXJncykpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuZmlsbCgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogRGVzdHJveSB0aGUgY2FsZW5kYXJcbiAgICpcbiAgICogVXNhZ2U6IGNhbCA9IGNhbC5kZXN0cm95KCk7XG4gICAqXG4gICAqIEBzaW5jZSAgMy4zLjZcbiAgICogQHBhcmFtIGZ1bmN0aW9uIEEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gdHJpZ2dlciBhZnRlciBkZXN0cm95aW5nIHRoZSBjYWxlbmRhclxuICAgKiBAcmV0dXJuIG51bGxcbiAgICovXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHRoaXMucm9vdFxuICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgLmR1cmF0aW9uKHRoaXMub3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAgIC5hdHRyKCd3aWR0aCcsIDApXG4gICAgICAuYXR0cignaGVpZ2h0JywgMClcbiAgICAgIC5yZW1vdmUoKVxuICAgICAgLmVhY2goJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm92aWRlZCBjYWxsYmFjayBmb3IgZGVzdHJveSgpIGlzIG5vdCBhIGZ1bmN0aW9uLicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIHJldHVybiBudWxsO1xuICB9LFxuXG4gIGdldFNWRzogZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBzdHlsZXMgPSB7XG4gICAgICAnLmNhbC1oZWF0bWFwLWNvbnRhaW5lcic6IHt9LFxuICAgICAgJy5ncmFwaCc6IHt9LFxuICAgICAgJy5ncmFwaC1yZWN0Jzoge30sXG4gICAgICAncmVjdC5oaWdobGlnaHQnOiB7fSxcbiAgICAgICdyZWN0Lm5vdyc6IHt9LFxuICAgICAgJ3JlY3QuaGlnaGxpZ2h0LW5vdyc6IHt9LFxuICAgICAgJ3RleHQuaGlnaGxpZ2h0Jzoge30sXG4gICAgICAndGV4dC5ub3cnOiB7fSxcbiAgICAgICd0ZXh0LmhpZ2hsaWdodC1ub3cnOiB7fSxcbiAgICAgICcuZG9tYWluLWJhY2tncm91bmQnOiB7fSxcbiAgICAgICcuZ3JhcGgtbGFiZWwnOiB7fSxcbiAgICAgICcuc3ViZG9tYWluLXRleHQnOiB7fSxcbiAgICAgICcucTAnOiB7fSxcbiAgICAgICcucWknOiB7fSxcbiAgICB9O1xuXG4gICAgZm9yICh2YXIgaiA9IDEsIHRvdGFsID0gdGhpcy5vcHRpb25zLmxlZ2VuZC5sZW5ndGggKyAxOyBqIDw9IHRvdGFsOyBqKyspIHtcbiAgICAgIHN0eWxlc1snLnEnICsgal0gPSB7fTtcbiAgICB9XG5cbiAgICB2YXIgcm9vdCA9IHRoaXMucm9vdDtcblxuICAgIHZhciB3aGl0ZWxpc3RTdHlsZXMgPSBbXG4gICAgICAvLyBTVkcgc3BlY2lmaWMgcHJvcGVydGllc1xuICAgICAgJ3N0cm9rZScsXG4gICAgICAnc3Ryb2tlLXdpZHRoJyxcbiAgICAgICdzdHJva2Utb3BhY2l0eScsXG4gICAgICAnc3Ryb2tlLWRhc2hhcnJheScsXG4gICAgICAnc3Ryb2tlLWRhc2hvZmZzZXQnLFxuICAgICAgJ3N0cm9rZS1saW5lY2FwJyxcbiAgICAgICdzdHJva2UtbWl0ZXJsaW1pdCcsXG4gICAgICAnZmlsbCcsXG4gICAgICAnZmlsbC1vcGFjaXR5JyxcbiAgICAgICdmaWxsLXJ1bGUnLFxuICAgICAgJ21hcmtlcicsXG4gICAgICAnbWFya2VyLXN0YXJ0JyxcbiAgICAgICdtYXJrZXItbWlkJyxcbiAgICAgICdtYXJrZXItZW5kJyxcbiAgICAgICdhbGlnbmVtZW50LWJhc2VsaW5lJyxcbiAgICAgICdiYXNlbGluZS1zaGlmdCcsXG4gICAgICAnZG9taW5hbnQtYmFzZWxpbmUnLFxuICAgICAgJ2dseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwnLFxuICAgICAgJ2dseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsJyxcbiAgICAgICdrZXJuaW5nJyxcbiAgICAgICd0ZXh0LWFuY2hvcicsXG4gICAgICAnc2hhcGUtcmVuZGVyaW5nJyxcblxuICAgICAgLy8gVGV4dCBTcGVjaWZpYyBwcm9wZXJ0aWVzXG4gICAgICAndGV4dC10cmFuc2Zvcm0nLFxuICAgICAgJ2ZvbnQtZmFtaWx5JyxcbiAgICAgICdmb250JyxcbiAgICAgICdmb250LXNpemUnLFxuICAgICAgJ2ZvbnQtd2VpZ2h0JyxcbiAgICBdO1xuXG4gICAgdmFyIGZpbHRlclN0eWxlcyA9IGZ1bmN0aW9uIChhdHRyaWJ1dGUsIHByb3BlcnR5LCB2YWx1ZSkge1xuICAgICAgaWYgKHdoaXRlbGlzdFN0eWxlcy5pbmRleE9mKHByb3BlcnR5KSAhPT0gLTEpIHtcbiAgICAgICAgc3R5bGVzW2F0dHJpYnV0ZV1bcHJvcGVydHldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBnZXRFbGVtZW50ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiByb290LnNlbGVjdChlKVswXVswXTtcbiAgICB9O1xuXG4gICAgLyoganNoaW50IGZvcmluOmZhbHNlICovXG4gICAgZm9yICh2YXIgZWxlbWVudCBpbiBzdHlsZXMpIHtcbiAgICAgIGlmICghc3R5bGVzLmhhc093blByb3BlcnR5KGVsZW1lbnQpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgZG9tID0gZ2V0RWxlbWVudChlbGVtZW50KTtcblxuICAgICAgaWYgKGRvbSA9PT0gbnVsbCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gVGhlIERPTSBMZXZlbCAyIENTUyB3YXlcbiAgICAgIC8qIGpzaGludCBtYXhkZXB0aDogZmFsc2UgKi9cbiAgICAgIGlmICgnZ2V0Q29tcHV0ZWRTdHlsZScgaW4gd2luZG93KSB7XG4gICAgICAgIHZhciBjcyA9IGdldENvbXB1dGVkU3R5bGUoZG9tLCBudWxsKTtcbiAgICAgICAgaWYgKGNzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZpbHRlclN0eWxlcyhlbGVtZW50LCBjcy5pdGVtKGkpLCBjcy5nZXRQcm9wZXJ0eVZhbHVlKGNzLml0ZW0oaSkpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBPcGVyYSB3b3JrYXJvdW5kLiBPcGVyYSBkb2VzblwidCBzdXBwb3J0IGBpdGVtYC9gbGVuZ3RoYFxuICAgICAgICAgIC8vIG9uIENTU1N0eWxlRGVjbGFyYXRpb24uXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yICh2YXIgayBpbiBjcykge1xuICAgICAgICAgICAgaWYgKGNzLmhhc093blByb3BlcnR5KGspKSB7XG4gICAgICAgICAgICAgIGZpbHRlclN0eWxlcyhlbGVtZW50LCBrLCBjc1trXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlIElFIHdheVxuICAgICAgfSBlbHNlIGlmICgnY3VycmVudFN0eWxlJyBpbiBkb20pIHtcbiAgICAgICAgdmFyIGNzcyA9IGRvbS5jdXJyZW50U3R5bGU7XG4gICAgICAgIGZvciAodmFyIHAgaW4gY3NzKSB7XG4gICAgICAgICAgZmlsdGVyU3R5bGVzKGVsZW1lbnQsIHAsIGNzc1twXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgc3RyaW5nID1cbiAgICAgICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiAnICtcbiAgICAgICd4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIj48c3R5bGUgdHlwZT1cInRleHQvY3NzXCI+PCFbQ0RBVEFbICc7XG5cbiAgICBmb3IgKHZhciBzdHlsZSBpbiBzdHlsZXMpIHtcbiAgICAgIHN0cmluZyArPSBzdHlsZSArICcge1xcbic7XG4gICAgICBmb3IgKHZhciBsIGluIHN0eWxlc1tzdHlsZV0pIHtcbiAgICAgICAgc3RyaW5nICs9ICdcXHQnICsgbCArICc6JyArIHN0eWxlc1tzdHlsZV1bbF0gKyAnO1xcbic7XG4gICAgICB9XG4gICAgICBzdHJpbmcgKz0gJ31cXG4nO1xuICAgIH1cblxuICAgIHN0cmluZyArPSAnXV0+PC9zdHlsZT4nO1xuICAgIHN0cmluZyArPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHRoaXMucm9vdFswXVswXSk7XG4gICAgc3RyaW5nICs9ICc8L3N2Zz4nO1xuXG4gICAgcmV0dXJuIHN0cmluZztcbiAgfSxcbn07XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuLy8gRE9NQUlOIFBPU0lUSU9OIENPTVBVVEFUSU9OICAgICAgICAgICAgICAgICAgICAgICAgLy9cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4vKipcbiAqIENvbXB1dGUgdGhlIHBvc2l0aW9uIG9mIGEgZG9tYWluLCByZWxhdGl2ZSB0byB0aGUgY2FsZW5kYXJcbiAqL1xudmFyIERvbWFpblBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdGhpcy5wb3NpdGlvbnMgPSBkMy5tYXAoKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChkKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICByZXR1cm4gdGhpcy5wb3NpdGlvbnMuZ2V0KGQpO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLmdldFBvc2l0aW9uRnJvbUluZGV4ID0gZnVuY3Rpb24gKGkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBkb21haW5zID0gdGhpcy5nZXRLZXlzKCk7XG4gIHJldHVybiB0aGlzLnBvc2l0aW9ucy5nZXQoZG9tYWluc1tpXSk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuZ2V0TGFzdCA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBkb21haW5zID0gdGhpcy5nZXRLZXlzKCk7XG4gIHJldHVybiB0aGlzLnBvc2l0aW9ucy5nZXQoZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5zZXRQb3NpdGlvbiA9IGZ1bmN0aW9uIChkLCBkaW0pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMucG9zaXRpb25zLnNldChkLCBkaW0pO1xufTtcblxuRG9tYWluUG9zaXRpb24ucHJvdG90eXBlLnNoaWZ0UmlnaHRCeSA9IGZ1bmN0aW9uIChleGl0aW5nRG9tYWluRGltKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB0aGlzLnBvc2l0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgdGhpcy5zZXQoa2V5LCB2YWx1ZSAtIGV4aXRpbmdEb21haW5EaW0pO1xuICB9KTtcblxuICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0S2V5cygpO1xuICB0aGlzLnBvc2l0aW9ucy5yZW1vdmUoZG9tYWluc1swXSk7XG59O1xuXG5Eb21haW5Qb3NpdGlvbi5wcm90b3R5cGUuc2hpZnRMZWZ0QnkgPSBmdW5jdGlvbiAoZW50ZXJpbmdEb21haW5EaW0pIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMucG9zaXRpb25zLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICB0aGlzLnNldChrZXksIHZhbHVlICsgZW50ZXJpbmdEb21haW5EaW0pO1xuICB9KTtcblxuICB2YXIgZG9tYWlucyA9IHRoaXMuZ2V0S2V5cygpO1xuICB0aGlzLnBvc2l0aW9ucy5yZW1vdmUoZG9tYWluc1tkb21haW5zLmxlbmd0aCAtIDFdKTtcbn07XG5cbkRvbWFpblBvc2l0aW9uLnByb3RvdHlwZS5nZXRLZXlzID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmtleXMoKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIHBhcnNlSW50KGEsIDEwKSAtIHBhcnNlSW50KGIsIDEwKTtcbiAgfSk7XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbi8vIExFR0VORCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbnZhciBMZWdlbmQgPSBmdW5jdGlvbiAoY2FsZW5kYXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMuY2FsZW5kYXIgPSBjYWxlbmRhcjtcbiAgdGhpcy5jb21wdXRlRGltKCk7XG5cbiAgaWYgKGNhbGVuZGFyLm9wdGlvbnMubGVnZW5kQ29sb3JzICE9PSBudWxsKSB7XG4gICAgdGhpcy5idWlsZENvbG9ycygpO1xuICB9XG59O1xuXG5MZWdlbmQucHJvdG90eXBlLmNvbXB1dGVEaW0gPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgb3B0aW9ucyA9IHRoaXMuY2FsZW5kYXIub3B0aW9uczsgLy8gU2hvcnRlciBhY2Nlc3NvciBmb3IgdmFyaWFibGUgbmFtZSBtYW5nbGluZyB3aGVuIG1pbmlmeWluZ1xuICB0aGlzLmRpbSA9IHtcbiAgICB3aWR0aDpcbiAgICAgIG9wdGlvbnMubGVnZW5kQ2VsbFNpemUgKiAob3B0aW9ucy5sZWdlbmQubGVuZ3RoICsgMSkgK1xuICAgICAgb3B0aW9ucy5sZWdlbmRDZWxsUGFkZGluZyAqIG9wdGlvbnMubGVnZW5kLmxlbmd0aCxcbiAgICBoZWlnaHQ6IG9wdGlvbnMubGVnZW5kQ2VsbFNpemUsXG4gIH07XG59O1xuXG5MZWdlbmQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHRoaXMuY2FsZW5kYXIucm9vdC5zZWxlY3QoJy5ncmFwaC1sZWdlbmQnKS5yZW1vdmUoKTtcbiAgdGhpcy5jYWxlbmRhci5yZXNpemUoKTtcbn07XG5cbkxlZ2VuZC5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKHdpZHRoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBpZiAoIXRoaXMuY2FsZW5kYXIub3B0aW9ucy5kaXNwbGF5TGVnZW5kKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgdmFyIHBhcmVudCA9IHRoaXM7XG4gIHZhciBjYWxlbmRhciA9IHRoaXMuY2FsZW5kYXI7XG4gIHZhciBsZWdlbmQgPSBjYWxlbmRhci5yb290O1xuICB2YXIgbGVnZW5kSXRlbTtcbiAgdmFyIG9wdGlvbnMgPSBjYWxlbmRhci5vcHRpb25zOyAvLyBTaG9ydGVyIGFjY2Vzc29yIGZvciB2YXJpYWJsZSBuYW1lIG1hbmdsaW5nIHdoZW4gbWluaWZ5aW5nXG5cbiAgdGhpcy5jb21wdXRlRGltKCk7XG5cbiAgdmFyIF9sZWdlbmQgPSBvcHRpb25zLmxlZ2VuZC5zbGljZSgwKTtcbiAgX2xlZ2VuZC5wdXNoKF9sZWdlbmRbX2xlZ2VuZC5sZW5ndGggLSAxXSArIDEpO1xuXG4gIHZhciBsZWdlbmRFbGVtZW50ID0gY2FsZW5kYXIucm9vdC5zZWxlY3QoJy5ncmFwaC1sZWdlbmQnKTtcbiAgaWYgKGxlZ2VuZEVsZW1lbnRbMF1bMF0gIT09IG51bGwpIHtcbiAgICBsZWdlbmQgPSBsZWdlbmRFbGVtZW50O1xuICAgIGxlZ2VuZEl0ZW0gPSBsZWdlbmQuc2VsZWN0KCdnJykuc2VsZWN0QWxsKCdyZWN0JykuZGF0YShfbGVnZW5kKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBDcmVhdGluZyB0aGUgbmV3IGxlZ2VuZCBET00gaWYgaXQgZG9lc24ndCBhbHJlYWR5IGV4aXN0XG4gICAgbGVnZW5kID1cbiAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ3RvcCdcbiAgICAgICAgPyBsZWdlbmQuaW5zZXJ0KCdzdmcnLCAnLmdyYXBoJylcbiAgICAgICAgOiBsZWdlbmQuYXBwZW5kKCdzdmcnKTtcblxuICAgIGxlZ2VuZC5hdHRyKCd4JywgZ2V0TGVnZW5kWFBvc2l0aW9uKCkpLmF0dHIoJ3knLCBnZXRMZWdlbmRZUG9zaXRpb24oKSk7XG5cbiAgICBsZWdlbmRJdGVtID0gbGVnZW5kXG4gICAgICAuYXR0cignY2xhc3MnLCAnZ3JhcGgtbGVnZW5kJylcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBwYXJlbnQuZ2V0RGltKCdoZWlnaHQnKSlcbiAgICAgIC5hdHRyKCd3aWR0aCcsIHBhcmVudC5nZXREaW0oJ3dpZHRoJykpXG4gICAgICAuYXBwZW5kKCdnJylcbiAgICAgIC5zZWxlY3RBbGwoKVxuICAgICAgLmRhdGEoX2xlZ2VuZCk7XG4gIH1cblxuICBsZWdlbmRJdGVtXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuY2FsbChsZWdlbmRDZWxsTGF5b3V0KVxuICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChkKSB7XG4gICAgICByZXR1cm4gY2FsZW5kYXIuTGVnZW5kLmdldENsYXNzKGQsIGNhbGVuZGFyLmxlZ2VuZFNjYWxlID09PSBudWxsKTtcbiAgICB9KVxuICAgIC5hdHRyKCdmaWxsLW9wYWNpdHknLCAwKVxuICAgIC5jYWxsKGZ1bmN0aW9uIChzZWxlY3Rpb24pIHtcbiAgICAgIGlmIChcbiAgICAgICAgY2FsZW5kYXIubGVnZW5kU2NhbGUgIT09IG51bGwgJiZcbiAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMgIT09IG51bGwgJiZcbiAgICAgICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMuaGFzT3duUHJvcGVydHkoJ2Jhc2UnKVxuICAgICAgKSB7XG4gICAgICAgIHNlbGVjdGlvbi5hdHRyKCdmaWxsJywgb3B0aW9ucy5sZWdlbmRDb2xvcnMuYmFzZSk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuYXBwZW5kKCd0aXRsZScpO1xuXG4gIGxlZ2VuZEl0ZW1cbiAgICAuZXhpdCgpXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kdXJhdGlvbihvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKVxuICAgIC5hdHRyKCdmaWxsLW9wYWNpdHknLCAwKVxuICAgIC5yZW1vdmUoKTtcblxuICBsZWdlbmRJdGVtXG4gICAgLnRyYW5zaXRpb24oKVxuICAgIC5kZWxheShmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgcmV0dXJuIChvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uICogaSkgLyAxMDtcbiAgICB9KVxuICAgIC5jYWxsKGxlZ2VuZENlbGxMYXlvdXQpXG4gICAgLmF0dHIoJ2ZpbGwtb3BhY2l0eScsIDEpXG4gICAgLmNhbGwoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQuYXR0cignZmlsbCcsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgIGlmIChjYWxlbmRhci5sZWdlbmRTY2FsZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGVuZGFyLmxlZ2VuZFNjYWxlKGQgLSAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2FsZW5kYXIubGVnZW5kU2NhbGUob3B0aW9ucy5sZWdlbmRbaSAtIDFdKTtcbiAgICAgIH0pO1xuXG4gICAgICBlbGVtZW50LmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgcmV0dXJuIGNhbGVuZGFyLkxlZ2VuZC5nZXRDbGFzcyhkLCBjYWxlbmRhci5sZWdlbmRTY2FsZSA9PT0gbnVsbCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICBmdW5jdGlvbiBsZWdlbmRDZWxsTGF5b3V0KHNlbGVjdGlvbikge1xuICAgIHNlbGVjdGlvblxuICAgICAgLmF0dHIoJ3dpZHRoJywgb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSlcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBvcHRpb25zLmxlZ2VuZENlbGxTaXplKVxuICAgICAgLmF0dHIoJ3J4Jywgb3B0aW9ucy5sZWdlbmRDZWxsUmFkaXVzKVxuICAgICAgLmF0dHIoJ3J5Jywgb3B0aW9ucy5sZWdlbmRDZWxsUmFkaXVzKVxuICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbiAoZCwgaSkge1xuICAgICAgICByZXR1cm4gaSAqIChvcHRpb25zLmxlZ2VuZENlbGxTaXplICsgb3B0aW9ucy5sZWdlbmRDZWxsUGFkZGluZyk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGxlZ2VuZEl0ZW0uc2VsZWN0KCd0aXRsZScpLnRleHQoZnVuY3Rpb24gKGQsIGkpIHtcbiAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLmZvcm1hdFN0cmluZ1dpdGhPYmplY3Qob3B0aW9ucy5sZWdlbmRUaXRsZUZvcm1hdC5sb3dlciwge1xuICAgICAgICBtaW46IG9wdGlvbnMubGVnZW5kW2ldLFxuICAgICAgICBuYW1lOiBvcHRpb25zLml0ZW1OYW1lWzFdLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChpID09PSBfbGVnZW5kLmxlbmd0aCAtIDEpIHtcbiAgICAgIHJldHVybiBjYWxlbmRhci5mb3JtYXRTdHJpbmdXaXRoT2JqZWN0KG9wdGlvbnMubGVnZW5kVGl0bGVGb3JtYXQudXBwZXIsIHtcbiAgICAgICAgbWF4OiBvcHRpb25zLmxlZ2VuZFtpIC0gMV0sXG4gICAgICAgIG5hbWU6IG9wdGlvbnMuaXRlbU5hbWVbMV0sXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGNhbGVuZGFyLmZvcm1hdFN0cmluZ1dpdGhPYmplY3Qob3B0aW9ucy5sZWdlbmRUaXRsZUZvcm1hdC5pbm5lciwge1xuICAgICAgICBkb3duOiBvcHRpb25zLmxlZ2VuZFtpIC0gMV0sXG4gICAgICAgIHVwOiBvcHRpb25zLmxlZ2VuZFtpXSxcbiAgICAgICAgbmFtZTogb3B0aW9ucy5pdGVtTmFtZVsxXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIGxlZ2VuZEl0ZW1cbiAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uIChkKSB7XG4gICAgICBjYWxlbmRhci5sZWdlbmRUaXAuc2hvdyhkLCB0aGlzKTtcbiAgICB9KVxuICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjYWxlbmRhci5sZWdlbmRUaXAuaGlkZSgpO1xuICAgIH0pO1xuXG4gIGxlZ2VuZFxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAuYXR0cigneCcsIGdldExlZ2VuZFhQb3NpdGlvbigpKVxuICAgIC5hdHRyKCd5JywgZ2V0TGVnZW5kWVBvc2l0aW9uKCkpXG4gICAgLmF0dHIoJ3dpZHRoJywgcGFyZW50LmdldERpbSgnd2lkdGgnKSlcbiAgICAuYXR0cignaGVpZ2h0JywgcGFyZW50LmdldERpbSgnaGVpZ2h0JykpO1xuXG4gIGxlZ2VuZFxuICAgIC5zZWxlY3QoJ2cnKVxuICAgIC50cmFuc2l0aW9uKClcbiAgICAuZHVyYXRpb24ob3B0aW9ucy5hbmltYXRpb25EdXJhdGlvbilcbiAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKG9wdGlvbnMubGVnZW5kT3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgcmV0dXJuICdyb3RhdGUoOTAgJyArIG9wdGlvbnMubGVnZW5kQ2VsbFNpemUgLyAyICsgJyAnICsgb3B0aW9ucy5sZWdlbmRDZWxsU2l6ZSAvIDIgKyAnKSc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJyc7XG4gICAgfSk7XG5cbiAgZnVuY3Rpb24gZ2V0TGVnZW5kWFBvc2l0aW9uKCkge1xuICAgIHN3aXRjaCAob3B0aW9ucy5sZWdlbmRIb3Jpem9udGFsUG9zaXRpb24pIHtcbiAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9wdGlvbnMubGVnZW5kVmVydGljYWxQb3NpdGlvbiA9PT0gJ2NlbnRlcicgfHxcbiAgICAgICAgICBvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdtaWRkbGUnXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiB3aWR0aCArIG9wdGlvbnMubGVnZW5kTWFyZ2luWzNdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3aWR0aCAtIHBhcmVudC5nZXREaW0oJ3dpZHRoJykgLSBvcHRpb25zLmxlZ2VuZE1hcmdpblsxXTtcbiAgICAgIGNhc2UgJ21pZGRsZSc6XG4gICAgICBjYXNlICdjZW50ZXInOlxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh3aWR0aCAvIDIgLSBwYXJlbnQuZ2V0RGltKCd3aWR0aCcpIC8gMik7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gb3B0aW9ucy5sZWdlbmRNYXJnaW5bM107XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TGVnZW5kWVBvc2l0aW9uKCkge1xuICAgIGlmIChvcHRpb25zLmxlZ2VuZFZlcnRpY2FsUG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBjYWxlbmRhci5ncmFwaERpbS5oZWlnaHQgK1xuICAgICAgICBvcHRpb25zLmxlZ2VuZE1hcmdpblswXSAtXG4gICAgICAgIG9wdGlvbnMuZG9tYWluR3V0dGVyIC1cbiAgICAgICAgb3B0aW9ucy5jZWxsUGFkZGluZ1xuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG9wdGlvbnMubGVnZW5kTWFyZ2luWzBdO1xuICB9XG5cbiAgY2FsZW5kYXIucmVzaXplKCk7XG59O1xuXG4vKipcbiAqIFJldHVybiB0aGUgZGltZW5zaW9uIG9mIHRoZSBsZWdlbmRcbiAqXG4gKiBUYWtlcyBpbnRvIGFjY291bnQgcm90YXRpb25cbiAqXG4gKiBAcGFyYW0gIHN0cmluZyBheGlzIFdpZHRoIG9yIGhlaWdodFxuICogQHJldHVybiBpbnQgaGVpZ2h0IG9yIHdpZHRoIGluIHBpeGVsc1xuICovXG5MZWdlbmQucHJvdG90eXBlLmdldERpbSA9IGZ1bmN0aW9uIChheGlzKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgaXNIb3Jpem9udGFsID0gdGhpcy5jYWxlbmRhci5vcHRpb25zLmxlZ2VuZE9yaWVudGF0aW9uID09PSAnaG9yaXpvbnRhbCc7XG5cbiAgc3dpdGNoIChheGlzKSB7XG4gICAgY2FzZSAnd2lkdGgnOlxuICAgICAgcmV0dXJuIHRoaXMuZGltW2lzSG9yaXpvbnRhbCA/ICd3aWR0aCcgOiAnaGVpZ2h0J107XG4gICAgY2FzZSAnaGVpZ2h0JzpcbiAgICAgIHJldHVybiB0aGlzLmRpbVtpc0hvcml6b250YWwgPyAnaGVpZ2h0JyA6ICd3aWR0aCddO1xuICB9XG59O1xuXG5MZWdlbmQucHJvdG90eXBlLmJ1aWxkQ29sb3JzID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG9wdGlvbnMgPSB0aGlzLmNhbGVuZGFyLm9wdGlvbnM7IC8vIFNob3J0ZXIgYWNjZXNzb3IgZm9yIHZhcmlhYmxlIG5hbWUgbWFuZ2xpbmcgd2hlbiBtaW5pZnlpbmdcblxuICBpZiAob3B0aW9ucy5sZWdlbmRDb2xvcnMgPT09IG51bGwpIHtcbiAgICB0aGlzLmNhbGVuZGFyLmxlZ2VuZFNjYWxlID0gbnVsbDtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB2YXIgX2NvbG9yUmFuZ2UgPSBbXTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShvcHRpb25zLmxlZ2VuZENvbG9ycykpIHtcbiAgICBfY29sb3JSYW5nZSA9IG9wdGlvbnMubGVnZW5kQ29sb3JzO1xuICB9IGVsc2UgaWYgKFxuICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdtaW4nKSAmJlxuICAgIG9wdGlvbnMubGVnZW5kQ29sb3JzLmhhc093blByb3BlcnR5KCdtYXgnKVxuICApIHtcbiAgICBfY29sb3JSYW5nZSA9IFtvcHRpb25zLmxlZ2VuZENvbG9ycy5taW4sIG9wdGlvbnMubGVnZW5kQ29sb3JzLm1heF07XG4gIH0gZWxzZSB7XG4gICAgb3B0aW9ucy5sZWdlbmRDb2xvcnMgPSBudWxsO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciBfbGVnZW5kID0gb3B0aW9ucy5sZWdlbmQuc2xpY2UoMCk7XG5cbiAgaWYgKF9sZWdlbmRbMF0gPiAwKSB7XG4gICAgX2xlZ2VuZC51bnNoaWZ0KDApO1xuICB9IGVsc2UgaWYgKF9sZWdlbmRbMF0gPD0gMCkge1xuICAgIC8vIExldCdzIGd1ZXNzIHRoZSBsZWZ0bW9zdCB2YWx1ZSwgaXQgd2UgaGF2ZSB0byBhZGQgb25lXG4gICAgX2xlZ2VuZC51bnNoaWZ0KF9sZWdlbmRbMF0gLSAoX2xlZ2VuZFtfbGVnZW5kLmxlbmd0aCAtIDFdIC0gX2xlZ2VuZFswXSkgLyBfbGVnZW5kLmxlbmd0aCk7XG4gIH1cbiAgdmFyIGNvbG9yU2NhbGU7XG4gIGlmIChvcHRpb25zLmxlZ2VuZENvbG9ycy5oYXNPd25Qcm9wZXJ0eSgnY29sb3JTY2FsZScpKSB7XG4gICAgY29sb3JTY2FsZSA9IG9wdGlvbnMubGVnZW5kQ29sb3JzLmNvbG9yU2NhbGU7XG4gIH0gZWxzZSB7XG4gICAgY29sb3JTY2FsZSA9IGQzLnNjYWxlXG4gICAgICAubGluZWFyKClcbiAgICAgIC5yYW5nZShfY29sb3JSYW5nZSlcbiAgICAgIC5pbnRlcnBvbGF0ZShkMy5pbnRlcnBvbGF0ZUhjbClcbiAgICAgIC5kb21haW4oW2QzLm1pbihfbGVnZW5kKSwgZDMubWF4KF9sZWdlbmQpXSk7XG4gIH1cblxuICB2YXIgbGVnZW5kQ29sb3JzID0gX2xlZ2VuZC5tYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gY29sb3JTY2FsZShlbGVtZW50KTtcbiAgfSk7XG4gIHRoaXMuY2FsZW5kYXIubGVnZW5kU2NhbGUgPSBkMy5zY2FsZS50aHJlc2hvbGQoKS5kb21haW4ob3B0aW9ucy5sZWdlbmQpLnJhbmdlKGxlZ2VuZENvbG9ycyk7XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKipcbiAqIFJldHVybiB0aGUgY2xhc3NuYW1lIG9uIHRoZSBsZWdlbmQgZm9yIHRoZSBzcGVjaWZpZWQgdmFsdWVcbiAqXG4gKiBAcGFyYW0gaW50ZWdlciBuIFZhbHVlIGFzc29jaWF0ZWQgdG8gYSBkYXRlXG4gKiBAcGFyYW0gYm9vbCB3aXRoQ3NzQ2xhc3MgV2hldGhlciB0byBkaXNwbGF5IHRoZSBjc3MgY2xhc3MgdXNlZCB0byBzdHlsZSB0aGUgY2VsbC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBEaXNhYmxpbmcgd2lsbCBhbGxvdyBzdHlsaW5nIGRpcmVjdGx5IHZpYSBodG1sIGZpbGwgYXR0cmlidXRlXG4gKlxuICogQHJldHVybiBzdHJpbmcgQ2xhc3NuYW1lIGFjY29yZGluZyB0byB0aGUgbGVnZW5kXG4gKi9cbkxlZ2VuZC5wcm90b3R5cGUuZ2V0Q2xhc3MgPSBmdW5jdGlvbiAobiwgd2l0aENzc0NsYXNzKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBpZiAobiA9PT0gbnVsbCB8fCBpc05hTihuKSkge1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIHZhciBpbmRleCA9IFt0aGlzLmNhbGVuZGFyLm9wdGlvbnMubGVnZW5kLmxlbmd0aCArIDFdO1xuXG4gIGZvciAodmFyIGkgPSAwLCB0b3RhbCA9IHRoaXMuY2FsZW5kYXIub3B0aW9ucy5sZWdlbmQubGVuZ3RoIC0gMTsgaSA8PSB0b3RhbDsgaSsrKSB7XG4gICAgaWYgKHRoaXMuY2FsZW5kYXIub3B0aW9ucy5sZWdlbmRbMF0gPiAwICYmIG4gPCAwKSB7XG4gICAgICBpbmRleCA9IFsnMScsICdpJ107XG4gICAgICBicmVhaztcbiAgICB9XG5cbiAgICBpZiAobiA8PSB0aGlzLmNhbGVuZGFyLm9wdGlvbnMubGVnZW5kW2ldKSB7XG4gICAgICBpbmRleCA9IFtpICsgMV07XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBpZiAobiA9PT0gMCkge1xuICAgIGluZGV4LnB1c2goMCk7XG4gIH1cblxuICBpbmRleC51bnNoaWZ0KCcnKTtcbiAgcmV0dXJuIChpbmRleC5qb2luKCcgcicpICsgKHdpdGhDc3NDbGFzcyA/IGluZGV4LmpvaW4oJyBxJykgOiAnJykpLnRyaW0oKTtcbn07XG5cbi8qKlxuICogI3NvdXJjZSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zODMyNDUvODA1NjQ5XG4gKi9cbmZ1bmN0aW9uIG1lcmdlUmVjdXJzaXZlKG9iajEsIG9iajIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qanNoaW50IGZvcmluOmZhbHNlICovXG4gIGZvciAodmFyIHAgaW4gb2JqMikge1xuICAgIHRyeSB7XG4gICAgICAvLyBQcm9wZXJ0eSBpbiBkZXN0aW5hdGlvbiBvYmplY3Qgc2V0OyB1cGRhdGUgaXRzIHZhbHVlLlxuICAgICAgaWYgKG9iajJbcF0uY29uc3RydWN0b3IgPT09IE9iamVjdCkge1xuICAgICAgICBvYmoxW3BdID0gbWVyZ2VSZWN1cnNpdmUob2JqMVtwXSwgb2JqMltwXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmoxW3BdID0gb2JqMltwXTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBQcm9wZXJ0eSBpbiBkZXN0aW5hdGlvbiBvYmplY3Qgbm90IHNldDsgY3JlYXRlIGl0IGFuZCBzZXQgaXRzIHZhbHVlLlxuICAgICAgb2JqMVtwXSA9IG9iajJbcF07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG9iajE7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgMiBhcnJheXMgYXJlIGVxdWFsc1xuICpcbiAqIEBsaW5rIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE0ODUzOTc0LzgwNTY0OVxuICogQHBhcmFtICBhcnJheSBhcnJheSB0aGUgYXJyYXkgdG8gY29tcGFyZSB0b1xuICogQHJldHVybiBib29sIHRydWUgb2YgdGhlIDIgYXJyYXlzIGFyZSBlcXVhbHNcbiAqL1xuZnVuY3Rpb24gYXJyYXlFcXVhbHMoYXJyYXlBLCBhcnJheUIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8vIGlmIHRoZSBvdGhlciBhcnJheSBpcyBhIGZhbHN5IHZhbHVlLCByZXR1cm5cbiAgaWYgKCFhcnJheUIgfHwgIWFycmF5QSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIGNvbXBhcmUgbGVuZ3RocyAtIGNhbiBzYXZlIGEgbG90IG9mIHRpbWVcbiAgaWYgKGFycmF5QS5sZW5ndGggIT09IGFycmF5Qi5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5QS5sZW5ndGg7IGkrKykge1xuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgbmVzdGVkIGFycmF5c1xuICAgIGlmIChhcnJheUFbaV0gaW5zdGFuY2VvZiBBcnJheSAmJiBhcnJheUJbaV0gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgLy8gcmVjdXJzZSBpbnRvIHRoZSBuZXN0ZWQgYXJyYXlzXG4gICAgICBpZiAoIWFycmF5RXF1YWxzKGFycmF5QVtpXSwgYXJyYXlCW2ldKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhcnJheUFbaV0gIT09IGFycmF5QltpXSkge1xuICAgICAgLy8gV2FybmluZyAtIHR3byBkaWZmZXJlbnQgb2JqZWN0IGluc3RhbmNlcyB3aWxsIG5ldmVyIGJlIGVxdWFsOiB7eDoyMH0gIT0ge3g6MjB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgZGVmYXVsdCBDYWxIZWF0TWFwO1xuIiwiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGV4dGVudCBhcyBkM0V4dGVudCwgcmFuZ2UgYXMgZDNSYW5nZSB9IGZyb20gJ2QzLWFycmF5JztcbmltcG9ydCB7IHNlbGVjdCBhcyBkM1NlbGVjdCB9IGZyb20gJ2QzLXNlbGVjdGlvbic7XG5pbXBvcnQge1xuICBnZXROdW1iZXJGb3JtYXR0ZXIsXG4gIGdldFRpbWVGb3JtYXR0ZXIsXG4gIGdldFNlcXVlbnRpYWxTY2hlbWVSZWdpc3RyeSxcbn0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IENhbEhlYXRNYXAgZnJvbSAnLi92ZW5kb3IvY2FsLWhlYXRtYXAnO1xuaW1wb3J0ICcuL3ZlbmRvci9jYWwtaGVhdG1hcC5jc3MnO1xuXG5mdW5jdGlvbiBjb252ZXJ0VVRDKGR0dG0pIHtcbiAgcmV0dXJuIG5ldyBEYXRlKFxuICAgIGR0dG0uZ2V0VVRDRnVsbFllYXIoKSxcbiAgICBkdHRtLmdldFVUQ01vbnRoKCksXG4gICAgZHR0bS5nZXRVVENEYXRlKCksXG4gICAgZHR0bS5nZXRVVENIb3VycygpLFxuICAgIGR0dG0uZ2V0VVRDTWludXRlcygpLFxuICAgIGR0dG0uZ2V0VVRDU2Vjb25kcygpLFxuICApO1xufVxuXG5jb25zdCBjb252ZXJ0VVRDVFMgPSB1dHMgPT4gY29udmVydFVUQyhuZXcgRGF0ZSh1dHMpKS5nZXRUaW1lKCk7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgZGF0YTogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAvLyBPYmplY3QgaGFzaGVkIGJ5IG1ldHJpYyBuYW1lLFxuICAgIC8vIHRoZW4gaGFzaGVkIGJ5IHRpbWVzdGFtcCAoaW4gc2Vjb25kcywgbm90IG1pbGxpc2Vjb25kcykgYXMgZmxvYXRcbiAgICAvLyB0aGUgaW5uZXJtb3N0IHZhbHVlIGlzIGNvdW50XG4gICAgLy8gZS5nLiB7IGNvdW50X2Rpc3RpbmN0X3NvbWV0aGluZzogeyAxNTM1MDM0MjM2LjA6IDMgfSB9XG4gICAgZGF0YTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBkb21haW46IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcmFuZ2U6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLy8gdGltZXN0YW1wIGluIG1pbGxpc2Vjb25kc1xuICAgIHN0YXJ0OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHN1YmRvbWFpbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgfSksXG4gIGhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3NvcnQtcHJvcC10eXBlc1xuICBjZWxsUGFkZGluZzogUHJvcFR5cGVzLm51bWJlcixcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L3NvcnQtcHJvcC10eXBlc1xuICBjZWxsUmFkaXVzOiBQcm9wVHlwZXMubnVtYmVyLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3Qvc29ydC1wcm9wLXR5cGVzXG4gIGNlbGxTaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuICBsaW5lYXJDb2xvclNjaGVtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2hvd0xlZ2VuZDogUHJvcFR5cGVzLmJvb2wsXG4gIHNob3dNZXRyaWNOYW1lOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2hvd1ZhbHVlczogUHJvcFR5cGVzLmJvb2wsXG4gIHN0ZXBzOiBQcm9wVHlwZXMubnVtYmVyLFxuICB0aW1lRm9ybWF0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2YWx1ZUZvcm1hdDogUHJvcFR5cGVzLnN0cmluZyxcbiAgdmVyYm9zZU1hcDogUHJvcFR5cGVzLm9iamVjdCxcbn07XG5cbmZ1bmN0aW9uIENhbGVuZGFyKGVsZW1lbnQsIHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBkYXRhLFxuICAgIGhlaWdodCxcbiAgICBjZWxsUGFkZGluZyA9IDMsXG4gICAgY2VsbFJhZGl1cyA9IDAsXG4gICAgY2VsbFNpemUgPSAxMCxcbiAgICBkb21haW5HcmFudWxhcml0eSxcbiAgICBsaW5lYXJDb2xvclNjaGVtZSxcbiAgICBzaG93TGVnZW5kLFxuICAgIHNob3dNZXRyaWNOYW1lLFxuICAgIHNob3dWYWx1ZXMsXG4gICAgc3RlcHMsXG4gICAgc3ViZG9tYWluR3JhbnVsYXJpdHksXG4gICAgdGltZUZvcm1hdCxcbiAgICB2YWx1ZUZvcm1hdCxcbiAgICB2ZXJib3NlTWFwLFxuICB9ID0gcHJvcHM7XG5cbiAgY29uc3QgdmFsdWVGb3JtYXR0ZXIgPSBnZXROdW1iZXJGb3JtYXR0ZXIodmFsdWVGb3JtYXQpO1xuICBjb25zdCB0aW1lRm9ybWF0dGVyID0gZ2V0VGltZUZvcm1hdHRlcih0aW1lRm9ybWF0KTtcblxuICBjb25zdCBjb250YWluZXIgPSBkM1NlbGVjdChlbGVtZW50KVxuICAgIC5jbGFzc2VkKCdzdXBlcnNldC1sZWdhY3ktY2hhcnQtY2FsZW5kYXInLCB0cnVlKVxuICAgIC5zdHlsZSgnaGVpZ2h0JywgaGVpZ2h0KTtcbiAgY29udGFpbmVyLnNlbGVjdEFsbCgnKicpLnJlbW92ZSgpO1xuICBjb25zdCBkaXYgPSBjb250YWluZXIuYXBwZW5kKCdkaXYnKTtcblxuICBjb25zdCBzdWJEb21haW5UZXh0Rm9ybWF0ID0gc2hvd1ZhbHVlcyA/IChkYXRlLCB2YWx1ZSkgPT4gdmFsdWVGb3JtYXR0ZXIodmFsdWUpIDogbnVsbDtcblxuICAvLyBUcmljayB0byBjb252ZXJ0IGFsbCB0aW1lc3RhbXBzIHRvIFVUQ1xuICAvLyBUT0RPOiBWZXJpZnkgaWYgdGhpcyBjb252ZXJzaW9uIGlzIHJlYWxseSBuZWNlc3NhcnlcbiAgLy8gc2luY2UgYWxsIHRpbWVzdGFtcHMgc2hvdWxkIGFsd2F5cyBiZSBpbiBVVEMuXG4gIGNvbnN0IG1ldHJpY3NEYXRhID0ge307XG4gIE9iamVjdC5rZXlzKGRhdGEuZGF0YSkuZm9yRWFjaChtZXRyaWMgPT4ge1xuICAgIG1ldHJpY3NEYXRhW21ldHJpY10gPSB7fTtcbiAgICBPYmplY3Qua2V5cyhkYXRhLmRhdGFbbWV0cmljXSkuZm9yRWFjaCh0cyA9PiB7XG4gICAgICBtZXRyaWNzRGF0YVttZXRyaWNdW2NvbnZlcnRVVENUUyh0cyAqIDEwMDApIC8gMTAwMF0gPSBkYXRhLmRhdGFbbWV0cmljXVt0c107XG4gICAgfSk7XG4gIH0pO1xuXG4gIE9iamVjdC5rZXlzKG1ldHJpY3NEYXRhKS5mb3JFYWNoKG1ldHJpYyA9PiB7XG4gICAgY29uc3QgY2FsQ29udGFpbmVyID0gZGl2LmFwcGVuZCgnZGl2Jyk7XG4gICAgaWYgKHNob3dNZXRyaWNOYW1lKSB7XG4gICAgICBjYWxDb250YWluZXIudGV4dChgTWV0cmljOiAke3ZlcmJvc2VNYXBbbWV0cmljXSB8fCBtZXRyaWN9YCk7XG4gICAgfVxuICAgIGNvbnN0IHRpbWVzdGFtcHMgPSBtZXRyaWNzRGF0YVttZXRyaWNdO1xuICAgIGNvbnN0IGV4dGVudHMgPSBkM0V4dGVudChPYmplY3Qua2V5cyh0aW1lc3RhbXBzKSwga2V5ID0+IHRpbWVzdGFtcHNba2V5XSk7XG4gICAgY29uc3Qgc3RlcCA9IChleHRlbnRzWzFdIC0gZXh0ZW50c1swXSkgLyAoc3RlcHMgLSAxKTtcbiAgICBjb25zdCBjb2xvclNjYWxlID0gZ2V0U2VxdWVudGlhbFNjaGVtZVJlZ2lzdHJ5KClcbiAgICAgIC5nZXQobGluZWFyQ29sb3JTY2hlbWUpXG4gICAgICAuY3JlYXRlTGluZWFyU2NhbGUoZXh0ZW50cyk7XG5cbiAgICBjb25zdCBsZWdlbmQgPSBkM1JhbmdlKHN0ZXBzKS5tYXAoaSA9PiBleHRlbnRzWzBdICsgc3RlcCAqIGkpO1xuICAgIGNvbnN0IGxlZ2VuZENvbG9ycyA9IGxlZ2VuZC5tYXAoeCA9PiBjb2xvclNjYWxlKHgpKTtcblxuICAgIGNvbnN0IGNhbCA9IG5ldyBDYWxIZWF0TWFwKCk7XG4gICAgY2FsLmluaXQoe1xuICAgICAgc3RhcnQ6IGNvbnZlcnRVVENUUyhkYXRhLnN0YXJ0KSxcbiAgICAgIGRhdGE6IHRpbWVzdGFtcHMsXG4gICAgICBpdGVtU2VsZWN0b3I6IGNhbENvbnRhaW5lci5ub2RlKCksXG4gICAgICBsZWdlbmRWZXJ0aWNhbFBvc2l0aW9uOiAndG9wJyxcbiAgICAgIGNlbGxTaXplLFxuICAgICAgY2VsbFBhZGRpbmcsXG4gICAgICBjZWxsUmFkaXVzLFxuICAgICAgbGVnZW5kQ2VsbFNpemU6IGNlbGxTaXplLFxuICAgICAgbGVnZW5kQ2VsbFBhZGRpbmc6IDIsXG4gICAgICBsZWdlbmRDZWxsUmFkaXVzOiBjZWxsUmFkaXVzLFxuICAgICAgdG9vbHRpcDogdHJ1ZSxcbiAgICAgIGRvbWFpbjogZG9tYWluR3JhbnVsYXJpdHksXG4gICAgICBzdWJEb21haW46IHN1YmRvbWFpbkdyYW51bGFyaXR5LFxuICAgICAgcmFuZ2U6IGRhdGEucmFuZ2UsXG4gICAgICBicm93c2luZzogdHJ1ZSxcbiAgICAgIGxlZ2VuZCxcbiAgICAgIGxlZ2VuZENvbG9yczoge1xuICAgICAgICBjb2xvclNjYWxlLFxuICAgICAgICBtaW46IGxlZ2VuZENvbG9yc1swXSxcbiAgICAgICAgbWF4OiBsZWdlbmRDb2xvcnNbbGVnZW5kQ29sb3JzLmxlbmd0aCAtIDFdLFxuICAgICAgICBlbXB0eTogJ3doaXRlJyxcbiAgICAgIH0sXG4gICAgICBkaXNwbGF5TGVnZW5kOiBzaG93TGVnZW5kLFxuICAgICAgaXRlbU5hbWU6ICcnLFxuICAgICAgdmFsdWVGb3JtYXR0ZXIsXG4gICAgICB0aW1lRm9ybWF0dGVyLFxuICAgICAgc3ViRG9tYWluVGV4dEZvcm1hdCxcbiAgICB9KTtcbiAgfSk7XG59XG5cbkNhbGVuZGFyLmRpc3BsYXlOYW1lID0gJ0NhbGVuZGFyJztcbkNhbGVuZGFyLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXI7XG4iLCIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IHJlYWN0aWZ5LCBzdHlsZWQgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgQ29tcG9uZW50IGZyb20gJy4vQ2FsZW5kYXInO1xuXG5jb25zdCBSZWFjdENvbXBvbmVudCA9IHJlYWN0aWZ5KENvbXBvbmVudCk7XG5cbmNvbnN0IENhbGVuZGVyID0gKHsgY2xhc3NOYW1lLCAuLi5vdGhlclByb3BzIH0pID0+IHtcbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lfT5cbiAgICAgIDxSZWFjdENvbXBvbmVudCB7Li4ub3RoZXJQcm9wc30gLz5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbkNhbGVuZGVyLmRlZmF1bHRQcm9wcyA9IHtcbiAgb3RoZXJQcm9wczoge30sXG59O1xuXG5DYWxlbmRlci5wcm9wVHlwZXMgPSB7XG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBvdGhlclByb3BzOiBQcm9wVHlwZXMub2JqZWN0T2YoUHJvcFR5cGVzLmFueSksXG59O1xuXG5leHBvcnQgZGVmYXVsdCBzdHlsZWQoQ2FsZW5kZXIpYFxuICAuc3VwZXJzZXQtbGVnYWN5LWNoYXJ0LWNhbGVuZGFyIHtcbiAgICBwYWRkaW5nOiAxMHB4O1xuICAgIHBvc2l0aW9uOiBzdGF0aWMgIWltcG9ydGFudDtcbiAgICBvdmVyZmxvdzogYXV0byAhaW1wb3J0YW50O1xuICB9XG5cbiAgLnN1cGVyc2V0LWxlZ2FjeS1jaGFydC1jYWxlbmRhciAuY2gtdG9vbHRpcCB7XG4gICAgbWFyZ2luLWxlZnQ6IDIwcHg7XG4gICAgbWFyZ2luLXRvcDogNXB4O1xuICB9XG5gO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ1pBO0FBQ0E7Ozs7O0FBT0E7QUErQkE7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUdBO0FBR0E7QUFlQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBT0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUVBO0FBR0E7QUFDQTtBQUdBO0FBUUE7QUFHQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFTQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFPQTtBQVdBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBR0E7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFrUEE7QUFzRkE7QUFLQTtBQUNBO0FBZ0JBO0FBaUJBO0FBQ0E7OztBQU1BO0FBdURBO0FBQ0E7QUFDQTtBQXVCQTtBQW1CQTtBQUNBO0FBZUE7Ozs7QUFtQkE7QUFBQTtBQXFIQTtBQUNBO0FBdEhBO0FBOExBO0FBT0E7QUFDQTtBQUNBO0FBeUdBO0FBQ0E7QUFDQTtBQW9CQTtBQUNBO0FBRUE7QUFzQkE7QUErQkE7Ozs7O0FBSUE7QUFnQkE7QUFDQTs7Ozs7QUE0SEE7Ozs7QUE1SEE7QUF1QkE7QUFVQTs7Ozs7QUFtTkE7QUEzRkE7Ozs7QUEvRUE7Ozs7Ozs7O0FBV0E7Ozs7O0FBa0JBOzs7OztBQStHQTs7Ozs7QUFxRUE7Ozs7OztBQTZCQTs7QUEyREE7Ozs7QUE0REE7Ozs7Ozs7O0FBbUJBO0FBWUE7QUFDQTtBQUVBOzs7Ozs7O0FBUUE7Ozs7O0FBd0JBOztBQVNBOztBQVNBOzs7OztBQWNBOzs7OztBQWdCQTs7OztBQWVBOzs7O0FBWUE7QUEwQ0E7QUFDQTtBQUVBO0FBMkJBO0FBY0E7QUFDQTtBQUVBOzs7Ozs7O0FBUUE7Ozs7Ozs7QUF1QkE7QUFnQ0E7Ozs7O0FBbURBOzs7OztBQVlBOzs7O0FBV0E7QUFjQTtBQUNBO0FBRUE7Ozs7O0FBd0RBOzs7Ozs7QUFzQkE7Ozs7Ozs7O0FBOTRCQTs7Ozs7O0FBdTlCQTtBQWtEQTtBQUNBO0FBRUE7Ozs7QUFLQTs7OztBQU9BOzs7OztBQWFBOzs7OztBQWlCQTs7Ozs7QUFjQTs7Ozs7QUFZQTs7Ozs7Ozs7QUFrQkE7Ozs7QUFjQTs7Ozs7O0FBZ0JBO0FBeUJBO0FBQ0E7QUFFQTs7Ozs7O0FBT0E7Ozs7OztBQW9CQTtBQWVBO0FBR0E7QUFTQTtBQUNBO0FBQ0E7Ozs7OztBQWNBOzs7Ozs7QUFzQkE7Ozs7OztBQXFDQTs7Ozs7O0FBc0JBOzs7Ozs7QUFxQkE7QUFnQkE7QUFDQTs7QUEyRkE7Ozs7QUF3QkE7Ozs7QUFjQTtBQWFBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7OztBQWNBO0FBNkRBOzs7Ozs7Ozs7QUFpQ0E7QUFzQkE7QUFDQTtBQUVBO0FBQ0E7QUFNQTtBQW1DQTtBQUlBOzs7Ozs7OztBQTJCQTtBQTREQTtBQUNBO0FBRUE7O0FBR0E7O0FBWUE7Ozs7Ozs7Ozs7QUFvQkE7Ozs7O0FBK0JBOzs7Ozs7QUFhQTs7Ozs7QUFrQ0E7Ozs7QUErQkE7Ozs7QUFnQkE7Ozs7Ozs7O0FBb0JBOzs7Ozs7OztBQW1CQTtBQWdEQTtBQXdCQTtBQThCQTtBQVNBO0FBQ0E7QUFTQTtBQTZCQTtBQUNBO0FBRUE7O0FBR0E7QUErREE7QUFDQTtBQUVBO0FBZUE7QUE0QkE7QUFXQTs7Ozs7OztBQW9LQTtBQWtCQTtBQXlCQTs7Ozs7Ozs7QUE4QkE7O0FBZ0NBO0FBT0E7QUFPQTs7Ozs7O0FBY0E7QUFJQTtBQUtBO0FBTUE7QUFFQTtBQUtBOzs7OztBQzVzSEE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0JBO0FBMkJBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFLQTtBQUVBO0FBRUE7O0FDN0RBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///2494\n')}}]);